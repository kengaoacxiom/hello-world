<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="22e472af-a58a-4bea-acc4-50a65cf84b61" activeEnvironment="Default environment" name="Temp Misc" lastOpened="2016-04-30T15:11:31.176-07:00" resourceRoot="" soapui-version="6.0.0" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:testSuite name="TS_1_Visa_07675005430_435880_ReversalFlow" id="0996b6b7-dde4-4af4-bc94-ddfebe16a763"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_001_Visa Add card and activate" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="358e3666-7b35-4c5c-80e4-b0b79d2b9d57" disabled="true"><con:settings/><con:testStep type="acquirer_sim" name="Add Card via CMF" id="748c7c98-9370-48f1-9143-f42276673813"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml/><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358804792425709"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675005430"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Copy of Activate Card 100 via UMS" id="aaec0034-a387-4e12-93ba-d02d702b66a7"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358805309188953"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000050000"/>
  <field id="6" value="000000050000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000050000"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="725400"/>
  <field id="4" value="50000"/>
  <field id="6" value="50000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"4358804563994875"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"50000"},{"field":"6","value":"50000"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675005430</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.220</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_000_Visa Reset DB and Card Status" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="546d20f0-7e7b-4137-b190-9cc71d6a26df" disabled="true"><con:settings/><con:testStep type="groovy" name="DB update and card reset" id="b12b54b3-5b0a-490d-93b2-f5e43d1231b6"><con:settings/><con:config><script>// TO use this TC, PAN is needed in the TestSuite property 
import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null;
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String");
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver");
try{
//  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.testSuite.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]

def res = con.firstRow("SELECT account from card where lastFour=? order by createdDate desc", [lastFour]).account

testRunner.testCase.testSuite.setPropertyValue( "account", res.toString())

def account=testRunner.testCase.testSuite.getPropertyValue("account");
def acct_bal=testRunner.testCase.testSuite.getPropertyValue("acct_balance");
con.execute("update card set status = 'OPEN', statusReason= 'NONE' where account = ?", [account])

con.execute("UPDATE balance_cache SET balance=? WHERE account=? and layers ='840'",[acct_bal,account])
con.execute("UPDATE balance_cache SET balance=? WHERE account=? and layers ='840.1840'",[acct_bal,account])

con.close()</script></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675005430</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.220</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_002_Visa 420 Reversals All Flds Match" searchProperties="true" id="931297c9-8b02-4aca-bb2e-655397a6d523"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="1f58ac1e-fc8a-49a4-a7c5-d317cdb006dd"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C50000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0414103535"/>
  <field id="11" value="369828"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="398274882147"/>
  <field id="38" value="135362"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000048000001840C000000005000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="670794725650130"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0414103535"/>
  <field id="11" value="369828"/>
  <field id="12" value="103535"/>
  <field id="13" value="0414"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="398274882147"/>
  <field id="41" value="TERMID01"/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="670794725650130"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000499000001840C000000050000"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1" id="c46049c0-a69e-4ae6-9765-5fd6ffba7a10"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141516"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="413677853609"/>
  <field id="38" value="493229"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="647606915518001"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010031429902191415151234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141516"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="413677853609"/>
  <field id="38" value="493229"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="647606915518001"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010031429902191415151234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 645</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_003_Visa 420 Reversals Tranid RRN match" searchProperties="true" id="7bbb6cba-0ea5-4316-9304-0b61a632c220"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="a47bf4d3-5402-49f4-a200-c7817bc3c69b"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0331144200"/>
  <field id="11" value="713919"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="070372885987"/>
  <field id="38" value="938321"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000048000001840C000000005000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="882468738732855"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0331144200"/>
  <field id="11" value="713919"/>
  <field id="12" value="144200"/>
  <field id="13" value="0331"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="070372885987"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="882468738732855"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000499000001840C000000050000"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1" id="6fd2b564-1ea9-48f3-a65d-978df99d7aa3"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141518"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="484111588046"/>
  <field id="38" value="029717"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="477564409495962"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010082288302191415171234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141518"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="484111588046"/>
  <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="477564409495962"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010082288302191415171234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"","value":""},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_004_Visa 420 Reversals Amount  Unmatch" searchProperties="true" id="042fd886-f147-4cf8-bb48-7ceb64c45940"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="b9516705-d826-4ee7-b63d-784afa4225e3"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0331144201"/>
  <field id="11" value="863500"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="019363890787"/>
  <field id="38" value="013319"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000047000001840C000000005000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="207819038117338"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0331144201"/>
  <field id="11" value="863500"/>
  <field id="12" value="144201"/>
  <field id="13" value="0331"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="019363890787"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="207819038117338"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000499000001840C000000050000"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $0.50" id="632a08f7-2b11-4c70-8f2d-eee1d6c642b5"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000050"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141519"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="337879173678"/>
  <field id="38" value="789564"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="377441296013064"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010048423702191415181234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000050"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141519"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="337879173678"/>
  <field id="38" value="789564"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="377441296013064"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010048423702191415181234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"4","value":"000000000050"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_005_Visa 420 Reversals 120 All Flds Match" searchProperties="true" id="de32430a-53fc-41e1-9cb1-f22f7f0417d0"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="06d7a3ec-2109-430d-aaf7-2f676fe49f6c"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0130"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0331144202"/>
  <field id="11" value="646452"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="142970711893"/>
  <field id="38" value="472135"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="739372587190277"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0331144202"/>
  <field id="11" value="646452"/>
  <field id="12" value="144202"/>
  <field id="13" value="0331"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="142970711893"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="739372587190277"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"0","value":"0120"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1" id="34b062e1-cc62-4155-9324-7623804bbbd8"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0331144203"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="142970711893"/>
  <field id="38" value="472135"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="739372587190277"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="012064645203311442021234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0331144203"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="142970711893"/>
  <field id="38" value="472135"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="739372587190277"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="012064645203311442021234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_006_Visa 420 Reversals 200 All Flds Match" searchProperties="true" id="b0a3864c-83bc-4336-b9a7-5eabb24ffbdd"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="598ff972-b727-4162-846c-08d7a653306d"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141520"/>
  <field id="11" value="579190"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="523633545787"/>
  <field id="38" value="856459"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000499000001840C000000049900"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="135170022457205"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141520"/>
  <field id="11" value="579190"/>
  <field id="12" value="141520"/>
  <field id="13" value="0219"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="523633545787"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="135170022457205"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000499000001840C000000049900"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"0","value":"0200"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1" id="2aa41318-b6a0-4cd6-af72-88beb9753915"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141521"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="523633545787"/>
  <field id="38" value="856459"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="135170022457205"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="020057919002191415201234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141521"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="523633545787"/>
  <field id="38" value="856459"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="135170022457205"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="020057919002191415201234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_007_Visa 420 Reversals 220 All Flds Match" searchProperties="true" id="c9ccdeac-0dcd-4b69-b5c8-2c15095ad21a"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="80800173-404f-4937-9c16-a1bedf3a74c2"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0230"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141521"/>
  <field id="11" value="928996"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="324836391081"/>
  <field id="38" value="997413"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="842385085523630"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141521"/>
  <field id="11" value="928996"/>
  <field id="12" value="141521"/>
  <field id="13" value="0219"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="324836391081"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="842385085523630"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"0","value":"0220"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1" id="2f346a93-7d35-4d75-8c72-5e7d1ecf3e24"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141522"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="324836391081"/>
  <field id="38" value="997413"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="842385085523630"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="022092899602191415211234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141522"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="324836391081"/>
  <field id="38" value="997413"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="842385085523630"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="022092899602191415211234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_008_Visa 400 Reversals 100 All Match" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="97d754a1-a9f4-4602-b588-b9eeede7b2a2"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="13fe7db1-0fec-41d5-bf05-6d084bec5f2a"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141522"/>
  <field id="11" value="875888"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="051942095436"/>
  <field id="38" value="076173"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000499000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="272271500774222"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141522"/>
  <field id="11" value="875888"/>
  <field id="12" value="141522"/>
  <field id="13" value="0219"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="051942095436"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="272271500774222"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000499000001840C000000050000"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1" id="62ceed6f-4ea7-4b31-9729-567d4663ae30"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141523"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="051942095436"/>
  <field id="38" value="139002"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="272271500774222"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010087588802191415221234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141523"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="051942095436"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="272271500774222"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010087588802191415221234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000500000001840C000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358805852157207</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358805852157207=19111210000060000000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_009_Visa 400 Reversals 120 All Match" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="33e4391f-e15a-457a-a261-56f09c5fb3ac"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="4fd9d5bc-a9a1-4979-967e-cc2994ea3dce"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0130"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141524"/>
  <field id="11" value="581243"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="488582381614"/>
  <field id="38" value="925428"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="734351351459078"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141524"/>
  <field id="11" value="581243"/>
  <field id="12" value="141524"/>
  <field id="13" value="0219"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="488582381614"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="734351351459078"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"0","value":"0120"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1" id="6d9b0826-abef-4cf9-aa16-47c4fd54b1e5"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141524"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="488582381614"/>
  <field id="38" value="614864"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="734351351459078"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="012058124302191415241234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141524"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="488582381614"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="734351351459078"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="012058124302191415241234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000500000001840C000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358805852157207</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358805852157207=19111210000060000000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_010_Visa 400 Reversals 200 All Match" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="d1372d8e-1ec1-4e28-845e-eea6f001e6c1"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="18dbb722-40d3-434b-90df-01bfd13a003b"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141525"/>
  <field id="11" value="908022"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="506065353382"/>
  <field id="38" value="822484"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000499000001840C000000049900"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="500796720393435"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141525"/>
  <field id="11" value="908022"/>
  <field id="12" value="141525"/>
  <field id="13" value="0219"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="506065353382"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="500796720393435"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000499000001840C000000049900"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"0","value":"0200"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1" id="2a661c31-cfa7-4d67-a9ff-4eb80709662e"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141526"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="506065353382"/>
  <field id="38" value="945999"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="500796720393435"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="020090802202191415251234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141526"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="506065353382"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="500796720393435"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="020090802202191415251234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000500000001840C000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358805852157207</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358805852157207=19111210000060000000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_011_Visa 400 Reversals 220 All Match" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="7177942b-d451-4295-829c-96881432061d"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="1b04b47d-7bba-4a0e-b163-806b69933673"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0230"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141526"/>
  <field id="11" value="685150"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="047773397589"/>
  <field id="38" value="021465"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="908499565000808"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141526"/>
  <field id="11" value="685150"/>
  <field id="12" value="141526"/>
  <field id="13" value="0219"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="047773397589"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="908499565000808"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"0","value":"0220"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1" id="3aa67796-71b2-43fb-bf9f-1c7749962d41"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141527"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="047773397589"/>
  <field id="38" value="705383"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="908499565000808"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="022068515002191415261234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141527"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="047773397589"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="908499565000808"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="022068515002191415261234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000500000001840C000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358805852157207</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358805852157207=19111210000060000000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8a1fcb02-8f48-4014-8141-c460cf0d51bd</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Copy of TC_002_Visa 420 Reversals partial redemption/reversal" searchProperties="true" id="c9cdc6d7-16b6-4537-ac52-dd8e43e6d14a"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="8293150a-e967-41eb-947e-5fede1abd790"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C50000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000007000"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000007000"/>
  <field id="7" value="0414105053"/>
  <field id="11" value="571491"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="998185303959"/>
  <field id="38" value="000000"/>
  <field id="39" value="51"/>
  <field id="41" value="TERMID01"/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000048000001840C000000005000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="579378761282720"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="7000"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="7000"/>
  <field id="7" value="0414105053"/>
  <field id="11" value="571491"/>
  <field id="12" value="105053"/>
  <field id="13" value="0414"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="998185303959"/>
  <field id="41" value="TERMID01"/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="579378761282720"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000499000001840C000000050000"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"4","value":"7000"},{"field":"6","value":"7000"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1" id="25e37921-861b-4235-a7a5-030270b7285a"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141516"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="413677853609"/>
  <field id="38" value="493229"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="647606915518001"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010031429902191415151234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0219141516"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="413677853609"/>
  <field id="38" value="493229"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="647606915518001"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010031429902191415151234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 645</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:properties><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>9999</con:value></con:property><con:property><con:name>Spec</con:name><con:value/></con:property><con:property><con:name>PAN</con:name><con:value>4358804563994875</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>2102</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804563994875=210212100000388000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 908</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TotalTxns</con:name><con:value>20</con:value></con:property><con:property><con:name>TotalPassTxns</con:name><con:value>0</con:value></con:property><con:property><con:name>TotalFailTxns</con:name><con:value>0</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675005430</con:value></con:property><con:property><con:name>account</con:name><con:value>1000000000000002126</con:value></con:property><con:property><con:name>acct_balance</con:name><con:value>500</con:value></con:property><con:property><con:name>DB_String</con:name><con:value>jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift</con:value></con:property><con:property><con:name>DB_Driver</con:name><con:value>com.mysql.jdbc.Driver</con:value></con:property></con:properties><con:reportParameters/></con:testSuite><con:testSuite name="TS_2_Visa_07675005430_435880_PartialAuth" id="bf76f7f4-7d43-4af2-8056-871d8090c2e3"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting></con:settings><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_001_Visa Add card and activate" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="b17857cc-8dbb-467f-b074-e53f6b2294be" disabled="true"><con:settings/><con:testStep type="acquirer_sim" name="Add Card via CMF" id="15a988f4-432a-46dc-9679-11d8466345e8"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4358804792425709"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="13" value="150420"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675005430"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358804792425709"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="13" value="150420"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675005430"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Copy of Activate Card 100 via UMS" id="cc5b1cb3-4d4f-4d94-85f5-ee86de29dff6"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000050000"/>
  <field id="6" value="000000050000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="078779"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000050000"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="725400"/>
  <field id="4" value="50000"/>
  <field id="6" value="50000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"50000"},{"field":"6","value":"50000"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675005430</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.220</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_000_Visa Reset DB and Card Status in working" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="008a1fe5-fc09-4303-a09b-ac060615e421"><con:settings/><con:testStep type="groovy" name="DB update and card reset" id="5fe30ee4-fabe-4e90-8f40-fbca42747628"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.testSuite.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]

def res = con.firstRow("SELECT account from card where lastFour=? order by createdDate desc", [lastFour]).account

testRunner.testCase.testSuite.setPropertyValue( "account", res.toString())

def account=testRunner.testCase.testSuite.getPropertyValue("account")
def acct_bal=testRunner.testCase.testSuite.getPropertyValue("acct_balance");
con.execute("update card set status = 'OPEN', statusReason= 'NONE' where account = ?", [account])

con.execute("UPDATE balance_cache SET balance=? WHERE account=? and layers ='840'",[acct_bal, account])
con.execute("UPDATE balance_cache SET balance=? WHERE account=? and layers ='840.1840'",[acct_bal, account])
con.close()</script></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675005430</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.220</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_002_Visa 100 Partial Auth Purchase &amp; Reversals 60.10-1" searchProperties="true" id="25992d81-eda1-409c-bd4d-60f3b7da3dc4"><con:settings/><con:testStep type="acquirer_sim" name="Partial Auth Purchase Amt > Balance" id="742be892-f9cf-411b-86f6-8b237f9fa299"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000050500"/>
  <!--field id="5" value="000000000100"/-->
  <!--field id="6" value="000000000100"/-->
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000001" />
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C60000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000050000"/>
  <field id="7" value="0727102326"/>
  <field id="11" value="009504"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="797524355046"/>
  <field id="38" value="551727"/>
  <field id="39" value="10"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="54" value="0002840C0000000000000057840C000000050500"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="849873693226356"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000050500"/>
  <field id="7" value="0727102326"/>
  <field id="11" value="009504"/>
  <field id="12" value="102326"/>
  <field id="13" value="0727"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="797524355046"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000001"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="849873693226356"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"10"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Partial Auth Reversal Amt &lt; balance" id="f30e607f-71b8-4b6d-a2da-79519297796a"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000001000"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0727102327"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="797524355046"/>
  <field id="38" value="551727"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="849873693226356"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010000950407271023261234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000001000"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0727102327"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="797524355046"/>
  <field id="38" value="551727"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="849873693226356"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010000950407271023261234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000500000001840C000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"4","value":"000000001000"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_003_Visa 100 Partial Auth Purchase AMT > Balance 60.10-0" searchProperties="true" id="aa73df3e-7a9b-4ca2-8f91-1cea6898fcd8"><con:settings/><con:testStep type="acquirer_sim" name="Partial Auth Purchase Amt > Balance" id="93c4c5c7-b9dd-47a5-a620-66fd8cd77ca6"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000050500"/>
  <!--field id="5" value="000000000100"/-->
  <!--field id="6" value="000000000100"/-->
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000000" />
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C60000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000050500"/>
  <field id="7" value="0727102328"/>
  <field id="11" value="963156"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="662130112165"/>
  <field id="38" value="000000"/>
  <field id="39" value="51"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="517895406278502"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000050500"/>
  <field id="7" value="0727102328"/>
  <field id="11" value="963156"/>
  <field id="12" value="102328"/>
  <field id="13" value="0727"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="662130112165"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000000"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="517895406278502"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"51"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"60","value":"000000000000"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_004_Visa 100 Partial Auth Purchase AMT &lt; Balance 60.10-0" searchProperties="true" id="d18c8ab0-7360-451f-b061-fbe2599de4b5"><con:settings/><con:testStep type="acquirer_sim" name="Partial Auth Purchase Amt &lt; Balance" id="e5a14fa5-2442-46b1-acb8-8db85271a291"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000000100"/>
  <!--field id="5" value="000000000100"/-->
  <!--field id="6" value="000000000100"/-->
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000000" />
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C60000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="7" value="0727102328"/>
  <field id="11" value="371406"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="558607862902"/>
  <field id="38" value="292826"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="54" value="0002840C0000000499000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="144556970804131"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000000100"/>
  <field id="7" value="0727102328"/>
  <field id="11" value="371406"/>
  <field id="12" value="102328"/>
  <field id="13" value="0727"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="558607862902"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000000"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="144556970804131"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"60","value":"000000000000"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Partial Auth Reversal Amt &lt; balance" id="cdc69f11-ba28-4bdf-95e8-10013cb52a5c"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0727102329"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="558607862902"/>
  <field id="38" value="292826"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="144556970804131"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010037140607271023281234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0727102329"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="558607862902"/>
  <field id="38" value="292826"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="144556970804131"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010037140607271023281234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_005_Visa 200 Partial Auth Purchase &amp; Reversals 60.10-1" searchProperties="true" id="1614351d-522c-411d-a24d-2594f5e06e6e"><con:settings/><con:testStep type="acquirer_sim" name="Partial Auth Purchase Amt > Balance" id="ec1f24f6-4380-4676-ba81-c27394cbbbc7"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000050500"/>
  <!--field id="5" value="000000000100"/-->
  <!--field id="6" value="000000000100"/-->
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000001" />
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C60000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000050000"/>
  <field id="7" value="0727102329"/>
  <field id="11" value="758705"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="166082119344"/>
  <field id="38" value="270397"/>
  <field id="39" value="10"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="54" value="0002840C0000000000000057840C000000050500"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="227095144166649"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000050500"/>
  <field id="7" value="0727102329"/>
  <field id="11" value="758705"/>
  <field id="12" value="102329"/>
  <field id="13" value="0727"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="166082119344"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000001"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="227095144166649"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"10"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"0","value":"0200"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Partial Auth Reversal Amt &lt; balance" id="697af2ad-e35d-4bd4-99b4-5413c41fd805"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000001000"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0727102330"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="166082119344"/>
  <field id="38" value="270397"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="227095144166649"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="020075870507271023291234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000001000"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0727102330"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="166082119344"/>
  <field id="38" value="270397"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="227095144166649"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="020075870507271023291234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"4","value":"000000001000"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_006_Visa 100 Partial Auth Purchase AMT &lt; Balance 60.10-0" searchProperties="true" id="3332fada-bef2-4d19-8913-650970799c35"><con:settings/><con:testStep type="acquirer_sim" name="Partial Auth Purchase Amt &lt; Balance" id="fcfd2b7f-0c62-49e9-9cbb-87e7d9a4a07d"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000000100"/>
  <!--field id="5" value="000000000100"/-->
  <!--field id="6" value="000000000100"/-->
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000001" />
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C60000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="7" value="0727102331"/>
  <field id="11" value="897955"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="313296445399"/>
  <field id="38" value="212741"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="54" value="0002840C0000000499000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="292872768174361"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000000100"/>
  <field id="7" value="0727102331"/>
  <field id="11" value="897955"/>
  <field id="12" value="102331"/>
  <field id="13" value="0727"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="313296445399"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000000"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="292872768174361"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"60","value":"000000000000"},{"field":"62.1","value":"Y"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Increment Auth Partial Auth Purchase Amt > Balance" id="997a8835-ac4f-4106-9858-c06decbcad06"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000000100"/>
  <!--field id="5" value="000000000100"/-->
  <!--field id="6" value="000000000100"/-->
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000000" />
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C60000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000050100"/>
  <field id="7" value="0727102331"/>
  <field id="11" value="264101"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="313296445399"/>
  <field id="38" value="000000"/>
  <field id="39" value="51"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="54" value="0002840C0000000499000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="I"/>
    <field id="2" value="292872768174361"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000050100"/>
  <field id="7" value="0727102331"/>
  <field id="11" value="264101"/>
  <field id="12" value="102331"/>
  <field id="13" value="0727"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="313296445399"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000000"/>
  <isomsg id="62">
    <field id="1" value="I"/>
    <field id="2" value="292872768174361"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"51"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"@req62.2"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"60","value":"000000000000"},{"field":"62.1","value":"I"},{"field":"4","value":"000000050100"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Partial Auth Reversal Amt &lt; balance" id="183c82c5-85b3-4e2d-ba0d-def51f39c45b"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0727102332"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="313296445399"/>
  <field id="38" value="000000"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="292872768174361"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010026410107271023311234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0727102332"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="313296445399"/>
  <field id="38" value="000000"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="292872768174361"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010026410107271023311234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_007_Visa 100 Partial Auth Purchase AMT &lt; Balance 60.10-3" searchProperties="true" id="215cb873-3e9b-4e56-9303-e9b9c605a48e"><con:settings/><con:testStep type="acquirer_sim" name="Partial Auth Purchase Amt > Balance" id="8f1acfa5-0957-4e3e-8fa9-8fdbe97bfa40"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000050100"/>
  <!--field id="5" value="000000000100"/-->
  <!--field id="6" value="000000000100"/-->
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000001" />
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C60000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000050100"/>
  <field id="7" value="0727102332"/>
  <field id="11" value="552325"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="098549421755"/>
  <field id="38" value="000000"/>
  <field id="39" value="51"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="064668915758382"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000050100"/>
  <field id="7" value="0727102332"/>
  <field id="11" value="552325"/>
  <field id="12" value="102332"/>
  <field id="13" value="0727"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="098549421755"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000003"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="064668915758382"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"51"},{"field":"44.5","value":"2"},{"field":"54","value":"0002840C0000000500000001840C000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"60","value":"000000000003"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_002_Visa 100 Partial Auth Purchase &amp; Reversals 60.10-1 de20271" searchProperties="true" id="8b3f023a-fdd4-4c99-946a-ba291a0498d9"><con:settings/><con:testStep type="acquirer_sim" name="Partial Auth Purchase Amt > Balance" id="d843ba76-411e-4a35-8354-540982e9ef92"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000050500"/>
  <!--field id="5" value="000000000100"/-->
  <!--field id="6" value="000000000100"/-->
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000001" />
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C60000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000007000"/>
  <field id="7" value="0418104100"/>
  <field id="11" value="350423"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="521820321541"/>
  <field id="38" value="030908"/>
  <field id="39" value="10"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="54" value="0002840C0000000000000057840C000000007000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="041609374576367"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="7000"/>
  <field id="7" value="0418104100"/>
  <field id="11" value="350423"/>
  <field id="12" value="104100"/>
  <field id="13" value="0418"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="521820321541"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000001"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="041609374576367"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"10"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"4","value":"7000"},{"field":"","value":""},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Partial Auth Reversal Amt &lt; balance" id="dec9ffdd-e840-4650-b07e-1e75e511b062"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000007000"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0418104214"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="521820321541"/>
  <field id="38" value="030908"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000048000001840C000000005000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="041609374576367"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010035042304181041001234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="7000"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0418104214"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="521820321541"/>
  <field id="38" value="030908"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="041609374576367"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010035042304181041001234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000500000001840C000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"4","value":"7000"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_002_Visa 100 Partial Auth Purchase &amp; Reversals 60.10-1 de20271-1" searchProperties="true" id="0c189e33-ac03-4ef3-8131-3c9859e99203"><con:settings/><con:testStep type="acquirer_sim" name="Partial Auth Purchase Amt > Balance" id="c3be09a5-159f-4931-aa46-775fa28e162a"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="00000050500"/>
  <!--field id="5" value="000000000100"/-->
  <!--field id="6" value="000000000100"/-->
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000001" />
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C60000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000007000"/>
  <field id="7" value="0418104523"/>
  <field id="11" value="030703"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="347315298146"/>
  <field id="38" value="377270"/>
  <field id="39" value="10"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="54" value="0002840C0000000000000057840C000000007000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="235063545604608"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="7000"/>
  <field id="7" value="0418104523"/>
  <field id="11" value="030703"/>
  <field id="12" value="104523"/>
  <field id="13" value="0418"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="347315298146"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="000000000001"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="235063545604608"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"10"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"4","value":"7000"},{"field":"","value":""},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Partial Auth Reversal Amt &lt; balance" id="77cef262-0396-4b30-994d-c404a6dc0213"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
    <field id="38" value="029717"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000007000"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0418104653"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="347315298146"/>
  <field id="38" value="377270"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000048000001840C000000005000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="235063545604608"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="020003070304181045231234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358804563994875"/>
  <field id="3" value="000000"/>
  <field id="4" value="7000"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0418104653"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804563994875=210212100000388000"/>
  <field id="37" value="347315298146"/>
  <field id="38" value="377270"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="235063545604608"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="020003070304181045231234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000500000001840C000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"38","value":"@res38"},{"field":"4","value":"@res4"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:properties><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>9999</con:value></con:property><con:property><con:name>Spec</con:name><con:value/></con:property><con:property><con:name>PAN</con:name><con:value>4358804563994875</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>2102</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804563994875=210212100000388000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 908</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TotalTxns</con:name><con:value>31</con:value></con:property><con:property><con:name>TotalPassTxns</con:name><con:value>43</con:value></con:property><con:property><con:name>TotalFailTxns</con:name><con:value>0</con:value></con:property><con:property><con:name>account</con:name><con:value>1000000000000006020</con:value></con:property><con:property><con:name>acct_balance</con:name><con:value>500</con:value></con:property><con:property><con:name>DB_String</con:name><con:value>jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift</con:value></con:property><con:property><con:name>DB_Driver</con:name><con:value>com.mysql.jdbc.Driver</con:value></con:property></con:properties><con:reportParameters/></con:testSuite><con:testSuite name="TS_3_Visa_07675005430_435880_PIN Txns" id="4ad267de-b06d-41d4-b964-cc2a695139d0"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting></con:settings><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_001_Visa Add card and activate" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="f8a9a0df-2059-4161-9d53-8441f5e4c707" disabled="true"><con:settings/><con:testStep type="acquirer_sim" name="Add Card via CMF" id="24ee49da-cbb8-46da-a839-36c60251731c"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4358808639968482"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675005430"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358808639968482"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675005430"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Copy of Activate Card 100 via UMS" id="c652de07-6319-44ad-9077-9e5e040a6c2c"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000050000"/>
  <field id="6" value="000000050000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="131909"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000050000"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="725400"/>
  <field id="4" value="50000"/>
  <field id="6" value="50000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"50000"},{"field":"6","value":"50000"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358808639968482</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675005430</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_000_Visa Reset DB and Card Status" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="54ee69b1-7323-4269-a115-71b31c72eb20" disabled="true"><con:settings/><con:testStep type="groovy" name="DB update and card reset" id="14bf0183-ea4b-4e6f-94c8-feae1dcc40cb"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null;
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String");
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver");
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.testSuite.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]

//def res = con.firstRow("SELECT account from card where lastFour=? order by createdDate desc", [lastFour]).account

//testRunner.testCase.testSuite.setPropertyValue( "account", res.toString())

def account=testRunner.testCase.testSuite.getPropertyValue("account");
def acct_bal=testRunner.testCase.testSuite.getPropertyValue("acct_balance");
con.execute("update card set status = 'OPEN', statusReason= 'NONE' where account = ?", [account])

con.execute("UPDATE balance_cache SET balance=? WHERE account=? and layers ='840'",[acct_bal, account]);
con.execute("UPDATE balance_cache SET balance=? WHERE account=? and layers ='840.1840'",[acct_bal, account]);
con.close()</script></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675005430</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.220</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_002_Visa 100 Pin txns Valid Pin" searchProperties="true" id="ab1f2b37-0324-4022-940b-c5897880bfff"><con:settings/><con:testStep type="acquirer_sim" name="100 Pin Txns Auth Purchase Amt $1" id="95d22f5a-1a92-4c86-a91a-6e7bce17d7c0"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0208104427"/>
  <field id="11" value="831956"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="568032194587"/>
  <field id="38" value="966016"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000499000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="034492285221783"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0208104427"/>
  <field id="11" value="831956"/>
  <field id="12" value="104427"/>
  <field id="13" value="0208"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="568032194587"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="034492285221783"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000499000001840C000000050000"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_003_Visa 200 Pin txns Valid Pin" searchProperties="true" id="7578946c-aef4-4e47-8a04-4c03ce1e554b"><con:settings/><con:testStep type="acquirer_sim" name="200 Pin Txns Auth Purchase Amt $1" id="c5759ac5-707b-427c-b3fb-7b110e36f2cb"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0430151137"/>
  <field id="11" value="986618"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="971192492890"/>
  <field id="38" value="000000"/>
  <field id="39" value="N6"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="1"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000050000001840C000000005000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="021234681732060"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0430151137"/>
  <field id="11" value="986618"/>
  <field id="12" value="151137"/>
  <field id="13" value="0430"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="971192492890"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="021234681732060"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000498000001840C000000049900"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_004_Visa 100 Pin txns Reversal" searchProperties="true" id="12d79e9c-d4d1-4c70-a1ba-da3ca7249cb8"><con:settings/><con:testStep type="acquirer_sim" name="100 Pin Txns Auth Purchase Amt $1" id="7bdb67a2-d8ea-49d2-a462-a62126200e9f"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C90000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0208102547"/>
  <field id="11" value="216414"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="331791044692"/>
  <field id="38" value="000000"/>
  <field id="39" value="05"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="707440167338447"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0208102547"/>
  <field id="11" value="216414"/>
  <field id="12" value="102547"/>
  <field id="13" value="0208"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="331791044692"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="707440167338447"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000497000001840C000000049900"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Pin Txns Amt $1" id="66444603-d088-4dde-9ae0-01596f3dd51a"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163302"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="834181462992"/>
  <field id="38" value="250550"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000498000001840C000000049900"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="500811092070736"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="010068001902031633001234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163302"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="834181462992"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="500811092070736"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="010068001902031633001234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000498000001840C000000049900"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_005_Visa 200 Pin Txns Reversal" searchProperties="true" id="bc6426e8-a0b0-463c-9f57-1c7d6c8c914b"><con:settings/><con:testStep type="acquirer_sim" name="200 Pin Txns Auth Purchase Amt $1" id="7ff7459f-8563-4384-beaf-b9eb9a098b5c"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C90000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0208102548"/>
  <field id="11" value="164016"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="621633873253"/>
  <field id="38" value="000000"/>
  <field id="39" value="05"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="727083543689490"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0208102548"/>
  <field id="11" value="164016"/>
  <field id="12" value="102548"/>
  <field id="13" value="0208"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="621633873253"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="727083543689490"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000497000001840C000000049800"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Pin Txns Amt $1" id="5a499daa-0ec8-4efd-9720-d488c1be1db4"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163304"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="869831690093"/>
  <field id="38" value="242337"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000498000001840C000000049900"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="626711226500593"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="020004702202031633041234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163304"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="869831690093"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="626711226500593"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="020004702202031633041234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000498000001840C000000049900"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>55b340af-d021-46b1-8ab1-c9e4926f998a</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_006_Visa 220 Purchase Advice Pin txns Valid Pin" searchProperties="true" id="4ba5ea9b-9eb1-4d2b-be3b-75d669898b54"><con:settings/><con:testStep type="acquirer_sim" name="220 Pin Txns Purchase advice Amt $1" id="2ac5f664-848a-4b97-8192-5acb2df6e53d"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0230"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0208102548"/>
  <field id="11" value="359496"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="213123909350"/>
  <field id="38" value="908695"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="028194405477957"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0208102548"/>
  <field id="11" value="359496"/>
  <field id="12" value="102548"/>
  <field id="13" value="0208"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="213123909350"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="028194405477957"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_007_Visa 420 Pin txns Valid Pin 220" searchProperties="true" id="639e27c1-8c61-40a4-95f6-56ac7905dd91"><con:settings/><con:testStep type="acquirer_sim" name="220 Pin Txns Purchase advice Amt $1" id="e990aace-49f5-453c-be4d-f3a5f5c74335"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0230"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163307"/>
  <field id="11" value="696718"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="733071177880"/>
  <field id="38" value="885816"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="793071159778925"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163307"/>
  <field id="11" value="696718"/>
  <field id="12" value="163307"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="733071177880"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="793071159778925"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Pin Txns Amt $1" id="1ecae2a5-63a7-447b-af5a-de098873ecff"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163307"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="733071177880"/>
  <field id="38" value="717446"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="793071159778925"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="022069671802031633071234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163307"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="733071177880"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="793071159778925"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="022069671802031633071234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_008_Visa 120 Pin txns Valid Pin" searchProperties="true" id="8e1f16f3-e1d5-4b62-9d5f-f60b3819ea7b"><con:settings/><con:testStep type="acquirer_sim" name="120 Pin Txns Purchase advice Amt $1" id="230fde76-0e9c-4a85-a5f9-0708d5313a3b"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0130"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163307"/>
  <field id="11" value="686655"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="152404008956"/>
  <field id="38" value="785358"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="000329501172040"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163307"/>
  <field id="11" value="686655"/>
  <field id="12" value="163307"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="152404008956"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="000329501172040"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_009_Visa 420 Pin txns Valid Pin 120" searchProperties="true" id="7369cb46-64b1-4a3c-b75d-bbbcc3084c46"><con:settings/><con:testStep type="acquirer_sim" name="120 Pin Txns Purchase advice Amt $1" id="fb776bea-eef6-4273-97da-14800f32d424"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0130"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163307"/>
  <field id="11" value="056920"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="102790623580"/>
  <field id="38" value="552439"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="374551245410212"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163307"/>
  <field id="11" value="056920"/>
  <field id="12" value="163307"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="102790623580"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="374551245410212"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Pin Txns Amt $1" id="1e4d3a31-1171-49d4-afaa-e1dcaec2c14d"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163308"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="102790623580"/>
  <field id="38" value="426046"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="374551245410212"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="012005692002031633071234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163308"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="102790623580"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="374551245410212"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="012005692002031633071234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_010_Visa Balance Inqury Valid Pin 100" searchProperties="true" id="2fb245dd-0e46-4e09-b2dd-8b032c0b9a62"><con:settings/><con:testStep type="acquirer_sim" name="Pin Txns BI Balance Inqury" id="27106221-55eb-4ff6-b2d0-2a79ac4cf921"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="300000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="300000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163308"/>
  <field id="11" value="026962"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="766935014272"/>
  <field id="38" value="051643"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000496000001840C000000049800"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="573169588106747"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="300000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163308"/>
  <field id="11" value="026962"/>
  <field id="12" value="163308"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="766935014272"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="573169588106747"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000496000001840C000000049800"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_011_Visa Balance Inqury Valid Pin 200" searchProperties="true" id="4c839480-0c8c-4ef6-ae13-aedc296045bd"><con:settings/><con:testStep type="acquirer_sim" name="Pin Txns BI Balance Inqury" id="1d007e7b-7b21-42f6-80ff-12c455955aa5"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="300000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="300000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163308"/>
  <field id="11" value="574240"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="848460114124"/>
  <field id="38" value="011329"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000496000001840C000000049800"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="648844956598863"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="300000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163308"/>
  <field id="11" value="574240"/>
  <field id="12" value="163308"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="848460114124"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="648844956598863"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000496000001840C000000049800"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_012_Visa 100 Pin txns Invalid Pin" searchProperties="true" id="2c0a3d81-df89-4144-8efc-19db2e064310"><con:settings/><con:testStep type="acquirer_sim" name="100 Pin Txns Auth Purchase Amt $1" id="7db0bdb2-2ad1-4b6b-8131-b48d9f4b19c3"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163309"/>
  <field id="11" value="985602"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="719967426185"/>
  <field id="38" value="000000"/>
  <field id="39" value="55"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000496000001840C000000049800"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="755972765322902"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163309"/>
  <field id="11" value="985602"/>
  <field id="12" value="163309"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="719967426185"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="755972765322902"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"55"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_013_Visa 200 Pin txns Invalid Pin on Reversal" searchProperties="true" id="f73b66aa-d3a0-4ed1-89fd-4181153f5a7f"><con:settings/><con:testStep type="acquirer_sim" name="200 Pin Txns Auth Purchase Amt $1 valid pin" id="3a77c9cb-8045-4f13-8650-678547382085"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163309"/>
  <field id="11" value="932267"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="294276310841"/>
  <field id="38" value="647503"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000495000001840C000000049700"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="053066574299784"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163309"/>
  <field id="11" value="932267"/>
  <field id="12" value="163309"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="294276310841"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="053066574299784"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000495000001840C000000049700"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Copy of Reversal Pin Txns Amt $1 with invalid pin" id="08696f3b-6500-435e-88d5-af60d9dfe960"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163309"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="294276310841"/>
  <field id="38" value="000000"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000495000001840C000000049700"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="053066574299784"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="020093226702031633091234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163309"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="294276310841"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="053066574299784"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="020093226702031633091234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000495000001840C000000049700"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_014_Visa 100 Pin txns Invalid Pin on Reversal" searchProperties="true" id="d8719eef-99c5-4c95-973e-babc894b289d"><con:settings/><con:testStep type="acquirer_sim" name="100 Pin Txns Auth Purchase Amt $1 with valid pin" id="6ab656b1-d8b6-4475-a6cc-391e3291595f"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163310"/>
  <field id="11" value="032008"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="551928609451"/>
  <field id="38" value="915735"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000494000001840C000000049700"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="542465378734928"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163310"/>
  <field id="11" value="032008"/>
  <field id="12" value="163310"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="551928609451"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="542465378734928"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000494000001840C000000049700"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Pin Txns Amt $1 with invalid pin" id="4018f485-4c0a-453a-95c3-10874fc52446"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163310"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="551928609451"/>
  <field id="38" value="000000"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000494000001840C000000049700"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="542465378734928"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="010003200802031633101234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163310"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="551928609451"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="542465378734928"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="010003200802031633101234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000494000001840C000000049700"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_015_Visa Return Pin txns Valid Pin 200" searchProperties="true" id="8a718c0a-9abc-4bdf-9a42-647677b34734"><con:settings/><con:testStep type="acquirer_sim" name="200 Pin Txns Return Amt $1" id="7a0332b3-98a9-4a96-8b91-176194faabca"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163930"/>
  <field id="11" value="888079"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="610247138405"/>
  <field id="38" value="256321"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000495000001840C000000049900"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="441080996351684"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163930"/>
  <field id="11" value="888079"/>
  <field id="12" value="163930"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="610247138405"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="441080996351684"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000494000001840C000000049800"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_016_Visa Return Pin txns Valid Pin 100" searchProperties="true" id="c7233d3d-43d2-47b3-b12b-cccc20b9aefe"><con:settings/><con:testStep type="acquirer_sim" name="100 Pin Txns Return Amt $1" id="1da09974-4100-43a9-86f0-2074b6ee3a88"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163801"/>
  <field id="11" value="473036"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="378493587744"/>
  <field id="38" value="082907"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000494000001840C000000049800"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="172221971871831"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163801"/>
  <field id="11" value="473036"/>
  <field id="12" value="163801"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="378493587744"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="172221971871831"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000494000001840C000000049800"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:loadTest name="LoadTest 1" id="ee60f87e-6df0-4ade-ae26-2be29cf2a3b5"><con:settings><con:setting id="hasBeenConvertedToLoadUITest">true</con:setting></con:settings><con:threadCount>4</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval><con:reportParameters/></con:loadTest><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_017_Visa Return Pin txns Valid Pin 220" searchProperties="true" id="dc233ef6-e0f6-4620-9fe7-00f44dd20c6b"><con:settings/><con:testStep type="acquirer_sim" name="220 Pin Txns Return Amt $1" id="6a7910a1-0111-4a50-ab7a-891719b5dcbb"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0230"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163314"/>
  <field id="11" value="648048"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="857638822725"/>
  <field id="38" value="666603"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="188654153172120"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163314"/>
  <field id="11" value="648048"/>
  <field id="12" value="163314"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="857638822725"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="188654153172120"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_018_Visa Return Pin txns invalid Pin 120" searchProperties="true" id="5ef6c189-6c8e-490b-940a-6860f24596b5"><con:settings/><con:testStep type="acquirer_sim" name="120 Pin Txns Return Amt $1" id="4bc90922-28ca-4ca0-8b25-19e438dba0c1"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0130"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163314"/>
  <field id="11" value="908258"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="421089005361"/>
  <field id="38" value="009870"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="851958580712516"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163314"/>
  <field id="11" value="908258"/>
  <field id="12" value="163314"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="421089005361"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="ADBF6796155EDDC9" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="851958580712516"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"ADBF6796155EDDC9"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_019_Visa Return Pin txns invalid Pin 200" searchProperties="true" id="fd1dbb5d-2013-4d5a-8df5-745530168d71"><con:settings/><con:testStep type="acquirer_sim" name="200 Pin Txns Return Amt $1" id="c0802a0c-ca4d-47ff-aba5-4e3d92b6f2e0"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203164048"/>
  <field id="11" value="354297"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="330458494175"/>
  <field id="38" value="000000"/>
  <field id="39" value="55"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000495000001840C000000049900"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="742486852000668"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203164048"/>
  <field id="11" value="354297"/>
  <field id="12" value="164048"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="330458494175"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="742486852000668"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"55"},{"field":"54","value":"0002840C0000000492000001840C000000049900"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_020_Visa 120 Pin txns Invalid Pin" searchProperties="true" id="ab50207c-ea43-4553-9b81-11d8919c4765"><con:settings/><con:testStep type="acquirer_sim" name="120 Pin Txns Purchase advice Amt $1 invalid pin" id="0308cf47-0399-4961-9e35-132a8687d525"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0130"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163314"/>
  <field id="11" value="264367"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="303571755256"/>
  <field id="38" value="107210"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="985333290096228"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163314"/>
  <field id="11" value="264367"/>
  <field id="12" value="163314"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="303571755256"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="985333290096228"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_021_Visa 220 Pin txns Invalid Pin" searchProperties="true" id="2ccfc54f-a92e-4edf-9d3f-f90bb1615d64"><con:settings/><con:testStep type="acquirer_sim" name="220 Pin Txns Purchase advice Amt $1 invalid pin" id="625219c4-3a5c-4005-9312-304b509e9ab5"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0230"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163316"/>
  <field id="11" value="937309"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="812812764161"/>
  <field id="38" value="189456"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="564218102959311"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163316"/>
  <field id="11" value="937309"/>
  <field id="12" value="163316"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="812812764161"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="564218102959311"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_022_Visa 420 Pin txns Invalid Pin" searchProperties="true" id="34e54649-f799-447e-a8cc-d3002c69aa83"><con:settings/><con:testStep type="acquirer_sim" name="120 Pin Txns Purchase advice Amt $1 valid pin" id="c2cc93c6-5c62-493a-80e8-0e2642d81117"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0130"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163317"/>
  <field id="11" value="963416"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="572348121167"/>
  <field id="38" value="189886"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="166482686150488"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163317"/>
  <field id="11" value="963416"/>
  <field id="12" value="163317"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="572348121167"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="166482686150488"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Pin Txns Amt $1 wit invalid pin" id="1b68d3f8-721d-4a99-ab2e-efe2572b1790"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163317"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="572348121167"/>
  <field id="38" value="438449"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="166482686150488"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="012096341602031633171234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203163317"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="572348121167"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="ADBF6796155EDDC8" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="166482686150488"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="012096341602031633171234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_023_Visa Return  Reversal Pin txns Valid Pin 100" searchProperties="true" id="dba43f0d-07a5-410d-b0f6-df832e2d0415"><con:settings/><con:testStep type="acquirer_sim" name="100 Pin Txns Return Amt $1" id="dea33191-3f8a-4317-90d8-d8aab94a65c6"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203164209"/>
  <field id="11" value="844937"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="184003346506"/>
  <field id="38" value="907524"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000495000001840C000000049900"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="592890752464768"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203164209"/>
  <field id="11" value="844937"/>
  <field id="12" value="164209"/>
  <field id="13" value="0203"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="184003346506"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="592890752464768"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0003"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Return Reversal Pin Txns Amt $1" id="bffa6c6d-05fb-458b-b273-ed7cc843a004"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="52" value="B8A78B557D2D830E" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E60000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203164222"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="184003346506"/>
  <field id="38" value="000000"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000495000001840C000000049900"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="592890752464768"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="010084493702031642091234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358808639968482"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0203164222"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358808639968482=191112100000100000"/>
  <field id="37" value="184003346506"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="52" value="FC305324A9867560" type="binary"/>
  <field id="53" value="1234567890123456"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="592890752464768"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0003"/>
  </isomsg>
  <field id="90" value="010084493702031642091234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"52","value":"${#TestSuite#PIN}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:properties><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>9999</con:value></con:property><con:property><con:name>Spec</con:name><con:value/></con:property><con:property><con:name>PAN</con:name><con:value>4358808639968482</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358808639968482=191112100000100000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 004</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TotalTxns</con:name><con:value>61</con:value></con:property><con:property><con:name>TotalPassTxns</con:name><con:value>0</con:value></con:property><con:property><con:name>TotalFailTxns</con:name><con:value>0</con:value></con:property><con:property><con:name>PIN</con:name><con:value>FC305324A9867560</con:value></con:property><con:property><con:name>account</con:name><con:value>1000000000000002140</con:value></con:property><con:property><con:name>acct_balance</con:name><con:value>500</con:value></con:property><con:property><con:name>DB_String</con:name><con:value>jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift</con:value></con:property><con:property><con:name>DB_Driver</con:name><con:value>com.mysql.jdbc.Driver</con:value></con:property></con:properties><con:reportParameters/></con:testSuite><con:testSuite name="TS_4_Visa_Restrict MCC" id="7ed31a09-ec4d-477f-adfb-081427121001"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting></con:settings><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_000_Visa Add card and activate" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" disabled="true" id="4d6b511e-2e8d-4571-aabc-8f6b7ae2a12b"><con:settings/><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="b987ff43-7758-4063-8af4-4a063e92982d"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4358804792425709"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="13" value="150420"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675005430"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358804792425709"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="13" value="150420"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675005430"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Copy of Activate Card 100 via UMS" id="186c446f-ed04-49fe-a222-57836f309ad6"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000050000"/>
  <field id="6" value="000000050000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000050000"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="725400"/>
  <field id="4" value="50000"/>
  <field id="6" value="50000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="6012"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"4358801204193933"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"50000"},{"field":"6","value":"50000"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675005430</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.220</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_000_Visa Reset DB and Card Status" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="b01ee1ba-4e5b-4a53-8959-ffa80629b8c2" disabled="true"><con:settings/><con:testStep type="groovy" name="DB update and card reset" id="c56e562d-3561-4170-bd1e-9bc9f76704b0"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null;
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String");
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver");
try{
  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
  con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.testSuite.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]

def res = con.firstRow("SELECT account from card where lastFour=? order by createdDate desc", [lastFour]).account

testRunner.testCase.testSuite.setPropertyValue( "account", res.toString())

def account=testRunner.testCase.testSuite.getPropertyValue("account")
def acct_bal=testRunner.testCase.testSuite.getPropertyValue("acct_balance");
con.execute("update card set status = 'OPEN', statusReason= 'NONE' where account = ?", [account]);

con.execute("UPDATE balance_cache SET balance=? WHERE account=? and layers ='840'",[acct_bal,account]);
con.execute("UPDATE balance_cache SET balance=? WHERE account=? and layers ='840.1840'",[acct_bal, account]);
con.close()</script></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675005430</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.220</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_001_Visa 100 Restricted MCC" searchProperties="true" id="d457c599-3217-407d-ab9b-26cb06b4b724"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="91b34dd8-b7f2-44e1-bc8c-eb7368b670ff"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C90000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150529"/>
  <field id="11" value="280736"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="683996971585"/>
  <field id="38" value="000000"/>
  <field id="39" value="05"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="649499118767062"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150529"/>
  <field id="11" value="280736"/>
  <field id="12" value="150529"/>
  <field id="13" value="0413"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="683996971585"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="649499118767062"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"05"},{"field":"54","value":"0002840C0000000500000001840C000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"18","value":"5542"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_002_Visa 200 Restricted MCC" searchProperties="true" id="3819096d-8ab8-4245-a7af-6d6df49a5083"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="c469836e-b1cc-415b-91d6-5837cd6474e2"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C90000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150529"/>
  <field id="11" value="555963"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="613022812981"/>
  <field id="38" value="000000"/>
  <field id="39" value="05"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="045996807008800"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150529"/>
  <field id="11" value="555963"/>
  <field id="12" value="150529"/>
  <field id="13" value="0413"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="613022812981"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="045996807008800"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"05"},{"field":"54","value":"0002840C0000000500000001840C000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"18","value":"5542"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_003_Visa 400 Reversals 100 non Restrict MCC" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="6a647e23-19c5-4a32-bdfc-6ae24a4e3bd1"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="a511d737-559d-4960-a542-914ff3778ca7"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150530"/>
  <field id="11" value="480303"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="023962067858"/>
  <field id="38" value="881812"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000499000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="631590894355600"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150530"/>
  <field id="11" value="480303"/>
  <field id="12" value="150530"/>
  <field id="13" value="0413"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="023962067858"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="631590894355600"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000499000001840C000000050000"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1 with Restrict MCC" id="7f43e12d-15d1-43de-bb82-7e913e56f84f"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200F10000000000000000000000000000000000</header>
  <field id="0" value="0410"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150530"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="023962067858"/>
  <field id="38" value="226407"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000500000001840C000000050000"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="631590894355600"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010048030304131505301234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0400"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150530"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="023962067858"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="631590894355600"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010048030304131505301234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000500000001840C000000050000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@res37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"18","value":"5411"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358805852157207</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358805852157207=19111210000060000000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_004_Visa 120 Restricted MCC" searchProperties="true" id="f86f19c2-9fef-48aa-a14c-27af33aa7207"><con:settings/><con:testStep type="acquirer_sim" name="Pre Auth Purchase Amt $1" id="069fad76-eea1-40dc-8aa4-2d7f95a99d1d"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0130"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150530"/>
  <field id="11" value="731274"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="462754441940"/>
  <field id="38" value="008902"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="338560061424226"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0120"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150530"/>
  <field id="11" value="731274"/>
  <field id="12" value="150530"/>
  <field id="13" value="0413"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="462754441940"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="338560061424226"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"18","value":"5542"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Auth Completion Amt $1" id="e9274af8-06fb-4745-af1b-fb40f46c16e3"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200A00000000000000000000000000000000000</header>
  <field id="0" value="0230"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150531"/>
  <field id="11" value="044001"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="462754441940"/>
  <field id="38" value="997445"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="916942816508190"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0220"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150531"/>
  <field id="11" value="044001"/>
  <field id="12" value="150531"/>
  <field id="13" value="0413"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="462754441940"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="916942816508190"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"@res37"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"18","value":"5542"},{"field":"2","value":"@res2"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_006_Visa 420 Reversals 100 non Restrict MCC" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="28ea2cb3-3471-4839-ace1-fc5fec1a2286"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="ff633caa-61a6-497d-b149-536a89baebe5"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150531"/>
  <field id="11" value="248809"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="357231253477"/>
  <field id="38" value="248716"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000498000001840C000000049900"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="376384961387490"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150531"/>
  <field id="11" value="248809"/>
  <field id="12" value="150531"/>
  <field id="13" value="0413"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="357231253477"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="376384961387490"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000498000001840C000000049900"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1 with Restrict MCC" id="005dc3b8-6253-4ac3-85b5-69d892ae7534"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150531"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="357231253477"/>
  <field id="38" value="396543"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="376384961387490"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010024880904131505311234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150531"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="357231253477"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="376384961387490"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010024880904131505311234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@res37"},{"field":"2","value":"@res2"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"18","value":"5411"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358805852157207</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358805852157207=19111210000060000000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_007_Visa 100 Non Restricted MCC" searchProperties="true" id="1560c5d7-905e-4823-9881-1493a9ad9795" disabled="true"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="52b433ab-9259-4bcf-b03e-205cf893d33c"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0201141954"/>
  <field id="11" value="950970"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="495280665698"/>
  <field id="38" value="067681"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000496000001840C000000049800"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="209865210783287"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0201141954"/>
  <field id="11" value="950970"/>
  <field id="12" value="141954"/>
  <field id="13" value="0201"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="495280665698"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="209865210783287"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000422000001840C000000049900"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"18","value":"5411"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_008_Visa 200 Non Restricted MCC" searchProperties="true" id="70b07346-766f-42cd-9f74-8e890b529525"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="4f43c807-9338-449e-aca6-aacc2799f08f"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150532"/>
  <field id="11" value="481786"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="623982736401"/>
  <field id="38" value="351710"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000498000001840C000000049800"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="521123372273063"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150532"/>
  <field id="11" value="481786"/>
  <field id="12" value="150532"/>
  <field id="13" value="0413"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="623982736401"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="521123372273063"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000498000001840C000000049800"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"18","value":"5411"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_009_Visa 420 Reversals 100 Non Restrict MCC" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="978fe430-e3da-4787-8831-77eb4695539e" disabled="true"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="21313083-deaf-4eb0-a3b0-17cb8b6b46c3"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200D40000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0201133523"/>
  <field id="11" value="332821"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="492158216936"/>
  <field id="38" value="143626"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <isomsg id="44">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value=" "/>
    <field id="2" value=" "/>
    <field id="3" value=" "/>
    <field id="4" value=" "/>
    <field id="5" value="2"/>
    <field id="6" value="  "/>
    <field id="7" value=" "/>
    <field id="8" value=" "/>
    <field id="9" value=" "/>
  </isomsg>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000418000001840C000000049800"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="983367963751758"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0201133523"/>
  <field id="11" value="332821"/>
  <field id="12" value="133523"/>
  <field id="13" value="0201"/>
  <field id="14" value="1911"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="492158216936"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="983367963751758"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"54","value":"0002840C0000000420000001840C000000049800"},{"field":"44.5","value":"2"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"18","value":"5411"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal Amt $1 with Restrict MCC" id="085313a6-8526-4435-9ae1-62b98477a9fc"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>

  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
    <field id="90" value="020005504708261625120072838400809000000283"/>
   <!-- isomsg id="126">
    <field id="10" value="11 548"/>
  </isomsg -->
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200BD0000000000000000000000000000000000</header>
  <field id="0" value="0430"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0201133524"/>
  <field id="11" value="798868"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="492158216936"/>
  <field id="38" value="850364"/>
  <field id="39" value="00"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="983367963751758"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010033282102011335231234567890112345678901"/>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0420"/>
  <field id="2" value="4358804792425709"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0201133524"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358804792425709=191112100000714000"/>
  <field id="37" value="492158216936"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="983367963751758"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  <field id="90" value="010033282102011335231234567890112345678901"/>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"37","value":"@37"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"90","value":"@req0@req11@req7@req32@req33"},{"field":"62.2","value":"@req62.2"},{"field":"18","value":"5542"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358805852157207</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358805852157207=19111210000060000000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 209</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_010_Visa 100 Balance Inqury with Restrict MCC" searchProperties="true" id="92db2412-72d0-43f2-a986-817d9d11e32e"><con:settings/><con:testStep type="acquirer_sim" name="100 BI Balance Inqury with restrict MCC" id="ff686029-3f29-4a40-8b55-1addbcad6845"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="300000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5411"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C90000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="300000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150532"/>
  <field id="11" value="255709"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="146357477883"/>
  <field id="38" value="000000"/>
  <field id="39" value="05"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000498000001840C000000049800"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="104980581377130"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0100"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="300000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150532"/>
  <field id="11" value="255709"/>
  <field id="12" value="150532"/>
  <field id="13" value="0413"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="146357477883"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="104980581377130"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"05"},{"field":"54","value":"0002840C0000000498000001840C000000049800"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0002"},{"field":"18","value":"5542"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_011_Visa Return with Resrict MCC" searchProperties="true" id="8bbce6ec-1f53-4397-9072-698f9c664097"><con:settings/><con:testStep type="acquirer_sim" name="200 Return Amt $1" id="6f400ecc-b068-4bf1-8b78-72f70cb0d57d"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C90000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150532"/>
  <field id="11" value="915718"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="027010934708"/>
  <field id="38" value="000000"/>
  <field id="39" value="05"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000498000001840C000000049800"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="852152904501213"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0200"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="200000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150532"/>
  <field id="11" value="915718"/>
  <field id="12" value="150532"/>
  <field id="13" value="0413"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="027010934708"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="852152904501213"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"05"},{"field":"54","value":"0002840C0000000498000001840C000000049800"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"63.1","value":"0002"},{"field":"18","value":"5542"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_012_Visa 101 Restricted MCC" searchProperties="true" id="9ce5fe7a-979f-45f3-99bf-6f4dd463267a"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="69b0b1a6-3134-4f94-b907-d2b9368f503e"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0101"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5950"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C90000000000000000000000000000000000</header>
  <field id="0" value="0110"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150533"/>
  <field id="11" value="653722"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="094633532978"/>
  <field id="38" value="000000"/>
  <field id="39" value="05"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000498000001840C000000049800"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="782313607555953"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0101"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150533"/>
  <field id="11" value="653722"/>
  <field id="12" value="150533"/>
  <field id="13" value="0413"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="094633532978"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="782313607555953"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"05"},{"field":"54","value":"0002840C0000000498000001840C000000049800"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"18","value":"5542"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_013_Visa 201 Restricted MCC" searchProperties="true" id="5cd394dd-c4b3-4a35-baf8-9c8029efa124"><con:settings/><con:testStep type="acquirer_sim" name="Auth Purchase Amt $1" id="690f1a1d-3054-435e-95e2-022f4c17edd1"><con:settings/><con:config><specificationType>VISA-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>6000</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0201"/>
  <field id="2" value="4594700522277705"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0730162158"/>
  <field id="11" value="798868"/>
  <field id="12" value="162158"/>
  <field id="13" value="0730"/>
  <field id="14" value="4901"/>
  <field id="15" value="0710"/>
  <field id="18" value="5950"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
   <field id="33" value="12345678901"/>
  <field id="35" value="4594700522277705=49011210000032200000"/>
  <field id="37" value="237039612929"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="826"/>
  <field id="51" value=""/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="123456789019999"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
  </isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200C90000000000000000000000000000000000</header>
  <field id="0" value="0210"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150533"/>
  <field id="11" value="765399"/>
  <field id="15" value="0710"/>
  <field id="19" value="840"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="37" value="473576671408"/>
  <field id="38" value="000000"/>
  <field id="39" value="05"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="54" value="0002840C0000000498000001840C000000049800"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="Y"/>
    <field id="2" value="966058435945784"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>16010200E00000000000000000000000000000000000</header>
  <field id="0" value="0201"/>
  <field id="2" value="4358801204193933"/>
  <field id="3" value="000000"/>
  <field id="4" value="000000000100"/>
  <field id="5" value="000000000100"/>
  <field id="6" value="000000000100"/>
  <field id="7" value="0413150533"/>
  <field id="11" value="765399"/>
  <field id="12" value="150533"/>
  <field id="13" value="0413"/>
  <field id="14" value="2102"/>
  <field id="15" value="0710"/>
  <field id="18" value="5542"/>
  <field id="19" value="840"/>
  <field id="22" value="9020"/>
  <field id="25" value="00"/>
  <field id="32" value="12345678901"/>
  <field id="33" value="12345678901"/>
  <field id="35" value="4358801204193933=210212100000439000"/>
  <field id="37" value="473576671408"/>
  <field id="41" value="TERMID01"/>
  <field id="42" value="CARD ACCEPTOR  "/>
  <field id="43" value="BHN QA Keystone  Automation   US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <field id="59" value="0600094044"/>
  <field id="60" value="42" type="binary"/>
  <isomsg id="62">
    <field id="1" value="Y"/>
    <field id="2" value="966058435945784"/>
  </isomsg>
  <isomsg id="63">
    <field id="1" value="0002"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"05"},{"field":"54","value":"0002840C0000000498000001840C000000049800"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"7","value":"/MMddHHmmss"},{"field":"11","value":"#6"},{"field":"12","value":"/HHmmss"},{"field":"13","value":"/MMdd"},{"field":"37","value":"#12"},{"field":"2","value":"${#TestSuite#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"51","value":"${#TestSuite#TxnCurrency}"},{"field":"35","value":"${#TestSuite#CVV}"},{"field":"62.2","value":"#15"},{"field":"14","value":"${#TestSuite#ExpDate}"},{"field":"18","value":"5542"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers>Y</generateIdentifiers></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804792425709</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358804792425709=191112100000714000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 306</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:properties><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>9999</con:value></con:property><con:property><con:name>Spec</con:name><con:value/></con:property><con:property><con:name>PAN</con:name><con:value>4358801204193933</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>2102</con:value></con:property><con:property><con:name>CVV</con:name><con:value>4358801204193933=210212100000439000</con:value></con:property><con:property><con:name>CVV2</con:name><con:value>11 630</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TotalTxns</con:name><con:value>74</con:value></con:property><con:property><con:name>TotalPassTxns</con:name><con:value>0</con:value></con:property><con:property><con:name>TotalFailTxns</con:name><con:value>0</con:value></con:property><con:property><con:name>account</con:name><con:value>1000000000000006011</con:value></con:property><con:property><con:name>acct_balance</con:name><con:value>500</con:value></con:property><con:property><con:name>DB_String</con:name><con:value>jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift</con:value></con:property><con:property><con:name>DB_Driver</con:name><con:value>com.mysql.jdbc.Driver</con:value></con:property></con:properties><con:reportParameters/></con:testSuite><con:testSuite name="TS_6_UMS Regression Test for IGift" id="31d2b89e-995c-4666-aadf-c81e9688f27f"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_001_UMS Activation with Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="a53c702b-527c-4401-8adb-52e3245b70ba"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="05150df2-890c-4abf-b651-ecdd09cadb52"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="d6051e51-7794-496e-a022-51acb4ca2288"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594702815154772"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594702815154772"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="f700f58f-80be-44fa-94fc-394a40b174a9"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
com.eviware.soapui.support.GroovyUtils.registerJdbcDriver( "com.mysql.jdbc.Driver" );
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="1a4a4a33-a5eb-4d6f-870a-218eb4339feb"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001083661849"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001083661849=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="2JJHWU21D8JA40QK3RDIGL9857"/>
    <field id="19" value="2JJHWU21D8JA40QK3RDIGL9857"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001083661849"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001083661849=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="2JJHWU21D8JA40QK3RDIGL9857"/>
    <field id="19" value="2JJHWU21D8JA40QK3RDIGL9857"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"5000"},{"field":"6","value":"5000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594702815154772</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>826</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>826</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675009844</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>459470</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001083661849</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001083661849=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>2JJHWU21D8JA40QK3RDIGL9857</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_002_UMS Activation Rev with Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="ec04e8b6-d5d6-4faf-9954-07ac0cd62ef7"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="e4b3f64b-1287-4f38-b459-8ae49dc91719"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="0cc3f720-c66c-4b15-95dd-10d353ef0ec0"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594708215157966"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594708215157966"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="9ac07646-466f-44c8-b339-bb9335ef19fa"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
com.eviware.soapui.support.GroovyUtils.registerJdbcDriver( "com.mysql.jdbc.Driver" );
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="0c8775a4-031c-4c4d-a1a4-ae162bbb66da"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001031059665"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001031059665=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="L0MZ54C74PKD5N4YFCKBHALFGK"/>
    <field id="19" value="L0MZ54C74PKD5N4YFCKBHALFGK"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001031059665"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001031059665=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="L0MZ54C74PKD5N4YFCKBHALFGK"/>
    <field id="19" value="L0MZ54C74PKD5N4YFCKBHALFGK"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"5000"},{"field":"6","value":"5000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="0cddad8e-34df-4261-98eb-7167b930749f"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039536001031059665"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001031059665=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="L0MZ54C74PKD5N4YFCKBHALFGK"/>
    <field id="19" value="L0MZ54C74PKD5N4YFCKBHALFGK"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039536001031059665"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001031059665=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="L0MZ54C74PKD5N4YFCKBHALFGK"/>
    <field id="19" value="L0MZ54C74PKD5N4YFCKBHALFGK"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"5000"},{"field":"6","value":"5000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594708215157966</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675009844</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>459470</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001031059665</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001031059665=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>L0MZ54C74PKD5N4YFCKBHALFGK</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_003_UMS Activation without Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="929653c8-56e6-4f37-b1f7-814291db1c42"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="615696c8-2cb9-4da0-984b-4a595ed8a4d3"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="f2eb63f1-9794-4105-aa54-2e49720a4363"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594700330080599"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594700330080599"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="da6ebe60-a2d0-4ac4-8601-e77c0662d131"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="e5c6626b-2173-44e6-9540-de2c3d322776"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001119956492"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="24XLLOKKZKK0ZZ321XRPXAR9GR"/>
    <field id="19" value="24XLLOKKZKK0ZZ321XRPXAR9GR"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001119956492"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="24XLLOKKZKK0ZZ321XRPXAR9GR"/>
    <field id="19" value="24XLLOKKZKK0ZZ321XRPXAR9GR"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"5000"},{"field":"6","value":"5000"},{"field":"22","value":"011"},{"field":"35","value":"DEL"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594700330080599</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001119956492</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001119956492=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>24XLLOKKZKK0ZZ321XRPXAR9GR</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_004_UMS Activation Rev without Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="4d4fceb0-6e3d-423d-a1eb-45732d9d2f0b"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="31eecd71-e9cb-4426-ba12-1a1d123e1030"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="172958a2-3f85-4b1f-b0c1-4d9e24065d51"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594704578518802"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594704578518802"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="70a27311-71d7-4c8b-a608-387a89b68279"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="3298652c-eac5-49f0-ac2b-0b2a589cfe3c"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001733634321"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="BJY9CPC7F6LGD0TKSN5IVD6BUY"/>
    <field id="19" value="BJY9CPC7F6LGD0TKSN5IVD6BUY"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001733634321"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="BJY9CPC7F6LGD0TKSN5IVD6BUY"/>
    <field id="19" value="BJY9CPC7F6LGD0TKSN5IVD6BUY"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"5000"},{"field":"6","value":"5000"},{"field":"22","value":"011"},{"field":"35","value":"DEL"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="fafe3390-fae2-4a23-8861-b09b103ea11f"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039536001733634321"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="BJY9CPC7F6LGD0TKSN5IVD6BUY"/>
    <field id="19" value="BJY9CPC7F6LGD0TKSN5IVD6BUY"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039536001733634321"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="BJY9CPC7F6LGD0TKSN5IVD6BUY"/>
    <field id="19" value="BJY9CPC7F6LGD0TKSN5IVD6BUY"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"0","value":"420"},{"field":"22","value":"011"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"DEL"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594704578518802</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001733634321</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001733634321=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>BJY9CPC7F6LGD0TKSN5IVD6BUY</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_005_UMS Activation with Decimals" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" disabled="true" id="3c38c4e1-a311-406c-9d57-7db44681e6b0"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="d7e37d79-0b6c-433d-89f8-2d4fe1979885"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="61eb4f4f-c6d9-4f46-85af-c29e1932c4de"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4358807151007053"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358807151007053"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="da1d64f8-7b02-4302-9630-0dc7c59bb58f"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
// def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")

def con = Sql.newInstance(db_string, db_driver);
//def con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");

log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100.01 via UMS" id="a3575790-6607-4b4b-b8dc-e80abaf72cf9"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110432139795"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110432139795=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675012176"/>
    <field id="3" value="C000000010001"/>
    <field id="18" value="V9B8HFGTRS1ZV56Y8H7NR4Y3GO"/>
    <field id="19" value="V9B8HFGTRS1ZV56Y8H7NR4Y3GO"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110432139795"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110432139795=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675012176"/>
    <field id="18" value="V9B8HFGTRS1ZV56Y8H7NR4Y3GO"/>
    <field id="19" value="V9B8HFGTRS1ZV56Y8H7NR4Y3GO"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010001"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358807151007053</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675012176</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>435880</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539110432139795</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539110432139795=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>V9B8HFGTRS1ZV56Y8H7NR4Y3GO</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_006_UMS Activation Rev with Decimals" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" disabled="true" id="76b9e50b-21d1-4bb8-96f9-9ee52d211db9"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="f1e90b0b-6d6b-494e-b90a-dc7fb0e3df05"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="3c4b123a-7347-4560-807b-5aff280ccc59"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4358806350109962"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358806350109962"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="2c5fb1b1-40fe-4719-9b2b-7db97aa84fbe"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100.01 via UMS" id="90a87f4b-bb16-43f0-97d4-1d35f861d7cb"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110264492645"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110264492645=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675012176"/>
    <field id="3" value="C000000010001"/>
    <field id="18" value="9NR63HXX14JTJHJK0I9JPNVXIJ"/>
    <field id="19" value="9NR63HXX14JTJHJK0I9JPNVXIJ"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110264492645"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110264492645=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675012176"/>
    <field id="18" value="9NR63HXX14JTJHJK0I9JPNVXIJ"/>
    <field id="19" value="9NR63HXX14JTJHJK0I9JPNVXIJ"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010001"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="a6c6a69f-b48d-40ff-baf7-862c09f3006f"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110264492645"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110264492645=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675012176"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="9NR63HXX14JTJHJK0I9JPNVXIJ"/>
    <field id="19" value="9NR63HXX14JTJHJK0I9JPNVXIJ"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110264492645"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110264492645=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675012176"/>
    <field id="18" value="9NR63HXX14JTJHJK0I9JPNVXIJ"/>
    <field id="19" value="9NR63HXX14JTJHJK0I9JPNVXIJ"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358806350109962</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675012176</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>435880</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539110264492645</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539110264492645=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>9NR63HXX14JTJHJK0I9JPNVXIJ</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_007_UMS Activation with cardnumber" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="2aec2209-a845-4eda-ba6d-18405cfbc6c9"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="d91694fb-a78c-4a99-a59d-e0800cba5e6e"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="8e4a90ab-279c-460d-9ade-ab365035b243"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594704317776404"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594704317776404"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="c38a1776-1958-4e88-a14b-ed656ffaeff2"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="68b41623-d590-414a-9274-cbcc2f196065"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="4594704317776404"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001395809053=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="LRJ5F2H4S1CLSVDDCUQ6WRRLBK"/>
    <field id="19" value="LRJ5F2H4S1CLSVDDCUQ6WRRLBK"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="4594704317776404"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001395809053=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="LRJ5F2H4S1CLSVDDCUQ6WRRLBK"/>
    <field id="19" value="LRJ5F2H4S1CLSVDDCUQ6WRRLBK"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594704317776404</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001395809053</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001395809053=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>LRJ5F2H4S1CLSVDDCUQ6WRRLBK</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_008_UMS Activation Rev with card number" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="46f39c66-9df0-4d61-94a6-b485299ed138"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="3316abcb-c72c-4036-9888-f2a2f16caa67"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="350f4d62-fa22-40d6-861f-1087fcec04ea"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594706675057964"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594706675057964"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="a759f205-3229-4143-b429-b2fb9ad6479e"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
    con = Sql.newInstance(db_string, db_driver); 
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="fad0e529-756a-47ea-ba67-802d66b2fc08"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001619345650"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001619345650=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="QUU08G7AQMQ9RTCJ2LFUF6FIA5"/>
    <field id="19" value="QUU08G7AQMQ9RTCJ2LFUF6FIA5"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001619345650"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001619345650=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="QUU08G7AQMQ9RTCJ2LFUF6FIA5"/>
    <field id="19" value="QUU08G7AQMQ9RTCJ2LFUF6FIA5"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="b697e393-85fd-4d5b-b0f4-4fe9eda5b475"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="4594706675057964"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001619345650=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="QUU08G7AQMQ9RTCJ2LFUF6FIA5"/>
    <field id="19" value="QUU08G7AQMQ9RTCJ2LFUF6FIA5"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="4594706675057964"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001619345650=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="QUU08G7AQMQ9RTCJ2LFUF6FIA5"/>
    <field id="19" value="QUU08G7AQMQ9RTCJ2LFUF6FIA5"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594706675057964</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001619345650</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001619345650=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>QUU08G7AQMQ9RTCJ2LFUF6FIA5</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_009_UMS Activation with incorrect exp date" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="ba269dc0-e348-4ea6-809d-c8d62d814294"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="43c8cf0e-1922-4df2-9a20-d02fe0aa6ff7"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="d19c134b-6aca-4ff3-bbfe-28653225cc2f"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594702018592934"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594702018592934"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="031b7bac-0459-48b9-9ff9-f704509f3e04"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="37b494a8-0dda-45df-accf-543f69c2ec34"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001404967606"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001404967606=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="ADWCS3NZH95INSPT15X0DN44JA"/>
    <field id="19" value="ADWCS3NZH95INSPT15X0DN44JA"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001404967606"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001404967606=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="ADWCS3NZH95INSPT15X0DN44JA"/>
    <field id="19" value="ADWCS3NZH95INSPT15X0DN44JA"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"14","value":"1811"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594702018592934</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001404967606</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001404967606=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>ADWCS3NZH95INSPT15X0DN44JA</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>30f4c4de-251f-45bb-96a4-5424057f9d44</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>ccc1786e-ea19-4497-b91e-350f0a7ba85c</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>b0a566f1-9608-46c4-9763-8e9eb51a7ee7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>20076cf5-d5ce-4b75-8e9b-3913ad592439</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_010_UMS Activation Rev with incorrect exp date" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="4a02e08d-886b-488e-9767-a989a917636a"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="5e0ee47f-a6e2-43a2-9aac-35ba05d1306c"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="18dfaa79-8c97-4c32-bb04-e04ebeb5d08b"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594706483447456"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594706483447456"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="54a6b292-ea44-49d8-808f-92a586fbc25d"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="b8295c93-b983-4480-8fd8-f88ddfe6a05b"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/> 
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001085171482"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1810"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001085171482=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="LIP08PHFGFQDS2ENMCTK4P2AK8"/>
    <field id="19" value="LIP08PHFGFQDS2ENMCTK4P2AK8"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001085171482"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1810"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001085171482=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="LIP08PHFGFQDS2ENMCTK4P2AK8"/>
    <field id="19" value="LIP08PHFGFQDS2ENMCTK4P2AK8"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"14","value":"1810"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="7ecfce6a-339b-4212-ac93-dc4f4ff16155"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0420"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039536001085171482"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001085171482=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="LIP08PHFGFQDS2ENMCTK4P2AK8"/>
    <field id="19" value="LIP08PHFGFQDS2ENMCTK4P2AK8"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039536001085171482"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001085171482=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="LIP08PHFGFQDS2ENMCTK4P2AK8"/>
    <field id="19" value="LIP08PHFGFQDS2ENMCTK4P2AK8"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594706483447456</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001085171482</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001085171482=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>LIP08PHFGFQDS2ENMCTK4P2AK8</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_011_UMS Activation with mode 011 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="08cea222-243d-4989-be93-91c26e586883"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="954a2956-b5a8-43b3-b875-d2e08dac634c"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="3f1e324c-3919-43f5-a2ef-e30dcb998fe3"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594704452893883"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594704452893883"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="2b089a6b-13c3-4661-bcd7-2a9d3345ab12"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="ad80426e-c9ab-4b90-8609-807dbe22e764"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001494914403"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001494914403=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="NCWFIZR54KM5OA9O7FJ5N9QLCZ"/>
    <field id="19" value="NCWFIZR54KM5OA9O7FJ5N9QLCZ"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001494914403"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001494914403=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="NCWFIZR54KM5OA9O7FJ5N9QLCZ"/>
    <field id="19" value="NCWFIZR54KM5OA9O7FJ5N9QLCZ"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"22","value":"011"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594704452893883</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001494914403</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001494914403=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>NCWFIZR54KM5OA9O7FJ5N9QLCZ</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_012_UMS Activation Rev with mode 011 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="ba98d25b-c04e-40c1-8457-247ba1ef71c4"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="311fe231-9bed-41e1-855e-e95cf99c2b9b"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="983fde44-7417-4c1c-9f73-e6fd3b32de96"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594701339617293"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594701339617293"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="89ca61ab-0f44-4f85-bb81-310cbeb61864"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="54acc260-af7a-46f0-ae1b-0353e368af02"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001461479218"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001461479218=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="4WAS0QOUV0Y84LFRGTI3DP0D2Q"/>
    <field id="19" value="4WAS0QOUV0Y84LFRGTI3DP0D2Q"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001461479218"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001461479218=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="4WAS0QOUV0Y84LFRGTI3DP0D2Q"/>
    <field id="19" value="4WAS0QOUV0Y84LFRGTI3DP0D2Q"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"22","value":"011"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="8e93af1c-c8c2-4f1b-98ee-e074123cc885"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039536001461479218"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001461479218=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="4WAS0QOUV0Y84LFRGTI3DP0D2Q"/>
    <field id="19" value="4WAS0QOUV0Y84LFRGTI3DP0D2Q"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039536001461479218"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001461479218=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="4WAS0QOUV0Y84LFRGTI3DP0D2Q"/>
    <field id="19" value="4WAS0QOUV0Y84LFRGTI3DP0D2Q"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"0","value":"420"},{"field":"22","value":"011"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594701339617293</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001461479218</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001461479218=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>4WAS0QOUV0Y84LFRGTI3DP0D2Q</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_013_UMS Activation with mode 031 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="229c2c18-2240-485d-a71d-01f882e62b2b"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="9c87c94d-1d93-4a1d-a1fc-889e521582c8"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="1f041dea-cf47-4674-b0d6-c61977091a57"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594703494650460"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594703494650460"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="3fdbe17f-02ec-45df-95cb-ff9bf75853b7"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
com.eviware.soapui.support.GroovyUtils.registerJdbcDriver( "com.mysql.jdbc.Driver" );
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="d687683b-f6c8-4675-99e5-fb00e541b033"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001141300949"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001141300949=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="EFGT8ZB5AWPVADODGQJQ86GGI6"/>
    <field id="19" value="EFGT8ZB5AWPVADODGQJQ86GGI6"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001141300949"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001141300949=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="EFGT8ZB5AWPVADODGQJQ86GGI6"/>
    <field id="19" value="EFGT8ZB5AWPVADODGQJQ86GGI6"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"22","value":"031"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594703494650460</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001141300949</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001141300949=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>EFGT8ZB5AWPVADODGQJQ86GGI6</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_014_UMS Activation Rev with mode 031 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="6125c5ff-2e08-4843-9e9d-1dd9f656e3e8"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="e8b0bb7d-ee8e-4c5d-8ae5-c65734f51a38"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="71929f23-564b-4cd5-b4cb-e5c8c36059c4"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594706600657596"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594706600657596"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="f9bb8963-4508-4838-a271-cf3460eed6f8"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
com.eviware.soapui.support.GroovyUtils.registerJdbcDriver( "com.mysql.jdbc.Driver" );
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="babbcf46-8804-40f4-b226-936a2f4bcef7"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001024036576"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001024036576=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="HDPTUFU7WLPAGF9MITRENOBXIA"/>
    <field id="19" value="HDPTUFU7WLPAGF9MITRENOBXIA"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001024036576"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001024036576=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="HDPTUFU7WLPAGF9MITRENOBXIA"/>
    <field id="19" value="HDPTUFU7WLPAGF9MITRENOBXIA"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"22","value":"031"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="927d3d40-afb9-4e69-ba7b-fb6207522493"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039536001024036576"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001024036576=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="HDPTUFU7WLPAGF9MITRENOBXIA"/>
    <field id="19" value="HDPTUFU7WLPAGF9MITRENOBXIA"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039536001024036576"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001024036576=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="HDPTUFU7WLPAGF9MITRENOBXIA"/>
    <field id="19" value="HDPTUFU7WLPAGF9MITRENOBXIA"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594706600657596</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001024036576</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001024036576=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>HDPTUFU7WLPAGF9MITRENOBXIA</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_015_UMS Activation with mode 032 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="f8e57ae3-847d-4544-8f3d-0d467b0e003b"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="d4907e1a-42c3-49a8-8aea-6750213a71a4"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="83667939-aa25-488f-b448-09e56b995ea7"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594703001436774"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594703001436774"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="30a81d2f-7ed9-495e-89ac-582905a184d0"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
com.eviware.soapui.support.GroovyUtils.registerJdbcDriver( "com.mysql.jdbc.Driver" );
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="dba98877-15d1-47e6-95f0-65e1f1745bea"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001407227187"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001407227187=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="QKTZVKWN0OUXD7ICAUGDIHG70L"/>
    <field id="19" value="QKTZVKWN0OUXD7ICAUGDIHG70L"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001407227187"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001407227187=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="QKTZVKWN0OUXD7ICAUGDIHG70L"/>
    <field id="19" value="QKTZVKWN0OUXD7ICAUGDIHG70L"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"22","value":"032"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594703001436774</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001407227187</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001407227187=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>QKTZVKWN0OUXD7ICAUGDIHG70L</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_016_UMS Activation Rev with mode 032 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="707b5ab1-c837-43f9-b383-70941425f0ea"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="f8480777-a662-4878-86d9-245eed4f15a7"><con:settings/><con:config><script>def bin_range=testRunner.testCase.testSuite.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="9caa8827-6909-4226-8f1f-ca9b1cb28e82"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4594702116082334"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4594702116082334"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675009844"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestSuite#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="52dce718-d4ec-49fa-a4a5-c65373b7d985"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
com.eviware.soapui.support.GroovyUtils.registerJdbcDriver( "com.mysql.jdbc.Driver" );
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="f7ebf2e4-9a8f-4a40-b95a-5a114a99ebdf"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039536001566318047"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001566318047=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="G6EC7AEIGX5LZ1DROCVCL0OLC0"/>
    <field id="19" value="G6EC7AEIGX5LZ1DROCVCL0OLC0"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039536001566318047"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001566318047=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="G6EC7AEIGX5LZ1DROCVCL0OLC0"/>
    <field id="19" value="G6EC7AEIGX5LZ1DROCVCL0OLC0"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000005000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"22","value":"032"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="f27f62ec-2101-407a-a079-75a71119f692"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039536001566318047"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000005000"/>
  <field id="6" value="000000005000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001566318047=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675009844"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="G6EC7AEIGX5LZ1DROCVCL0OLC0"/>
    <field id="19" value="G6EC7AEIGX5LZ1DROCVCL0OLC0"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039536001566318047"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039536001566318047=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="826"/>
  <field id="51" value="826"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675009844"/>
    <field id="18" value="G6EC7AEIGX5LZ1DROCVCL0OLC0"/>
    <field id="19" value="G6EC7AEIGX5LZ1DROCVCL0OLC0"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestSuite#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"${#TestSuite#LoadAmt}"},{"field":"6","value":"${#TestSuite#LoadAmt}"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4594702116082334</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039536001566318047</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039536001566318047=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>G6EC7AEIGX5LZ1DROCVCL0OLC0</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_017_UMS Activation with mode 041 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="dbf9672b-62b6-4cad-ac2a-6721df50b0ff"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="56911822-4ef2-45f1-958f-f57633be4c1b"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="d91ef074-8532-4686-98e5-f8b855a68a78"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543168944434233"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543168944434233"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="3303e340-cbbf-4af0-9dab-dff92ec47d97"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="d41970f6-f034-4956-acb8-ea1e194f9575"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212721400405"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212721400405=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="U9UIBJZ9EC4H7JVYMZ7KZOJTF6"/>
    <field id="19" value="U9UIBJZ9EC4H7JVYMZ7KZOJTF6"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212721400405"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212721400405=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="U9UIBJZ9EC4H7JVYMZ7KZOJTF6"/>
    <field id="19" value="U9UIBJZ9EC4H7JVYMZ7KZOJTF6"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543168944434233</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212721400405</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212721400405=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>U9UIBJZ9EC4H7JVYMZ7KZOJTF6</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_018_UMS Activation Rev with mode 041 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="e0fe78d2-1659-4c8c-b91a-f0c145d52bb8"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="908f7ce5-c89d-48c7-9bf9-81460b52a6f4"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="abdd289f-7902-4356-b2f9-6b62aaf4a46c"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543160480192761"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543160480192761"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="acaacf68-bfc9-45da-92e2-77a5470936e9"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="06fb1dd8-c624-43b1-bdbd-1bbd47b485f0"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212054186572"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212054186572=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="MJOQVKUMQUNLMGF8M8IO9214HY"/>
    <field id="19" value="MJOQVKUMQUNLMGF8M8IO9214HY"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212054186572"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212054186572=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="MJOQVKUMQUNLMGF8M8IO9214HY"/>
    <field id="19" value="MJOQVKUMQUNLMGF8M8IO9214HY"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="9159a698-3421-4e39-b758-3d95747d6c47"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212054186572"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212054186572=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="MJOQVKUMQUNLMGF8M8IO9214HY"/>
    <field id="19" value="MJOQVKUMQUNLMGF8M8IO9214HY"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212054186572"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212054186572=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="MJOQVKUMQUNLMGF8M8IO9214HY"/>
    <field id="19" value="MJOQVKUMQUNLMGF8M8IO9214HY"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543160480192761</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212054186572</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212054186572=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>MJOQVKUMQUNLMGF8M8IO9214HY</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_019_UMS Activation with mode 041 and incorrect track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="40e1d0e3-ca51-4d7a-8b94-d88117573062"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="0b3a8e55-5ec7-40b4-8e80-c1925767301c"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="636bb224-e10d-4243-bb80-fc436d44bce3"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543160789844579"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543160789844579"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="7443cbde-8285-4370-82d2-f6a1b48fe56d"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="6beabceb-f6b9-41aa-a5eb-44b57f3bda6f"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212478907932"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="MOWRXOC3OKASHKZ20CAJTAHYP8"/>
    <field id="19" value="MOWRXOC3OKASHKZ20CAJTAHYP8"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212478907932"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="MOWRXOC3OKASHKZ20CAJTAHYP8"/>
    <field id="19" value="MOWRXOC3OKASHKZ20CAJTAHYP8"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543160789844579</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212478907932</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212478907932=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>MOWRXOC3OKASHKZ20CAJTAHYP8</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_020_UMS Activation Rev with mode 041 and incorrect  track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="ca52f7fc-eb40-46d1-abb9-7e0ac060650a"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="9fa0e485-44a5-4f25-84ec-1246b51204f6"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="0f30a8ab-ea7a-44df-a24d-56c01468b4d8"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543160896658045"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543160896658045"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="de8fec40-1708-48ea-9371-1b7af9d14f4c"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="13299393-74cd-4e22-9ceb-b61048ebe000"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212097637147"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="4KTJ631RO1Y4ZEBZEGT75S671Y"/>
    <field id="19" value="4KTJ631RO1Y4ZEBZEGT75S671Y"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212097637147"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="4KTJ631RO1Y4ZEBZEGT75S671Y"/>
    <field id="19" value="4KTJ631RO1Y4ZEBZEGT75S671Y"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="e60d3cca-4787-4dd9-a637-8f08555ee200"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212097637147"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212097637147=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="4KTJ631RO1Y4ZEBZEGT75S671Y"/>
    <field id="19" value="4KTJ631RO1Y4ZEBZEGT75S671Y"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212097637147"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212097637147=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="4KTJ631RO1Y4ZEBZEGT75S671Y"/>
    <field id="19" value="4KTJ631RO1Y4ZEBZEGT75S671Y"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543160896658045</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212097637147</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212097637147=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>4KTJ631RO1Y4ZEBZEGT75S671Y</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_021_UMS Activation with PAN inTrack2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="de50c3a2-33b2-4b60-ab3f-0a90dbfb660f"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="c3b1d8f2-dba9-4168-8f57-04a976cfad45"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="54f8460e-8fde-40ba-ba17-c48677186211"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164621395065"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164621395065"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="46a7f91f-e2a1-4580-9b3e-52c9883fed71"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="dd60ef64-27db-43c0-ac98-dd2c1c8819b1"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="04	1"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212489842536"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543164621395065=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="KVIRJQO52CIPKY7WRRDZSSDQYM"/>
    <field id="19" value="KVIRJQO52CIPKY7WRRDZSSDQYM"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212489842536"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543164621395065=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="KVIRJQO52CIPKY7WRRDZSSDQYM"/>
    <field id="19" value="KVIRJQO52CIPKY7WRRDZSSDQYM"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164621395065</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212489842536</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212489842536=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>KVIRJQO52CIPKY7WRRDZSSDQYM</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_022_UMS Activation Rev with PAN in Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="8e8817d1-cd6b-4473-86e2-899af58bdb35"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="d67281c9-56bc-4b46-a46c-2ac645d19e87"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="a5cc25cc-157a-454b-9ff1-8f423f9e1ab6"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166976634040"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166976634040"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="1434aeae-deca-44f4-ac4c-e49568213cb2"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="5eaca9da-0d93-4017-9a65-d6303347d10f"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212323873403"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543166976634040=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="H0H4ZPPOZYC5KLA2WLZZNHS139"/>
    <field id="19" value="H0H4ZPPOZYC5KLA2WLZZNHS139"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212323873403"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543166976634040=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="H0H4ZPPOZYC5KLA2WLZZNHS139"/>
    <field id="19" value="H0H4ZPPOZYC5KLA2WLZZNHS139"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="e6386e56-adc1-459c-be08-7737a99cb0f8"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212323873403"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543166976634040=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="H0H4ZPPOZYC5KLA2WLZZNHS139"/>
    <field id="19" value="H0H4ZPPOZYC5KLA2WLZZNHS139"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212323873403"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543166976634040=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="H0H4ZPPOZYC5KLA2WLZZNHS139"/>
    <field id="19" value="H0H4ZPPOZYC5KLA2WLZZNHS139"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"041"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166976634040</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212323873403</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212323873403=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>H0H4ZPPOZYC5KLA2WLZZNHS139</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_023_UMS Activation with mode 041 and incorrect track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="f02f72bd-4920-4ecb-815e-d7ab06df1292"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="2867e0e9-23f2-432f-9d85-0f16773506e0"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="acb135a3-9c3e-46a6-9915-7814e647f4b0"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166547200410"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166547200410"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="1f4244ae-e171-4b6f-a64d-fc958c0adee2"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="fb141e48-e884-4fdb-950c-c77879f391ed"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212032538416"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212032538416=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="WX5ACEH5ONCXCVKVJKOSE8WS0S"/>
    <field id="19" value="WX5ACEH5ONCXCVKVJKOSE8WS0S"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212032538416"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212032538416=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="WX5ACEH5ONCXCVKVJKOSE8WS0S"/>
    <field id="19" value="WX5ACEH5ONCXCVKVJKOSE8WS0S"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#proxyCardNumber}=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166547200410</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212032538416</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212032538416=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>WX5ACEH5ONCXCVKVJKOSE8WS0S</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_024_UMS Activation Rev with mode 041 and incorrect  track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="e934d002-f243-4f1a-bf0a-d4d965c6c916"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="5faf60cf-01e0-4204-82e5-b95cd2decf29"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="0e44ec48-805c-450e-b14e-fe2e54dcd177"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543163452018557"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543163452018557"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="fe617a67-ef24-4fc1-bf79-d044eda25471"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="a2d47624-3023-4ba0-8ee6-27c5f66319cc"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212164156996"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212164156996=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="T6QI35H9KCG5B0SVUCOR7YBZ2U"/>
    <field id="19" value="T6QI35H9KCG5B0SVUCOR7YBZ2U"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212164156996"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212164156996=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="T6QI35H9KCG5B0SVUCOR7YBZ2U"/>
    <field id="19" value="T6QI35H9KCG5B0SVUCOR7YBZ2U"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#proxyCardNumber}=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="ed0dd2e8-4571-477c-90e9-1f8dabaa10d4"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212164156996"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212164156996=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="T6QI35H9KCG5B0SVUCOR7YBZ2U"/>
    <field id="19" value="T6QI35H9KCG5B0SVUCOR7YBZ2U"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212164156996"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212164156996=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="T6QI35H9KCG5B0SVUCOR7YBZ2U"/>
    <field id="19" value="T6QI35H9KCG5B0SVUCOR7YBZ2U"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543163452018557</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212164156996</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212164156996=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>T6QI35H9KCG5B0SVUCOR7YBZ2U</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_025_UMS SAF Activation with Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="afba3a24-2611-4498-bf9c-472d4502feff"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="14de7d3e-54c8-4cb9-876c-443ca09ef373"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="e2de51b5-da03-4165-b6d6-3bb29d5e06c4"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543161086607945"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543161086607945"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="d2559577-087f-45d8-bc91-801b447409d0"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="20bc3c50-df9c-4938-8ac1-fd960fd6bc82"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="022	0"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212772477759"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212772477759=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="PDDZ2KDLLFBV4GPF47YDUATKKG"/>
    <field id="19" value="PDDZ2KDLLFBV4GPF47YDUATKKG"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212772477759"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212772477759=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="PDDZ2KDLLFBV4GPF47YDUATKKG"/>
    <field id="19" value="PDDZ2KDLLFBV4GPF47YDUATKKG"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543161086607945</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212772477759</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212772477759=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>PDDZ2KDLLFBV4GPF47YDUATKKG</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_026_UMS SAF Activation Rev with Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="54971d3b-21b3-477a-b266-72cba170d6fb"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="d2427c0b-e228-4aa9-ae4e-2b715effeb77"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="7f9e1b13-31fe-4b46-b715-c2f8f4c14181"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164142738778"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164142738778"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="713c6c2e-e2d7-4b13-b6eb-42622c2db33e"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="496f42c0-a24d-41fe-92a2-adb16c241008"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212234968212"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212234968212=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="6SNMIU87AY2LOMV455GI6EJCYK"/>
    <field id="19" value="6SNMIU87AY2LOMV455GI6EJCYK"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212234968212"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212234968212=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="6SNMIU87AY2LOMV455GI6EJCYK"/>
    <field id="19" value="6SNMIU87AY2LOMV455GI6EJCYK"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="25b69de5-029d-473a-972b-d8b3d5c8103c"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212234968212"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212234968212=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="6SNMIU87AY2LOMV455GI6EJCYK"/>
    <field id="19" value="6SNMIU87AY2LOMV455GI6EJCYK"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212234968212"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212234968212=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="6SNMIU87AY2LOMV455GI6EJCYK"/>
    <field id="19" value="6SNMIU87AY2LOMV455GI6EJCYK"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164142738778</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212234968212</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212234968212=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>6SNMIU87AY2LOMV455GI6EJCYK</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_027_UMS SAF Activation without Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="16cb25e5-d98d-4b9d-bb23-3e112816e140"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="1c478a0a-7bba-409e-bf42-3e56f8c0c0e6"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="49269cc0-1598-4319-9da8-8543e86f5823"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166095111550"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166095111550"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="ef16e3eb-8567-4cbf-b4a6-dbd307fa6360"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="e413f09a-f340-4724-be43-f0e3b80828cf"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212064660449"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="JW2VKSRTVBVJD6VDUGLMGMAV9W"/>
    <field id="19" value="JW2VKSRTVBVJD6VDUGLMGMAV9W"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212064660449"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="JW2VKSRTVBVJD6VDUGLMGMAV9W"/>
    <field id="19" value="JW2VKSRTVBVJD6VDUGLMGMAV9W"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"DEL"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166095111550</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212064660449</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212064660449=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>JW2VKSRTVBVJD6VDUGLMGMAV9W</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_028_UMS SAF Activation Rev without Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="a2bb5340-b2e2-4f86-80d4-f92adffe31a0"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="90c3e425-9813-4389-bc5e-a7611d20b47f"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="e78dc165-35e2-45ab-8a83-6150a751ed54"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166370288425"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166370288425"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="9bb45cdb-f6e2-4592-b6e0-4567ff848aca"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="b7fe8d8f-e2ad-49eb-a7a9-194edc6b93eb"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212843211786"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="XO1QNZ4BVI3NNOPFV7B00KH1TX"/>
    <field id="19" value="XO1QNZ4BVI3NNOPFV7B00KH1TX"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212843211786"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="XO1QNZ4BVI3NNOPFV7B00KH1TX"/>
    <field id="19" value="XO1QNZ4BVI3NNOPFV7B00KH1TX"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"DEL"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="1130e458-ad0d-457e-856b-f98a5d32b18b"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212843211786"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="XO1QNZ4BVI3NNOPFV7B00KH1TX"/>
    <field id="19" value="XO1QNZ4BVI3NNOPFV7B00KH1TX"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212843211786"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="XO1QNZ4BVI3NNOPFV7B00KH1TX"/>
    <field id="19" value="XO1QNZ4BVI3NNOPFV7B00KH1TX"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"011"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"DEL"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166370288425</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212843211786</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212843211786=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>XO1QNZ4BVI3NNOPFV7B00KH1TX</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_029_UMS Activation with Decimals" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="f8bd2b72-89db-4709-b15b-606733536967"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="7563b8f0-7121-420f-ab8b-16d69c6dce34"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="b4ed5c27-19ed-4f59-ad07-14939cb2ca8d"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4358804221841481"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358804221841481"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="77cbe83c-9e64-4a5c-8f4f-7f9ed8e1c91c"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
// def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")

def con = Sql.newInstance(db_string, db_driver);
//def con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");

log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100.01 via UMS" id="38620e36-67a7-48e5-b8d2-06b217220397"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110928063233"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110928063233=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675012176"/>
    <field id="3" value="C000000010001"/>
    <field id="18" value="OFHO7YBJUMXTKKAHO9CYJJQJH4"/>
    <field id="19" value="OFHO7YBJUMXTKKAHO9CYJJQJH4"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110928063233"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110928063233=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675012176"/>
    <field id="18" value="OFHO7YBJUMXTKKAHO9CYJJQJH4"/>
    <field id="19" value="OFHO7YBJUMXTKKAHO9CYJJQJH4"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010001"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804221841481</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675012176</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>435880</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539110928063233</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539110928063233=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>OFHO7YBJUMXTKKAHO9CYJJQJH4</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_030_UMS SAF Activation Rev with Decimals" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="a30d3d55-ab51-428f-97f7-da49191b8dcb"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="d710de8d-d7f1-41d6-805a-351cadd81d2b"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="97cd7818-36ec-4d40-92d8-38d9cf66daf9"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4358802084552176"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358802084552176"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="f396b978-1114-4572-9e29-7cc0d96dd212"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100.01 via UMS" id="5cadc04c-1b72-404f-9826-9b10ff417a2e"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110204311442"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110204311442=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675012176"/>
    <field id="3" value="C000000010001"/>
    <field id="18" value="XMV2A5NKN8W99JDG4BAYUXPIFP"/>
    <field id="19" value="XMV2A5NKN8W99JDG4BAYUXPIFP"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110204311442"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110204311442=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675012176"/>
    <field id="18" value="XMV2A5NKN8W99JDG4BAYUXPIFP"/>
    <field id="19" value="XMV2A5NKN8W99JDG4BAYUXPIFP"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010001"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="dd3de3f4-8a33-4a5f-a476-7a616d3b344f"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110204311442"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110204311442=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675012176"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="XMV2A5NKN8W99JDG4BAYUXPIFP"/>
    <field id="19" value="XMV2A5NKN8W99JDG4BAYUXPIFP"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110204311442"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110204311442=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675012176"/>
    <field id="18" value="XMV2A5NKN8W99JDG4BAYUXPIFP"/>
    <field id="19" value="XMV2A5NKN8W99JDG4BAYUXPIFP"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358802084552176</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675012176</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>435880</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539110204311442</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539110204311442=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>XMV2A5NKN8W99JDG4BAYUXPIFP</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_031_UMS Activation with cardnumber" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="75b55db5-0534-4a43-b46a-2ca241c8b221"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="89ce7420-25df-4e61-b5fa-620ac066a08f"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="0ba852a8-a8ef-4373-8cc0-0c86d6b047ec"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543168660037827"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543168660037827"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="91758644-002a-4ecb-a441-275f59e0a7a9"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="21b0dc52-970a-4d73-93a3-866a865305a6"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="4543168660037827"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212154753927=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="4MYPO2F1D73GKH0ISC5UQTZBZ7"/>
    <field id="19" value="4MYPO2F1D73GKH0ISC5UQTZBZ7"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="4543168660037827"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212154753927=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="4MYPO2F1D73GKH0ISC5UQTZBZ7"/>
    <field id="19" value="4MYPO2F1D73GKH0ISC5UQTZBZ7"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543168660037827</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212154753927</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212154753927=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>4MYPO2F1D73GKH0ISC5UQTZBZ7</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_032_UMS SAF Activation Rev with card number" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="4696856a-f639-4ad9-a591-f0aacb542a0d"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="eba9f82b-22fe-4cb5-8a11-94771b91d8a4"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="0fc25425-7fbe-4308-a899-fc553f755f49"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164593820905"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164593820905"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="ec7d9bfe-08cb-4e8e-8dfe-8d82f186f4c1"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
    con = Sql.newInstance(db_string, db_driver); 
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="4d074faa-1930-4217-b3e6-acdcd7d46300"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212972498682"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212972498682=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="DGTKMT64WUCATHF53P6RY2PAEN"/>
    <field id="19" value="DGTKMT64WUCATHF53P6RY2PAEN"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212972498682"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212972498682=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="DGTKMT64WUCATHF53P6RY2PAEN"/>
    <field id="19" value="DGTKMT64WUCATHF53P6RY2PAEN"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="7eb7fb96-580a-4c5f-8a6a-fc545bce3f41"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="4543164593820905"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212972498682=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="DGTKMT64WUCATHF53P6RY2PAEN"/>
    <field id="19" value="DGTKMT64WUCATHF53P6RY2PAEN"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="4543164593820905"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212972498682=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="DGTKMT64WUCATHF53P6RY2PAEN"/>
    <field id="19" value="DGTKMT64WUCATHF53P6RY2PAEN"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164593820905</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212972498682</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212972498682=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>DGTKMT64WUCATHF53P6RY2PAEN</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_033_UMS SAF Activation with incorrect exp date" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="e5288ea9-6e7c-4285-b500-c5346ccb41ab"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="e977df4f-d81b-438f-a8f3-0976b06238e3"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="4e4e983c-5d2a-45c6-a8dd-95e2fe519568"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543167290381138"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543167290381138"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="25a4c08c-1b32-4e55-9438-c4a7c45beab3"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="4e535de2-4565-4ea4-8121-a6fb27f0a0cf"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212996523335"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212996523335=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="9S6PZNSF61W8XQ7VUL5VIQMYR4"/>
    <field id="19" value="9S6PZNSF61W8XQ7VUL5VIQMYR4"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212996523335"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212996523335=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="9S6PZNSF61W8XQ7VUL5VIQMYR4"/>
    <field id="19" value="9S6PZNSF61W8XQ7VUL5VIQMYR4"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"14","value":"1811"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543167290381138</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212996523335</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212996523335=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>9S6PZNSF61W8XQ7VUL5VIQMYR4</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>30f4c4de-251f-45bb-96a4-5424057f9d44</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>ccc1786e-ea19-4497-b91e-350f0a7ba85c</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>b0a566f1-9608-46c4-9763-8e9eb51a7ee7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>20076cf5-d5ce-4b75-8e9b-3913ad592439</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_034_UMS Activation Rev with incorrect exp date" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="9571777c-c3d5-4b46-b60c-077c0b1947ce"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="c7b97009-be6b-44e3-95bf-3102efc057df"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="b9cb4713-9dfa-4f86-9785-fa6f769b44f2"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162909603475"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162909603475"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="667e3900-ec48-4c68-84e9-3e3d11d09951"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="7d397e55-ea6d-4a0a-bb52-b5d1cae40b8b"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/> 
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212146475432"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1810"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212146475432=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="PYINAGAPU98WLBHVWQXVMQ0Z21"/>
    <field id="19" value="PYINAGAPU98WLBHVWQXVMQ0Z21"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212146475432"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1810"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212146475432=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="PYINAGAPU98WLBHVWQXVMQ0Z21"/>
    <field id="19" value="PYINAGAPU98WLBHVWQXVMQ0Z21"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"14","value":"1810"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="4a10ae6c-fa1c-442c-86b7-61f1734e7815"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0420"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212146475432"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212146475432=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="PYINAGAPU98WLBHVWQXVMQ0Z21"/>
    <field id="19" value="PYINAGAPU98WLBHVWQXVMQ0Z21"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212146475432"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212146475432=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="PYINAGAPU98WLBHVWQXVMQ0Z21"/>
    <field id="19" value="PYINAGAPU98WLBHVWQXVMQ0Z21"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162909603475</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212146475432</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212146475432=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>PYINAGAPU98WLBHVWQXVMQ0Z21</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_035_UMS SAF Activation with mode 011 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="ab3d0639-bdd2-47bd-8e72-648325d34f72"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="ebb4e53f-9091-41b9-a1c1-14f23c7e255c"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="3db987bf-2910-4dd6-b040-ccd92ef6b518"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162761564243"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162761564243"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="8d0a7365-b215-4efb-84dd-a27e7cb8ff28"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="78ef6886-cf6f-4579-9470-02a91e112446"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212738967132"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212738967132=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="VU4RM9MQL94OJR14703XMML68F"/>
    <field id="19" value="VU4RM9MQL94OJR14703XMML68F"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212738967132"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212738967132=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="VU4RM9MQL94OJR14703XMML68F"/>
    <field id="19" value="VU4RM9MQL94OJR14703XMML68F"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162761564243</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212738967132</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212738967132=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>VU4RM9MQL94OJR14703XMML68F</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_036_UMS SAF Activation Rev with mode 011 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="19903447-216a-44e6-87ba-ffbc0a2d1d27"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="5f9a7c88-9ec2-4ca6-af02-2b7d2d09bdbb"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="01309c5e-30e2-434d-81b6-c00d031d3a44"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543168085114077"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543168085114077"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="5bea403d-5cd5-4bac-a033-6b4b2f2537fc"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="845cb64b-91b0-4f3a-9485-e9ec30966848"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212749268121"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212749268121=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="FTLGH6TLLNX7TK1TESHXZ8YDLW"/>
    <field id="19" value="FTLGH6TLLNX7TK1TESHXZ8YDLW"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212749268121"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212749268121=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="FTLGH6TLLNX7TK1TESHXZ8YDLW"/>
    <field id="19" value="FTLGH6TLLNX7TK1TESHXZ8YDLW"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="872c15a3-ec8e-4648-9544-a268a5397e1d"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212749268121"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212749268121=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="FTLGH6TLLNX7TK1TESHXZ8YDLW"/>
    <field id="19" value="FTLGH6TLLNX7TK1TESHXZ8YDLW"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212749268121"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212749268121=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="FTLGH6TLLNX7TK1TESHXZ8YDLW"/>
    <field id="19" value="FTLGH6TLLNX7TK1TESHXZ8YDLW"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"011"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543168085114077</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212749268121</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212749268121=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>FTLGH6TLLNX7TK1TESHXZ8YDLW</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_037_UMS SAF Activation with mode 031 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="73cd5fd7-9f84-41b3-bddd-04777cb2e604"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="816f9b41-fff4-4bed-9dd7-976da9996de4"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="f3919a1c-e625-4d02-b899-7355908d9172"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162134965604"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162134965604"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="a70a54fd-274c-458e-8f2d-1298795ee517"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="e7ba5007-3e71-4794-b05f-e003c34a1e41"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212595682545"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212595682545=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="UKRSYC6CY87B21BB3KZ0XMTWSL"/>
    <field id="19" value="UKRSYC6CY87B21BB3KZ0XMTWSL"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212595682545"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212595682545=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="UKRSYC6CY87B21BB3KZ0XMTWSL"/>
    <field id="19" value="UKRSYC6CY87B21BB3KZ0XMTWSL"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"031"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162134965604</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212595682545</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212595682545=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>UKRSYC6CY87B21BB3KZ0XMTWSL</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_038_UMS SAF Activation Rev with mode 031 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="44d7ec10-524b-4a86-9250-d98086ac0469"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="7b09cbfc-5a3c-42b2-a58c-1f7fb7c9579d"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="96add6df-02df-45f8-b2d5-7b428974f3df"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164014321005"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164014321005"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="b90f1515-9532-4020-8e85-ae371da6ed33"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="7030180d-a5ee-4d87-8ab8-5a6bdd2ad982"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212175771935"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212175771935=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="18F3RH5FLNLTMHUNWPTWV6VUU6"/>
    <field id="19" value="18F3RH5FLNLTMHUNWPTWV6VUU6"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212175771935"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212175771935=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="18F3RH5FLNLTMHUNWPTWV6VUU6"/>
    <field id="19" value="18F3RH5FLNLTMHUNWPTWV6VUU6"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"031"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="1ebeb9f6-2ccd-4950-bc3c-6e8af875079a"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212175771935"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212175771935=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="18F3RH5FLNLTMHUNWPTWV6VUU6"/>
    <field id="19" value="18F3RH5FLNLTMHUNWPTWV6VUU6"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212175771935"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212175771935=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="18F3RH5FLNLTMHUNWPTWV6VUU6"/>
    <field id="19" value="18F3RH5FLNLTMHUNWPTWV6VUU6"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164014321005</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212175771935</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212175771935=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>18F3RH5FLNLTMHUNWPTWV6VUU6</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_039_UMS SAF Activation with mode 032 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="15614601-a8bf-47a6-a29a-7d8ec124e48a"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="2ecdc1e3-63dd-4647-af03-e10bc280da35"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="9b92b265-e542-4573-a415-32d0c730ab65"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162201721770"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162201721770"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="0a066f3c-b783-4ecc-9ae6-4ea2c27a0503"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="dd6896b6-0287-4921-8df1-9546064a442c"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212737058136"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212737058136=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="R7VLJBDPY0FJ2LZ9Q0S32PQ8PT"/>
    <field id="19" value="R7VLJBDPY0FJ2LZ9Q0S32PQ8PT"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212737058136"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212737058136=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="R7VLJBDPY0FJ2LZ9Q0S32PQ8PT"/>
    <field id="19" value="R7VLJBDPY0FJ2LZ9Q0S32PQ8PT"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"032"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162201721770</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212737058136</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212737058136=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>R7VLJBDPY0FJ2LZ9Q0S32PQ8PT</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_040_UMS SAF Activation Rev with mode 032 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="74107805-f962-473f-9a57-e3c4f87f107e"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="1cc9e62b-3338-4b84-b601-6bc7ed3be355"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="9b369cb2-c784-4bcc-8c0e-966cfd9dfa5d"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164324826098"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164324826098"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="2e8e0a0e-2a5a-4af9-98c7-a1219b7af0c8"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="ac2f4941-b006-4c61-b74b-c6adcae23b70"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212548144058"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212548144058=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="QFNVD0S80KAXTBFA8IRC2O34AP"/>
    <field id="19" value="QFNVD0S80KAXTBFA8IRC2O34AP"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212548144058"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212548144058=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="QFNVD0S80KAXTBFA8IRC2O34AP"/>
    <field id="19" value="QFNVD0S80KAXTBFA8IRC2O34AP"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"032"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="f66f7b61-4ed0-4048-813b-3cee57b6e13b"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212548144058"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212548144058=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="QFNVD0S80KAXTBFA8IRC2O34AP"/>
    <field id="19" value="QFNVD0S80KAXTBFA8IRC2O34AP"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212548144058"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212548144058=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="QFNVD0S80KAXTBFA8IRC2O34AP"/>
    <field id="19" value="QFNVD0S80KAXTBFA8IRC2O34AP"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164324826098</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212548144058</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212548144058=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>QFNVD0S80KAXTBFA8IRC2O34AP</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_041_UMS SAF Activation with mode 041 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="4e0f9595-a9f8-4a6a-ac6c-8f45efdbda5b"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="af448478-4106-40d6-8b35-dc56ee96de7f"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="c03a63d9-f910-49cc-9be4-1c463d153240"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162566265019"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162566265019"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="2dc10750-d9a0-4b64-86bf-f65d65bcef92"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="e6df56d5-c642-4959-a38e-c4c1506b2489"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212772551690"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212772551690=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="JW9EHJIT20VBXTCXH9TLH212J5"/>
    <field id="19" value="JW9EHJIT20VBXTCXH9TLH212J5"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212772551690"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212772551690=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="JW9EHJIT20VBXTCXH9TLH212J5"/>
    <field id="19" value="JW9EHJIT20VBXTCXH9TLH212J5"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162566265019</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212772551690</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212772551690=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>JW9EHJIT20VBXTCXH9TLH212J5</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_042_UMS SAF Activation Rev with mode 041 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="43bdb261-af15-409d-9531-224d294a7070"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="4976feb0-3307-4ee7-ba81-3f47aefb5c67"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="a93bbf2b-3c96-4657-abc2-7056786d9171"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166722414878"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166722414878"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="0743640f-19d6-46a0-b6b1-a2f8405bc006"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="d535f78c-341f-48fd-b90c-98c3d41d0137"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212508000361"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212508000361=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="S6O60N9EE5FMP96XT64IS8DI5F"/>
    <field id="19" value="S6O60N9EE5FMP96XT64IS8DI5F"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212508000361"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212508000361=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="S6O60N9EE5FMP96XT64IS8DI5F"/>
    <field id="19" value="S6O60N9EE5FMP96XT64IS8DI5F"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="2282eacc-4a18-43a4-a433-95806cc8d039"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212508000361"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212508000361=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="S6O60N9EE5FMP96XT64IS8DI5F"/>
    <field id="19" value="S6O60N9EE5FMP96XT64IS8DI5F"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212508000361"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212508000361=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="S6O60N9EE5FMP96XT64IS8DI5F"/>
    <field id="19" value="S6O60N9EE5FMP96XT64IS8DI5F"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166722414878</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212508000361</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212508000361=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>S6O60N9EE5FMP96XT64IS8DI5F</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_043_UMS SAF Activation with mode 041 and incorrect track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="e29ba49b-495f-40a3-b426-6ed666c8ab62"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="191edbb1-4fe5-4513-9b4a-1215e8b5d429"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="3b0fc4b2-8b8a-48ee-92dc-0837f205dabd"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543160048104618"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543160048104618"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="56ec9baf-2729-49af-82c9-ef65c2034290"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="792e82d2-c2ba-42bd-a0f6-43bdbfcc3def"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212568464556"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="RCGWOT8ICKXVVAMFODMSLX2UY0"/>
    <field id="19" value="RCGWOT8ICKXVVAMFODMSLX2UY0"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212568464556"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="RCGWOT8ICKXVVAMFODMSLX2UY0"/>
    <field id="19" value="RCGWOT8ICKXVVAMFODMSLX2UY0"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543160048104618</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212568464556</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212568464556=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>RCGWOT8ICKXVVAMFODMSLX2UY0</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_044_UMS SAF Activation Rev with mode 041 and incorrect  track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="33a991d0-06f9-49e2-a7b0-7b2717d9260c"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="21506f1c-a84d-41ce-a78d-e937789b67d6"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="1035305a-6180-4a49-8504-954c99b2b427"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543165477589520"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543165477589520"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="21517274-7230-4ab6-905b-47fa68138cc3"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="e7cbfc8d-5248-45b3-8d24-b3facd01ccb0"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212603155688"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="OOS0U6BTC5BP3QL9EZIPVLBFJS"/>
    <field id="19" value="OOS0U6BTC5BP3QL9EZIPVLBFJS"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212603155688"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="OOS0U6BTC5BP3QL9EZIPVLBFJS"/>
    <field id="19" value="OOS0U6BTC5BP3QL9EZIPVLBFJS"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="2178a7e4-2a42-49ec-8264-788f8508be81"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212603155688"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212603155688=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="OOS0U6BTC5BP3QL9EZIPVLBFJS"/>
    <field id="19" value="OOS0U6BTC5BP3QL9EZIPVLBFJS"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212603155688"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212603155688=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="OOS0U6BTC5BP3QL9EZIPVLBFJS"/>
    <field id="19" value="OOS0U6BTC5BP3QL9EZIPVLBFJS"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543165477589520</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212603155688</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212603155688=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>OOS0U6BTC5BP3QL9EZIPVLBFJS</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_045_UMS SAF Activation with PAN inTrack2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="c10a47da-b3ce-4782-b598-39830aa92a21"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="d9d6c033-654d-430e-9d2a-5c25ef05c593"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="7ac29da6-7998-463a-8915-97cea62babdd"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543169248152970"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543169248152970"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="319c40ed-a099-4468-8a1d-ddb41564315e"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="6f542f5a-1904-417e-8bf8-1564e302a60b"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="04	1"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212800665968"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543169248152970=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="04SOQNHFT09WOZP2L72KDRGBHG"/>
    <field id="19" value="04SOQNHFT09WOZP2L72KDRGBHG"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212800665968"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543169248152970=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="04SOQNHFT09WOZP2L72KDRGBHG"/>
    <field id="19" value="04SOQNHFT09WOZP2L72KDRGBHG"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543169248152970</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212800665968</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212800665968=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>04SOQNHFT09WOZP2L72KDRGBHG</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_046_UMS SAF Activation Rev with PAN in Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="5109b99c-6223-4c11-b9c1-596d64f968d3"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="0ab9166f-45c2-4984-8993-789e8fdd6086"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="76d033b8-ef36-43a8-813a-90013c5786f9"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164311256730"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164311256730"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="b8bfeebc-b10a-4bc0-952a-2795e0a411d6"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="f3218ebc-5815-4242-9b41-6c14e5a424e7"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212982378729"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543164311256730=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="1JCZXLM1WZZNLPG6Q1SVVXEDFH"/>
    <field id="19" value="1JCZXLM1WZZNLPG6Q1SVVXEDFH"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212982378729"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543164311256730=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="1JCZXLM1WZZNLPG6Q1SVVXEDFH"/>
    <field id="19" value="1JCZXLM1WZZNLPG6Q1SVVXEDFH"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="779f8016-a363-4118-b8d0-6245526a1f3c"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212982378729"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543164311256730=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="1JCZXLM1WZZNLPG6Q1SVVXEDFH"/>
    <field id="19" value="1JCZXLM1WZZNLPG6Q1SVVXEDFH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212982378729"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543164311256730=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="1JCZXLM1WZZNLPG6Q1SVVXEDFH"/>
    <field id="19" value="1JCZXLM1WZZNLPG6Q1SVVXEDFH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"041"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164311256730</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212982378729</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212982378729=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>1JCZXLM1WZZNLPG6Q1SVVXEDFH</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_047_UMS SAF Activation with mode 041 and incorrect track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="8fd0a56e-60ae-4ba9-b73b-435d665d240b"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="44fc4548-9590-4c1f-b4e8-e897d40f91f5"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="9f7ccf5c-1a1e-45ec-a5a6-d191b3b04a87"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543169689155664"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543169689155664"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="aeab26dc-3152-442b-bba0-d37e712ff84a"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="3960dc99-7571-4af1-a9e5-8c8418d1aa03"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212074721566"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212074721566=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="45OJJGSKLZ138FUZQUGMI616L1"/>
    <field id="19" value="45OJJGSKLZ138FUZQUGMI616L1"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212074721566"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212074721566=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="45OJJGSKLZ138FUZQUGMI616L1"/>
    <field id="19" value="45OJJGSKLZ138FUZQUGMI616L1"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#proxyCardNumber}=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543169689155664</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212074721566</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212074721566=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>45OJJGSKLZ138FUZQUGMI616L1</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_048_UMS SAF Activation Rev with mode 041 and incorrect  track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="9d18e3c8-c57e-45c0-87c4-f46429e16174"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="342a9d9b-6fa0-4cf0-9b91-59a00b350b05"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="9d9e5bab-0020-4319-9e04-039c657f78b7"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164420446324"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164420446324"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="4678a3d6-96fe-4cab-b1a9-96ea6480b9c1"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="e77e2993-f72a-47b0-8093-168b19138b4f"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212959440912"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212959440912=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="OX0U2GZCTND1RHUA4OEIG9H1AV"/>
    <field id="19" value="OX0U2GZCTND1RHUA4OEIG9H1AV"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212959440912"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212959440912=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="OX0U2GZCTND1RHUA4OEIG9H1AV"/>
    <field id="19" value="OX0U2GZCTND1RHUA4OEIG9H1AV"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#proxyCardNumber}=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="e8c4fcda-c0b3-4068-aa5b-aae53fb1da32"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212959440912"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212959440912=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="OX0U2GZCTND1RHUA4OEIG9H1AV"/>
    <field id="19" value="OX0U2GZCTND1RHUA4OEIG9H1AV"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212959440912"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212959440912=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="OX0U2GZCTND1RHUA4OEIG9H1AV"/>
    <field id="19" value="OX0U2GZCTND1RHUA4OEIG9H1AV"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164420446324</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212959440912</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212959440912=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>OX0U2GZCTND1RHUA4OEIG9H1AV</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_049_UMS SAF Already Reversed." searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="840dfd5c-9619-4a0d-849e-35a332d182c9"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="cc2ff806-ceb2-4465-81ac-2d4fa4b8a6dc"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="052efb70-269a-4359-b7dd-e21e44b9e70f"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164458733752"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164458733752"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="c09de28a-5409-422b-b2e2-1ee21af3581c"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="21fea27d-9a54-48e4-bf0f-337e5477f24e"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212811192786"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212811192786=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="19" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212811192786"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212811192786=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="19" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#proxyCardNumber}=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="2478f876-4cec-4d8b-b2b9-c25139af07e3"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212811192786"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212811192786=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="19" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212811192786"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212811192786=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="19" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"041"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Copy of Reversal activated card  via UMS" id="beb6db0a-d89a-415d-9fc5-9d91f45f73dc"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212811192786"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212811192786=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="000000"/>
  <field id="39" value="34"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="19" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212811192786"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212811192786=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="19" value="7OZ3JFMQH3VVXBGKSY6IG5A3JY"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"34"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"041"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164458733752</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212811192786</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212811192786=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>7OZ3JFMQH3VVXBGKSY6IG5A3JY</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_050_UMS SAF Activation with  incorrect track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="fe3744e6-c0bc-4114-a954-a4c31a2b2a84"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="f24b8a1a-49e5-443c-9eb8-f7683b58c77d"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="aac24fd2-2c4c-4be7-99cb-34e941f45aa9"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543165339560956"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543165339560956"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="89614b39-8c46-4981-8cde-37146c7a3256"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="0bd2b459-d77c-4501-944a-aeb2e6d339e9"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212654342349"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="';6039539120243321611=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="000000"/>
  <field id="39" value="08"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="18" value="N59JWJVLWZXC9CST59QC52PRAV"/>
    <field id="19" value="N59JWJVLWZXC9CST59QC52PRAV"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212654342349"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="';6039539120243321611=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="N59JWJVLWZXC9CST59QC52PRAV"/>
    <field id="19" value="N59JWJVLWZXC9CST59QC52PRAV"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"08"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"';6039539120243321611=1911?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543165339560956</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212654342349</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212654342349=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>N59JWJVLWZXC9CST59QC52PRAV</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_051_UMS SAF Activation with no track2 incorrect" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="9e9643ff-29d1-4ead-b04b-42e2ff12f170"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="ee3cf976-5d94-4032-ae9a-796ce0c68434"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="b2458c19-3a09-407a-a6fb-8d9033949980"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543161418383822"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543161418383822"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="309f09d4-f2c6-48f3-824f-9786837f646b"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="a31e6b9d-8adc-4069-a7ad-d61ebecf2a18"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml/><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="4543161418383822"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=""/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value=""/>
    <field id="19" value=""/>
    <field id="23" value=""/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"69"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":""},{"field":"63.18","value":""},{"field":"63.19","value":""},{"field":"63.23","value":""},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543161418383822</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212608299902</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212608299902=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>H1CN5N9OAF45WLG1DA81HT7OSG</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_052_UMS SAF Activation rev with no track2 incorrect" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="bcd85b91-037a-4db6-a650-0ce7b70e8ac2"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="0e5adcd7-7e92-471b-920b-7b4db60ffca1"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="7d13d833-5066-49fc-9e22-fbf4d90b80af"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543165818522034"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543165818522034"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="455e5679-753b-4320-bcf7-b58862cb87b4"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="1cca0f23-d6e1-4eb8-a755-38a8df7d372e"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml/><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="4543165818522034"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=""/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="99RR5RB5QC4AGHZDC5XE04H926"/>
    <field id="19" value="99RR5RB5QC4AGHZDC5XE04H926"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"69"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":""},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Copy of Reversal activated card  via UMS" id="420ca160-e3b6-4d4d-805e-fda63611b147"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml/><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="4543165818522034"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=""/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value=""/>
    <field id="19" value=""/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"69"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":""},{"field":"63.19","value":""},{"field":"35","value":""},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543165818522034</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212201624994</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212201624994=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>99RR5RB5QC4AGHZDC5XE04H926</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:properties><con:property><con:name>PAN</con:name><con:value>4543161234567898</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>826</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>826</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675009844</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.135</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>lastFour</con:name><con:value>7898</con:value></con:property><con:property><con:name>account</con:name><con:value>1000000000000002175</con:value></con:property><con:property><con:name>PAN1</con:name><con:value>4543161234567891</con:value></con:property><con:property><con:name>UPC1</con:name><con:value>07675014018</con:value></con:property><con:property><con:name>TotalTxns</con:name><con:value>126</con:value></con:property><con:property><con:name>TotalPassTxns</con:name><con:value>0</con:value></con:property><con:property><con:name>TotalFailTxns</con:name><con:value>0</con:value></con:property><con:property><con:name>DB_String</con:name><con:value>jdbc:mysql://keystone-igift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_igift</con:value></con:property><con:property><con:name>DB_Driver</con:name><con:value>com.mysql.jdbc.Driver</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>459470</con:value></con:property><con:property><con:name>LoadAmt</con:name><con:value>5000</con:value></con:property></con:properties><con:reportParameters/></con:testSuite><con:testSuite name="TS_6_UMS Regression Test for NAGift" id="9ba4efe7-a190-4e9e-a624-8b1a3685646b"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_001_UMS Activation with Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="f4dddfed-7289-49a7-be50-90f3aa3cd111"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="e37b5ef5-c554-43cb-bf9a-5c960410cd7c"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  (new Random()).with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="012326cb-f25e-485a-acfe-0facda888bab"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml/><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543160918004292"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675014018"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="7b56b215-1b01-4ab4-99d2-3662b947b8a1"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
com.eviware.soapui.support.GroovyUtils.registerJdbcDriver( "com.mysql.jdbc.Driver" );
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="da5110a0-390f-4f25-ad9b-fb876907a368"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>8584</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="NV5ZB8UI0TUPXVGQUXDYXQ1ZLI"/>
    <field id="19" value="NV5ZB8UI0TUPXVGQUXDYXQ1ZLI"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="NV5ZB8UI0TUPXVGQUXDYXQ1ZLI"/>
    <field id="19" value="NV5ZB8UI0TUPXVGQUXDYXQ1ZLI"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543161499945588</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675014018</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539110621788167</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539110621788167=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>NV5ZB8UI0TUPXVGQUXDYXQ1ZLI</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_002_UMS Activation Rev with Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="03551df1-f8a7-4837-968e-f85e0dcd4bb4"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="f44c1052-93c6-4cd4-ae85-a32e187bdf95"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="42a75733-3662-4b47-8c3b-cb073f4862f8"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543165141651562"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543165141651562"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="6f252408-8a09-4b56-9214-b9fc44d42b65"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="12417868-b0fb-4a4d-a14a-59a6cf45c1d2"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="000000"/>
  <field id="39" value="21"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="32078afb-f18f-4aef-8648-131ee54abb32"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0420"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"@res63.18"},{"field":"63.19","value":"@res@63.19"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166514642510</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212457484709</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212457484709=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>YREQTXS7I94CGSB7HYBDUIC3FE</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_003_UMS Activation without Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="cb94ba48-e365-4566-9ea7-392237b1e88c" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="1847e246-e282-4014-a115-00384a8ff0eb"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="2d6ac770-16ce-4be0-bebe-22e146119553"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164129999425"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164129999425"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="1c6075e2-2ce9-4bbf-9b4c-2e100b39f28a"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="5bdba5ce-f56e-415f-bd40-fa1c16f0c0fe"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"DEL"},{"field":"63.23","value":"DEL"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164129999425</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212463197906</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212463197906=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>HCD6EAAQFT925XB6OFT5VXRC0U</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_004_UMS Activation Rev without Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="de7c9dc7-2b41-4eb6-9726-21516c22f89e"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="006f0e3c-122c-4287-85d8-95545feb2794"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="75fbdadf-29a4-4814-9cd9-e9a081bbd1f9"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543160286217687"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543160286217687"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="98aa9483-e8b1-4287-914d-f6dcf34839b4"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="f0f487f2-94a9-47cc-88e1-b5f6eac26878"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"DEL"},{"field":"63.23","value":"DEL"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="7fd283f6-6468-4eae-a5b0-110f3fff7b80"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0420"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"011"},{"field":"35","value":"DEL"},{"field":"63.18","value":"@res63.18"},{"field":"63.19","value":"@res63.19"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543161352302085</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212872208735</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212872208735=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>6P3MBZOPLDQRDD9CLO542L1RHA</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_005_UMS Activation with Decimals" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="7e58bf5a-7da7-4635-adae-a93e864b1393" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="d3ceb860-4e54-42ef-8b11-39eb19797059"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="5e40f6c3-70e0-42a8-9938-1b544c15986e"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4358807151007053"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358807151007053"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="5f6e9e66-40b7-4b4b-9d5b-e0a305cf01e5"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
// def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")

def con = Sql.newInstance(db_string, db_driver);
//def con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");

log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100.01 via UMS" id="662ce593-79bb-479c-bd9e-3be692be708a"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110432139795"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110432139795=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675012176"/>
    <field id="3" value="C000000010001"/>
    <field id="18" value="V9B8HFGTRS1ZV56Y8H7NR4Y3GO"/>
    <field id="19" value="V9B8HFGTRS1ZV56Y8H7NR4Y3GO"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110432139795"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110432139795=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675012176"/>
    <field id="18" value="V9B8HFGTRS1ZV56Y8H7NR4Y3GO"/>
    <field id="19" value="V9B8HFGTRS1ZV56Y8H7NR4Y3GO"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010001"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358807151007053</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675012176</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>435880</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539110432139795</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539110432139795=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>V9B8HFGTRS1ZV56Y8H7NR4Y3GO</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_006_UMS Activation Rev with Decimals" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="fca65379-12dd-4ed6-ad98-f0fa0278d5a2"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="afec83a0-e1cb-4a9d-87bb-b1584fff9394"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="75390ea8-5418-480d-9e91-5094cc7078c2"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4358806350109962"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358806350109962"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="f8513931-db67-4a4d-ab9f-7fc6cf57148d"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100.01 via UMS" id="296e9de6-802e-4bf3-a602-4ce2421ac620"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010001"/>
    <field id="18" value="3RC1MEKP8DH9WL19X8CSMBGF4I"/>
    <field id="19" value="3RC1MEKP8DH9WL19X8CSMBGF4I"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="3RC1MEKP8DH9WL19X8CSMBGF4I"/>
    <field id="19" value="3RC1MEKP8DH9WL19X8CSMBGF4I"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010001"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"22","value":"021"},{"field":"35","value":"DEL"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="d9df8a86-3345-4210-8a34-3a6a041553d3"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="3RC1MEKP8DH9WL19X8CSMBGF4I"/>
    <field id="19" value="3RC1MEKP8DH9WL19X8CSMBGF4I"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="3RC1MEKP8DH9WL19X8CSMBGF4I"/>
    <field id="19" value="3RC1MEKP8DH9WL19X8CSMBGF4I"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"@res63.18"},{"field":"63.19","value":"@res63.19"},{"field":"35","value":"DEL"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804191190512</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675012176</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>435880</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539110264492645</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539110264492645=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>3RC1MEKP8DH9WL19X8CSMBGF4I</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_007_UMS Activation with cardnumber" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="4650603a-0a33-43a5-b25b-56f6a43ee52f" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="9b394472-d1cb-4216-92e5-b2b79b332226"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="079c3db8-33d2-4adb-be76-59a6153dff03"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543167667317608"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543167667317608"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="73fbe29a-6b80-4cad-9d96-eff1d55ac832"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="6808b825-3e22-4086-b1ff-fb1710bd1c0e"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="4543167667317608"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212191403551=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="BXIM2SGQ096GQNA5XROC6E2VOF"/>
    <field id="19" value="BXIM2SGQ096GQNA5XROC6E2VOF"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="4543167667317608"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212191403551=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="BXIM2SGQ096GQNA5XROC6E2VOF"/>
    <field id="19" value="BXIM2SGQ096GQNA5XROC6E2VOF"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543167667317608</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212191403551</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212191403551=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>BXIM2SGQ096GQNA5XROC6E2VOF</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_008_UMS Activation Rev with card number" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="a2650aca-86f3-4060-8c54-00035f2a4a4a"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="9868c2b4-de51-4afa-a127-a6667a8443db"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="c441b01b-dfa7-4291-85d0-3af6a4c0ed45"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166573900237"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166573900237"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="aa1711b6-02a4-41f7-9025-363fa9c2bdae"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
    con = Sql.newInstance(db_string, db_driver); 
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="f505f050-4ce5-4a03-9d5e-41c446539b12"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="H7SELF8RP7W5CUG3PJ0LQIQ5R9"/>
    <field id="19" value="H7SELF8RP7W5CUG3PJ0LQIQ5R9"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="H7SELF8RP7W5CUG3PJ0LQIQ5R9"/>
    <field id="19" value="H7SELF8RP7W5CUG3PJ0LQIQ5R9"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="c0221311-0ab1-4a2b-abf2-34779ee44f06"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value=""/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="H7SELF8RP7W5CUG3PJ0LQIQ5R9"/>
    <field id="19" value="H7SELF8RP7W5CUG3PJ0LQIQ5R9"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value=""/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="H7SELF8RP7W5CUG3PJ0LQIQ5R9"/>
    <field id="19" value="H7SELF8RP7W5CUG3PJ0LQIQ5R9"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNmuber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"@res63.18"},{"field":"63.19","value":"@res63.19"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164513358157</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212794416137</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212794416137=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>H7SELF8RP7W5CUG3PJ0LQIQ5R9</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_009_UMS Activation with incorrect exp date" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="ae71cc59-867c-4e1e-a400-a883115b8ee6" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="04e1dfde-14b3-495e-8f65-62b2d7317a89"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="f80d706d-9477-4dcb-90dd-bbe3d593fe25"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543161780895819"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543161780895819"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="fa062500-a1d3-4693-80c1-6c4d0ee9c7ab"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="aca1d514-81a8-4a47-b8f9-7a9d56dcbad1"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212420848521"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212420848521=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="CG2B6NH5P4Y89RA8VRY6XMN76Z"/>
    <field id="19" value="CG2B6NH5P4Y89RA8VRY6XMN76Z"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212420848521"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212420848521=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="CG2B6NH5P4Y89RA8VRY6XMN76Z"/>
    <field id="19" value="CG2B6NH5P4Y89RA8VRY6XMN76Z"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"14","value":"1811"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543161780895819</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212420848521</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212420848521=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>CG2B6NH5P4Y89RA8VRY6XMN76Z</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>30f4c4de-251f-45bb-96a4-5424057f9d44</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>ccc1786e-ea19-4497-b91e-350f0a7ba85c</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>b0a566f1-9608-46c4-9763-8e9eb51a7ee7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>20076cf5-d5ce-4b75-8e9b-3913ad592439</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_010_UMS Activation Rev with incorrect exp date" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="1032a17d-50d9-4650-993f-8d50e75a86b9"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="094aa4d0-b4fc-4388-b402-00c3855c0986"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="8487a379-6897-4a12-bd23-d11159f4ba2a"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166835030685"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166835030685"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="467a5fcc-8b4b-45d4-b5b9-2f130a01bc5a"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="3976cc37-7d8c-4418-af58-43e204895c39"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/> 
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1810"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="V6HU1L6312EUQD8ORNENV85ITR"/>
    <field id="19" value="V6HU1L6312EUQD8ORNENV85ITR"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1810"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="V6HU1L6312EUQD8ORNENV85ITR"/>
    <field id="19" value="V6HU1L6312EUQD8ORNENV85ITR"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"14","value":"1810"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="2ab52cce-3b88-4405-b4fd-133135254c5c"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0420"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="V6HU1L6312EUQD8ORNENV85ITR"/>
    <field id="19" value="V6HU1L6312EUQD8ORNENV85ITR"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="V6HU1L6312EUQD8ORNENV85ITR"/>
    <field id="19" value="V6HU1L6312EUQD8ORNENV85ITR"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"@res63.18"},{"field":"63.19","value":"@res63.19"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164911011287</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212413999047</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212413999047=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>V6HU1L6312EUQD8ORNENV85ITR</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_011_UMS Activation with mode 011 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="175303b6-ded7-4ed5-a4f9-c8cd306b8fc2" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="b6d40a57-ce16-42cc-94ac-d1531a3d1f52"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="44f927a3-4c1d-4291-b360-0c958757e74e"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162284976263"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162284976263"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="0f768866-2b4b-413e-a617-144ca00e8abc"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="9b2924a7-8271-4ec5-8eef-25f233c2a2b7"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212533056893"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212533056893=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="WVVF2EW3GARS9L5F6VQ1G94WVM"/>
    <field id="19" value="WVVF2EW3GARS9L5F6VQ1G94WVM"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212533056893"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212533056893=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="WVVF2EW3GARS9L5F6VQ1G94WVM"/>
    <field id="19" value="WVVF2EW3GARS9L5F6VQ1G94WVM"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162284976263</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212533056893</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212533056893=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>WVVF2EW3GARS9L5F6VQ1G94WVM</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_012_UMS Activation Rev with mode 011 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="ceca3dfd-18a7-4b09-8a27-7e4f8f0ba745"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="186a336a-b32a-4c11-a006-2710ba59fdcc"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="4a9e9c76-d233-4ea9-ace7-e6ec708a26fc"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543168739805692"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543168739805692"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="ff3d9f4c-d742-420f-bf70-4309dd7d1280"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="0c2773fc-141f-4ee3-8c37-c779acee00c3"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="086PZWTKMCEQ7UHSNGN4HMI1D6"/>
    <field id="19" value="086PZWTKMCEQ7UHSNGN4HMI1D6"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="086PZWTKMCEQ7UHSNGN4HMI1D6"/>
    <field id="19" value="086PZWTKMCEQ7UHSNGN4HMI1D6"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="a0dfd3dd-b1c7-4e24-a6c7-a08d2f7c42cc"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="086PZWTKMCEQ7UHSNGN4HMI1D6"/>
    <field id="19" value="086PZWTKMCEQ7UHSNGN4HMI1D6"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="086PZWTKMCEQ7UHSNGN4HMI1D6"/>
    <field id="19" value="086PZWTKMCEQ7UHSNGN4HMI1D6"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"011"},{"field":"63.18","value":"@res63.18"},{"field":"63.19","value":"@res63.19"},{"field":"35","value":"@res35"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164652434122</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212254201319</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212254201319=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>086PZWTKMCEQ7UHSNGN4HMI1D6</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_013_UMS Activation with mode 031 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="d91a52b8-b2f7-4aad-83c3-caf3daca429a" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="4ed5d361-10f2-48cd-be22-12dc69e3e614"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="a9c842ec-5942-4dae-8d4e-3643ac64f8c2"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162307736735"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162307736735"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="98e57510-2d11-4f14-97fb-fdd74145afa1"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="fca758c8-4ad0-4e53-9756-a03bcb032851"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212131380165"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212131380165=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="GMESS87GAFFKHMJTFCIKA31C32"/>
    <field id="19" value="GMESS87GAFFKHMJTFCIKA31C32"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212131380165"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212131380165=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="GMESS87GAFFKHMJTFCIKA31C32"/>
    <field id="19" value="GMESS87GAFFKHMJTFCIKA31C32"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"031"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162307736735</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212131380165</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212131380165=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>GMESS87GAFFKHMJTFCIKA31C32</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_014_UMS Activation Rev with mode 031 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="e14d5589-d949-4f52-adde-369b08f9753b"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="f6620cc7-2051-48a2-b22e-661af722aa13"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="a0ed287c-ac0f-402c-bb8b-26aa7ae2c41c"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164707981175"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164707981175"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="34a61b87-20bd-4ab5-914b-b91395e462c0"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="2005b1d3-1f44-4a50-b6d8-d16c7a688ee1"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="BHRHXAT8GE8BBPHQ66LNOB5KJ0"/>
    <field id="19" value="BHRHXAT8GE8BBPHQ66LNOB5KJ0"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="BHRHXAT8GE8BBPHQ66LNOB5KJ0"/>
    <field id="19" value="BHRHXAT8GE8BBPHQ66LNOB5KJ0"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"031"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="d4b7170f-d03a-4756-9ed6-6244b06d03c0"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="BHRHXAT8GE8BBPHQ66LNOB5KJ0"/>
    <field id="19" value="BHRHXAT8GE8BBPHQ66LNOB5KJ0"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="BHRHXAT8GE8BBPHQ66LNOB5KJ0"/>
    <field id="19" value="BHRHXAT8GE8BBPHQ66LNOB5KJ0"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543163542825059</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212115034918</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212115034918=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>BHRHXAT8GE8BBPHQ66LNOB5KJ0</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_015_UMS Activation with mode 032 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="39aaac5b-6973-4e65-88e5-62787a40a803" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="886ccd65-1ff2-4584-86a3-d1e9fe76f7de"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="925975f8-bc35-4326-aba1-c8b40ef546cf"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543165861769916"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543165861769916"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="fb77a252-d2cf-470d-b1cc-7c685642ded9"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="657686c9-54b1-49db-9b8f-ada4ccc6e875"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212684015081"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212684015081=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="QLUPR876E9V85CIDCSRGY5WVQ0"/>
    <field id="19" value="QLUPR876E9V85CIDCSRGY5WVQ0"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212684015081"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212684015081=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="QLUPR876E9V85CIDCSRGY5WVQ0"/>
    <field id="19" value="QLUPR876E9V85CIDCSRGY5WVQ0"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"032"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543165861769916</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212684015081</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212684015081=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>QLUPR876E9V85CIDCSRGY5WVQ0</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_016_UMS Activation Rev with mode 032 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="e2127d50-179b-4b61-b9fe-859ca46015b4"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="f4ec72e0-1f89-432f-b328-fb027c8e6ad3"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="b7eacd9c-0215-4586-b6b6-b1ecfd816119"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166602797808"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166602797808"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="f03e71c4-bf44-474c-8efe-e2f47dd78c27"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="ec9ad0ef-da9c-4f7f-825b-fc1213db5831"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="N7869N84UG5NR3O1M0TOMIZE9G"/>
    <field id="19" value="N7869N84UG5NR3O1M0TOMIZE9G"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="N7869N84UG5NR3O1M0TOMIZE9G"/>
    <field id="19" value="N7869N84UG5NR3O1M0TOMIZE9G"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"032"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="638a159e-c89c-421e-9b2a-3fbb98c7e8d6"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="N7869N84UG5NR3O1M0TOMIZE9G"/>
    <field id="19" value="N7869N84UG5NR3O1M0TOMIZE9G"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="N7869N84UG5NR3O1M0TOMIZE9G"/>
    <field id="19" value="N7869N84UG5NR3O1M0TOMIZE9G"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543169800216714</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212373316084</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212373316084=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>N7869N84UG5NR3O1M0TOMIZE9G</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_017_UMS Activation with mode 041 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="1baa436d-e90a-4b82-abb6-499cb2876b06" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="82fcc3bf-458f-4d49-ba7c-4766cfa17fa2"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="735a36e1-4d49-4e31-b23e-9ee1a81a00f8"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543168944434233"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543168944434233"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="93676cf7-cf4b-4b86-b42a-4833db455037"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="32e6d643-1cc4-4341-ba20-1494431d3098"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212721400405"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212721400405=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="U9UIBJZ9EC4H7JVYMZ7KZOJTF6"/>
    <field id="19" value="U9UIBJZ9EC4H7JVYMZ7KZOJTF6"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212721400405"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212721400405=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="U9UIBJZ9EC4H7JVYMZ7KZOJTF6"/>
    <field id="19" value="U9UIBJZ9EC4H7JVYMZ7KZOJTF6"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543168944434233</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212721400405</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212721400405=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>U9UIBJZ9EC4H7JVYMZ7KZOJTF6</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_018_UMS Activation Rev with mode 041 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="f1e8bdd5-0b68-4d9b-8646-237cf163af66"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="1895629a-f667-489a-ae47-721a585bfd48"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="4da2c1a9-29e4-4223-986c-a8ef59cfad83"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543160480192761"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543160480192761"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="a0bef32e-ea29-42e7-8fe6-831bad150086"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="79e9336a-84fa-4697-bfd7-5344a5e25f4b"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="2WH3WP33H4TXVZEZRWE6LM1H8Z"/>
    <field id="19" value="2WH3WP33H4TXVZEZRWE6LM1H8Z"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="2WH3WP33H4TXVZEZRWE6LM1H8Z"/>
    <field id="19" value="2WH3WP33H4TXVZEZRWE6LM1H8Z"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="25e890ce-37d4-4155-871f-8f5913df61df"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="2WH3WP33H4TXVZEZRWE6LM1H8Z"/>
    <field id="19" value="2WH3WP33H4TXVZEZRWE6LM1H8Z"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="2WH3WP33H4TXVZEZRWE6LM1H8Z"/>
    <field id="19" value="2WH3WP33H4TXVZEZRWE6LM1H8Z"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"@res63.18"},{"field":"63.19","value":"@res63.19"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166455961757</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212054186572</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212054186572=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>2WH3WP33H4TXVZEZRWE6LM1H8Z</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_019_UMS Activation with mode 041 and incorrect track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="4b14af90-a7d5-4efa-8f7b-f11f15583e5f" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="4abd14f3-23ab-4e17-8c44-33be4c5a6677"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="07017d1e-a937-4041-a3ab-1a615f7540a9"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543160789844579"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543160789844579"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="3560da46-2253-406c-b56f-359df478b3a0"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="dc873ff1-42a7-4fda-b576-899704abc884"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212478907932"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="MOWRXOC3OKASHKZ20CAJTAHYP8"/>
    <field id="19" value="MOWRXOC3OKASHKZ20CAJTAHYP8"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212478907932"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="MOWRXOC3OKASHKZ20CAJTAHYP8"/>
    <field id="19" value="MOWRXOC3OKASHKZ20CAJTAHYP8"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543160789844579</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212478907932</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212478907932=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>MOWRXOC3OKASHKZ20CAJTAHYP8</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_020_UMS Activation Rev with mode 041 and incorrect  track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="dfbd17ae-e4c2-4797-a3d9-427e60b613b3"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="a9dc8200-221e-428a-8061-f5d4db233b38"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="60701fb6-838d-4795-96d9-a273004902e4"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543160896658045"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543160896658045"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="22cdd531-ae8d-4187-8d15-8d31fdba1717"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="62e50624-94fa-4345-aba4-9dfd247d5af3"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212097637147"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000015000"/>
    <field id="18" value="SW69Z6G0U7JHSBN7XB4X1YROIN"/>
    <field id="19" value="SW69Z6G0U7JHSBN7XB4X1YROIN"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212097637147"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="SW69Z6G0U7JHSBN7XB4X1YROIN"/>
    <field id="19" value="SW69Z6G0U7JHSBN7XB4X1YROIN"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="787f9d0b-b804-4002-9af7-c14585307329"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539212097637147"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212097637147=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="SW69Z6G0U7JHSBN7XB4X1YROIN"/>
    <field id="19" value="SW69Z6G0U7JHSBN7XB4X1YROIN"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539212097637147"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212097637147=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="SW69Z6G0U7JHSBN7XB4X1YROIN"/>
    <field id="19" value="SW69Z6G0U7JHSBN7XB4X1YROIN"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164560621094</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212097637147</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212097637147=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>SW69Z6G0U7JHSBN7XB4X1YROIN</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_021_UMS Activation with PAN inTrack2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="e8187e7c-97f4-4427-907b-0dfa54ae9838" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="62f8a575-134e-401b-a5e6-e87a67928624"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="1e472608-ec6a-4df5-858d-562e72835626"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164621395065"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164621395065"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="5aff5f17-1047-48e5-b4b6-d814d654594e"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="5fb55b41-35ee-4dfe-b2dc-e5ab308f33c0"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="04	1"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212489842536"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543164621395065=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="KVIRJQO52CIPKY7WRRDZSSDQYM"/>
    <field id="19" value="KVIRJQO52CIPKY7WRRDZSSDQYM"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212489842536"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543164621395065=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="KVIRJQO52CIPKY7WRRDZSSDQYM"/>
    <field id="19" value="KVIRJQO52CIPKY7WRRDZSSDQYM"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543164621395065</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212489842536</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212489842536=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>KVIRJQO52CIPKY7WRRDZSSDQYM</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_022_UMS Activation Rev with PAN in Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="8341ebfd-f4a9-4c9f-aba4-1387c9a3fcb2"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="2932c1aa-784e-4815-9eff-9eed56be02a0"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="730f9e4d-e239-4068-8411-dd85dabb4b2a"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166976634040"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166976634040"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="76154120-4be1-4e3a-8fe1-378d152739e2"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="cdd2cbf0-187b-4580-9b1b-753bde0f6c9c"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543167429734068=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="U7FLBF8YW5AF9XBKXI72W3LY3P"/>
    <field id="19" value="U7FLBF8YW5AF9XBKXI72W3LY3P"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543167429734068=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="U7FLBF8YW5AF9XBKXI72W3LY3P"/>
    <field id="19" value="U7FLBF8YW5AF9XBKXI72W3LY3P"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="77f35816-7105-4457-afd6-fa611db09123"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543167429734068=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="U7FLBF8YW5AF9XBKXI72W3LY3P"/>
    <field id="19" value="U7FLBF8YW5AF9XBKXI72W3LY3P"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543167429734068=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="U7FLBF8YW5AF9XBKXI72W3LY3P"/>
    <field id="19" value="U7FLBF8YW5AF9XBKXI72W3LY3P"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"041"},{"field":"63.18","value":"@res63.18"},{"field":"63.19","value":"@res63.19"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543167429734068</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212323873403</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212323873403=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>U7FLBF8YW5AF9XBKXI72W3LY3P</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_023_UMS Activation with mode 041 and incorrect track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="952c178f-6a07-4134-8c51-be3de51ec9ac" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="f9305867-debb-4ceb-8d03-456472673d7e"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="b323adbd-4670-4e53-943c-974ebd381fb5"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166547200410"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166547200410"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="96b6727a-7498-412a-9ba0-29ec3ae1c132"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="4dc94f46-d68c-4119-a177-464480603724"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539212032538416"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212032538416=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="WX5ACEH5ONCXCVKVJKOSE8WS0S"/>
    <field id="19" value="WX5ACEH5ONCXCVKVJKOSE8WS0S"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539212032538416"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212032538416=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="WX5ACEH5ONCXCVKVJKOSE8WS0S"/>
    <field id="19" value="WX5ACEH5ONCXCVKVJKOSE8WS0S"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#proxyCardNumber}=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166547200410</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212032538416</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212032538416=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>WX5ACEH5ONCXCVKVJKOSE8WS0S</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_024_UMS Activation Rev with mode 041 and incorrect  track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="9033ab79-5669-47a7-bf63-436f9a7a1aac"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="7d6d220b-51ee-4c96-9f27-0971314c6962"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="1ce8891c-c500-4610-98e2-b1ce5e5c58f6"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543163452018557"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543163452018557"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="f54226aa-8dc0-49ef-b7b9-9bd13b1af05f"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="bce300ce-582e-447e-bebf-552740e7bf6e"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212164156996=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="RC7JM1NH3H59KVK2I3TPCEDZ9C"/>
    <field id="19" value="RC7JM1NH3H59KVK2I3TPCEDZ9C"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212164156996=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="RC7JM1NH3H59KVK2I3TPCEDZ9C"/>
    <field id="19" value="RC7JM1NH3H59KVK2I3TPCEDZ9C"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#proxyCardNumber}=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="5469d0d2-d768-4adc-b6d9-02f9f9c36e68"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="RC7JM1NH3H59KVK2I3TPCEDZ9C"/>
    <field id="19" value="RC7JM1NH3H59KVK2I3TPCEDZ9C"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="RC7JM1NH3H59KVK2I3TPCEDZ9C"/>
    <field id="19" value="RC7JM1NH3H59KVK2I3TPCEDZ9C"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"@res63.18"},{"field":"63.19","value":"@res63.19"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166775667846</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212164156996</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212164156996=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>RC7JM1NH3H59KVK2I3TPCEDZ9C</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_025_UMS SAF Activation with Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="0ab892fc-d81e-4a3c-a6ae-7fbec9d74e8f" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="18f987e7-e26f-4a57-9793-c50dd47a90d8"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="8ce01a13-1a0f-4428-a0e3-4802ea384230"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543161086607945"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543161086607945"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="b89faedc-00dd-4c67-8340-205d0d124242"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="f483a5f4-bd83-4593-8ceb-fc98bec4170a"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml/><generatedRequestXml/><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543161086607945</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212772477759</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212772477759=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>PDDZ2KDLLFBV4GPF47YDUATKKG</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_026_UMS SAF Activation Rev with Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="bd4799e0-b909-4653-a699-7ae42fa5bd7e"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="bb27ee4e-5e63-4454-a157-58b6f37f57e4"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="f82bad5d-0410-4419-b283-2d36a98a8099"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164142738778"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164142738778"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="7e013fff-ea14-4c85-be4a-83de21d3ab81"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="4867e7a4-b453-4806-9868-271e7c9465f6"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="TC4HA5OBUPLS4LKTESKVQCFKRB"/>
    <field id="19" value="TC4HA5OBUPLS4LKTESKVQCFKRB"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="TC4HA5OBUPLS4LKTESKVQCFKRB"/>
    <field id="19" value="TC4HA5OBUPLS4LKTESKVQCFKRB"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="94c75b25-b34a-4bb3-bae9-8e3afc0eaa22"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="TC4HA5OBUPLS4LKTESKVQCFKRB"/>
    <field id="19" value="TC4HA5OBUPLS4LKTESKVQCFKRB"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="TC4HA5OBUPLS4LKTESKVQCFKRB"/>
    <field id="19" value="TC4HA5OBUPLS4LKTESKVQCFKRB"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543169543098212</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212234968212</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212234968212=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>TC4HA5OBUPLS4LKTESKVQCFKRB</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_027_UMS SAF Activation without Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="f3ea6259-c82b-4346-ac97-cb01ceac2ec6" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="fc6b6405-9ab6-480f-8055-efcf5ae85c3c"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="222936a5-f608-4778-a888-e7b6f1eb80ea"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166095111550"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166095111550"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="3ac70b42-6040-4738-90af-d25b3807c19a"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="c724caec-52ae-4972-a15f-2fd15db4f93f"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212064660449"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="JW2VKSRTVBVJD6VDUGLMGMAV9W"/>
    <field id="19" value="JW2VKSRTVBVJD6VDUGLMGMAV9W"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212064660449"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="JW2VKSRTVBVJD6VDUGLMGMAV9W"/>
    <field id="19" value="JW2VKSRTVBVJD6VDUGLMGMAV9W"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"DEL"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166095111550</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212064660449</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212064660449=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>JW2VKSRTVBVJD6VDUGLMGMAV9W</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_028_UMS SAF Activation Rev without Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="1d102ab5-3bff-4a31-b646-9915ca4ab57b"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="274c8c73-8788-4d17-be08-5048ded3fda2"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="37a3cacc-2f3a-4e00-9087-13203f4755db"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166370288425"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166370288425"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="efdf1bb9-00cd-459a-b87f-54b0e324e071"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="705089e6-0677-46a2-87af-333689ac9b9a"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="DFV2TUXU4XBHXYVYBXJ8Y1762E"/>
    <field id="19" value="DFV2TUXU4XBHXYVYBXJ8Y1762E"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="DFV2TUXU4XBHXYVYBXJ8Y1762E"/>
    <field id="19" value="DFV2TUXU4XBHXYVYBXJ8Y1762E"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"DEL"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="bc300df2-b144-40da-9dc6-33b4a3774e81"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="DFV2TUXU4XBHXYVYBXJ8Y1762E"/>
    <field id="19" value="DFV2TUXU4XBHXYVYBXJ8Y1762E"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="DFV2TUXU4XBHXYVYBXJ8Y1762E"/>
    <field id="19" value="DFV2TUXU4XBHXYVYBXJ8Y1762E"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"011"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"DEL"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543169922415572</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212843211786</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212843211786=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>DFV2TUXU4XBHXYVYBXJ8Y1762E</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_029_UMS Activation with Decimals" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="ab705670-cef8-48d8-8148-afbca5428e5b" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="e4670ed4-61b7-47bf-9371-912cf497b280"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="9ad6d011-15bc-421e-a83b-6a7d08a24e74"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4358804221841481"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358804221841481"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="05681624-278d-401c-8d4d-b26939cb1d3a"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
// def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")

def con = Sql.newInstance(db_string, db_driver);
//def con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");

log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100.01 via UMS" id="a1246e7b-bb7d-4407-b705-80adc5bcbeed"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110928063233"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110928063233=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675012176"/>
    <field id="3" value="C000000010001"/>
    <field id="18" value="OFHO7YBJUMXTKKAHO9CYJJQJH4"/>
    <field id="19" value="OFHO7YBJUMXTKKAHO9CYJJQJH4"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110928063233"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110928063233=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675012176"/>
    <field id="18" value="OFHO7YBJUMXTKKAHO9CYJJQJH4"/>
    <field id="19" value="OFHO7YBJUMXTKKAHO9CYJJQJH4"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010001"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358804221841481</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675012176</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>435880</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539110928063233</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539110928063233=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>OFHO7YBJUMXTKKAHO9CYJJQJH4</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_030_UMS SAF Activation Rev with Decimals" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="d5b94f43-3a3a-477a-940f-e90c652c53d8"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="e9a1c933-4d53-4f45-b3db-e71193a225c8"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="61fc2992-fb61-4cd1-bf85-0d1fc1b907ce"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4358802084552176"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4358802084552176"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675012176"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="fecaa819-8e1c-4624-8677-6e8b4b4cf48b"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100.01 via UMS" id="8ee897f5-2b8e-4199-8c01-7ad1b314fc81"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010001"/>
    <field id="18" value="8D2LUAU47MNW1RL2KPX5GG22RX"/>
    <field id="19" value="8D2LUAU47MNW1RL2KPX5GG22RX"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="8D2LUAU47MNW1RL2KPX5GG22RX"/>
    <field id="19" value="8D2LUAU47MNW1RL2KPX5GG22RX"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010001"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"22","value":"021"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="277cde64-7b6c-44da-8e58-87c7b0b1ee89"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010001"/>
  <field id="6" value="000000010001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="8D2LUAU47MNW1RL2KPX5GG22RX"/>
    <field id="19" value="8D2LUAU47MNW1RL2KPX5GG22RX"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10001"/>
  <field id="6" value="10001"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="8D2LUAU47MNW1RL2KPX5GG22RX"/>
    <field id="19" value="8D2LUAU47MNW1RL2KPX5GG22RX"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10001"},{"field":"6","value":"10001"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4358803961669999</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675012176</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>435880</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539110204311442</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539110204311442=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>8D2LUAU47MNW1RL2KPX5GG22RX</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_031_UMS Activation with cardnumber" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="7a79b9d4-a939-44a0-b6b6-7464bf5ed672" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="6afa7a01-3dd7-464d-8911-b57274c26fc2"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="68cb7dfe-5dbd-4d22-b447-f0ccd9906dfc"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543168660037827"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543168660037827"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="2633e2f0-7d8e-4a87-9b69-4d50f746c2a4"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="8e3d98bb-2563-4315-b335-3bfd9736d41d"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0210"/>
  <field id="2" value="4543168660037827"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212154753927=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="4MYPO2F1D73GKH0ISC5UQTZBZ7"/>
    <field id="19" value="4MYPO2F1D73GKH0ISC5UQTZBZ7"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="4543168660037827"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212154753927=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="4MYPO2F1D73GKH0ISC5UQTZBZ7"/>
    <field id="19" value="4MYPO2F1D73GKH0ISC5UQTZBZ7"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0200"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543168660037827</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212154753927</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212154753927=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>4MYPO2F1D73GKH0ISC5UQTZBZ7</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_032_UMS SAF Activation Rev with card number" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="d06f346b-6975-4c69-89dc-5dc914722ea2"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="e7049a2d-61e7-47ef-ae23-711532fff08e"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="d29af70d-89c1-4991-af65-d9f600350312"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164593820905"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164593820905"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="fdbc282d-9746-4f1f-abf5-e4ecbabb507e"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
    con = Sql.newInstance(db_string, db_driver); 
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="76266a04-3cca-4266-8608-268a85f59686"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212972498682"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212972498682=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000015000"/>
    <field id="18" value="Z8UYSSMLQQ165GNU0CDNDGKR8L"/>
    <field id="19" value="Z8UYSSMLQQ165GNU0CDNDGKR8L"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212972498682"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212972498682=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="Z8UYSSMLQQ165GNU0CDNDGKR8L"/>
    <field id="19" value="Z8UYSSMLQQ165GNU0CDNDGKR8L"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="04bc9d56-ca8c-49fc-8af2-7a079e43f9da"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="4543162964580628"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212972498682=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000005000"/>
    <field id="18" value="Z8UYSSMLQQ165GNU0CDNDGKR8L"/>
    <field id="19" value="Z8UYSSMLQQ165GNU0CDNDGKR8L"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="4543162964580628"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212972498682=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="Z8UYSSMLQQ165GNU0CDNDGKR8L"/>
    <field id="19" value="Z8UYSSMLQQ165GNU0CDNDGKR8L"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162964580628</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212972498682</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212972498682=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>Z8UYSSMLQQ165GNU0CDNDGKR8L</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_033_UMS SAF Activation with incorrect exp date" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="622a0286-5115-465c-b266-bffa63c8d1d9" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="392296be-2bc1-4bc1-ae91-145995742223"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="6513dbfd-634d-4d1a-b7ee-554ea8e9baf2"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543167290381138"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543167290381138"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="84036418-4647-4d2c-9939-16cd28fd631d"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="da185563-786b-4691-9803-5ede869a84f5"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212996523335"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212996523335=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="9S6PZNSF61W8XQ7VUL5VIQMYR4"/>
    <field id="19" value="9S6PZNSF61W8XQ7VUL5VIQMYR4"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212996523335"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212996523335=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="9S6PZNSF61W8XQ7VUL5VIQMYR4"/>
    <field id="19" value="9S6PZNSF61W8XQ7VUL5VIQMYR4"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"14","value":"1811"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543167290381138</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212996523335</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212996523335=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>9S6PZNSF61W8XQ7VUL5VIQMYR4</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>30f4c4de-251f-45bb-96a4-5424057f9d44</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>ccc1786e-ea19-4497-b91e-350f0a7ba85c</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>b0a566f1-9608-46c4-9763-8e9eb51a7ee7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>20076cf5-d5ce-4b75-8e9b-3913ad592439</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_034_UMS Activation Rev with incorrect exp date" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="b2103d56-539e-46a3-a9fa-7eeca6aca09f"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="f0f4071a-f036-4dac-afe5-2638db8cd30f"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="f0730750-3c2a-463e-8660-b8a011105c43"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162909603475"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162909603475"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="e22b48bb-cdef-4ded-9587-e8f49a48773b"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="46383884-7bd9-4c24-93ad-8d870f20b09a"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1811"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/> 
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1810"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="DNGL9WFQR3OTOHUDV2RUK4PMBH"/>
    <field id="19" value="DNGL9WFQR3OTOHUDV2RUK4PMBH"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="14" value="1810"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="DNGL9WFQR3OTOHUDV2RUK4PMBH"/>
    <field id="19" value="DNGL9WFQR3OTOHUDV2RUK4PMBH"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"14","value":"1810"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="717fba91-7a59-4cde-845b-0e9a1239dcfc"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0420"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="DNGL9WFQR3OTOHUDV2RUK4PMBH"/>
    <field id="19" value="DNGL9WFQR3OTOHUDV2RUK4PMBH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="DNGL9WFQR3OTOHUDV2RUK4PMBH"/>
    <field id="19" value="DNGL9WFQR3OTOHUDV2RUK4PMBH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166641838597</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212146475432</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212146475432=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>DNGL9WFQR3OTOHUDV2RUK4PMBH</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_035_UMS SAF Activation with mode 011 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="6cfd4645-f20c-449f-a2ae-b1174687f5e5" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="258977bb-2ab8-4e53-b7a8-bda2e88fc86f"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="3ad34b49-755c-448d-afd7-cfc19089b8be"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162761564243"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162761564243"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="a0592eab-9433-4f89-a826-9eb14e75bc93"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="c8a81cf7-fad1-43f1-8a25-79b2639d110b"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212738967132"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212738967132=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="VU4RM9MQL94OJR14703XMML68F"/>
    <field id="19" value="VU4RM9MQL94OJR14703XMML68F"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212738967132"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212738967132=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="VU4RM9MQL94OJR14703XMML68F"/>
    <field id="19" value="VU4RM9MQL94OJR14703XMML68F"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162761564243</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212738967132</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212738967132=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>VU4RM9MQL94OJR14703XMML68F</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_036_UMS SAF Activation Rev with mode 011 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="cf5b008d-146f-4ba0-8c95-9d2ab023bdd7"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="517d5cfd-7d19-4acd-9cb3-b44125881703"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="6ad5f47d-9888-4841-9538-72aec2c4cae5"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543168085114077"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543168085114077"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="383a5305-341b-443c-a323-eda448daff78"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="289e6aa3-cf3e-4aab-b99e-17f481d46176"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="7RFLPP22R104LJ6KTNX2YDJM97"/>
    <field id="19" value="7RFLPP22R104LJ6KTNX2YDJM97"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="7RFLPP22R104LJ6KTNX2YDJM97"/>
    <field id="19" value="7RFLPP22R104LJ6KTNX2YDJM97"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"011"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="a04d3fb0-fcfe-4ff5-ac4a-ce6f2c36a701"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="7RFLPP22R104LJ6KTNX2YDJM97"/>
    <field id="19" value="7RFLPP22R104LJ6KTNX2YDJM97"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="7RFLPP22R104LJ6KTNX2YDJM97"/>
    <field id="19" value="7RFLPP22R104LJ6KTNX2YDJM97"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"011"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543165181170275</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212749268121</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212749268121=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>7RFLPP22R104LJ6KTNX2YDJM97</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_037_UMS SAF Activation with mode 031 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="cba726c8-0058-40be-b4d1-4e017c9d45f2" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="4c432570-315e-4fd8-ad51-23161baff2e7"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="66a1a920-288f-4355-89a9-319eaa47b5f4"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162134965604"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162134965604"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="f658c3df-b3c1-4fcb-96da-c77d0f7b9874"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="cab8b3e9-e33f-4501-af06-78ec33e1aa04"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212595682545"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212595682545=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="UKRSYC6CY87B21BB3KZ0XMTWSL"/>
    <field id="19" value="UKRSYC6CY87B21BB3KZ0XMTWSL"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212595682545"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212595682545=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="UKRSYC6CY87B21BB3KZ0XMTWSL"/>
    <field id="19" value="UKRSYC6CY87B21BB3KZ0XMTWSL"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"031"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162134965604</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212595682545</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212595682545=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>UKRSYC6CY87B21BB3KZ0XMTWSL</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_038_UMS SAF Activation Rev with mode 031 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="5fcf888a-70d9-4e3b-b7fb-3ee4c89c605b"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="6d761bc8-967c-4371-a4c0-a0a294c64661"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="12143e50-01f9-47fe-97fc-50d0855d15b4"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164014321005"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164014321005"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="9a9a230c-2e2e-41c0-8bf2-f532600e36a1"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="4eb4168b-58de-4a1c-9da3-e2cfd554460c"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="JQU4A5M443TYGYQA6YDBATXHI1"/>
    <field id="19" value="JQU4A5M443TYGYQA6YDBATXHI1"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="JQU4A5M443TYGYQA6YDBATXHI1"/>
    <field id="19" value="JQU4A5M443TYGYQA6YDBATXHI1"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"031"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="0c97788d-f336-4c2f-a582-7dfda2372e03"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="JQU4A5M443TYGYQA6YDBATXHI1"/>
    <field id="19" value="JQU4A5M443TYGYQA6YDBATXHI1"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="JQU4A5M443TYGYQA6YDBATXHI1"/>
    <field id="19" value="JQU4A5M443TYGYQA6YDBATXHI1"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543161687419726</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212175771935</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212175771935=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>JQU4A5M443TYGYQA6YDBATXHI1</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_039_UMS SAF Activation with mode 032 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="5e38c34e-d671-4d6f-9678-d13e42ce7454" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="a35082ef-d5d4-4a85-b985-ac030d55023d"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="580e41e7-28f3-47a4-9468-2a2c958cfbcb"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162201721770"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162201721770"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="15ad6007-c932-4e4a-a07e-d45d03555ff7"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="412de70c-de2b-4de0-817a-dd8c06901170"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212737058136"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212737058136=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="R7VLJBDPY0FJ2LZ9Q0S32PQ8PT"/>
    <field id="19" value="R7VLJBDPY0FJ2LZ9Q0S32PQ8PT"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212737058136"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212737058136=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="R7VLJBDPY0FJ2LZ9Q0S32PQ8PT"/>
    <field id="19" value="R7VLJBDPY0FJ2LZ9Q0S32PQ8PT"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"032"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162201721770</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212737058136</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212737058136=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>R7VLJBDPY0FJ2LZ9Q0S32PQ8PT</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_040_UMS SAF Activation Rev with mode 032 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="f0ac42ce-f59b-4379-a315-ad459631278f"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="cdc635cf-ba1f-4fa5-a7a4-b79694db9345"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="2a88722a-2ff4-4b27-b78d-ecbef3322e63"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164324826098"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164324826098"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="96523934-bf8d-4638-892b-002410a2e869"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="5adcc105-bfe7-4ef1-99c9-31d0c8646581"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="Q3BQ7RDDU77L33HB46LCOR29SD"/>
    <field id="19" value="Q3BQ7RDDU77L33HB46LCOR29SD"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="Q3BQ7RDDU77L33HB46LCOR29SD"/>
    <field id="19" value="Q3BQ7RDDU77L33HB46LCOR29SD"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"032"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="d579d12c-af08-4162-9bae-6b5e587211e6"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="Q3BQ7RDDU77L33HB46LCOR29SD"/>
    <field id="19" value="Q3BQ7RDDU77L33HB46LCOR29SD"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="Q3BQ7RDDU77L33HB46LCOR29SD"/>
    <field id="19" value="Q3BQ7RDDU77L33HB46LCOR29SD"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543168410379144</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212548144058</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212548144058=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>Q3BQ7RDDU77L33HB46LCOR29SD</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_041_UMS SAF Activation with mode 041 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="6b612a63-4fe8-43ed-af02-97f4b31c3896" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="2069ec41-9f4d-4043-b49f-54119da6f02c"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="439a5a4e-f237-4cb5-b911-726102eefc3c"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543162566265019"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543162566265019"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="b4eb4155-451b-4f75-8664-9acd19b492ae"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="ff054a28-3f79-43e4-a72e-4c2256ea8dcd"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212772551690"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212772551690=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="JW9EHJIT20VBXTCXH9TLH212J5"/>
    <field id="19" value="JW9EHJIT20VBXTCXH9TLH212J5"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212772551690"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212772551690=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="JW9EHJIT20VBXTCXH9TLH212J5"/>
    <field id="19" value="JW9EHJIT20VBXTCXH9TLH212J5"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162566265019</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212772551690</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212772551690=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>JW9EHJIT20VBXTCXH9TLH212J5</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_042_UMS SAF Activation Rev with mode 041 and track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="3680f22c-e0c4-4fe0-bdaf-fa58aa29d11f"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="5b9910cb-5926-48d1-adc9-ffc658074534"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="ba598409-bc75-4eed-8b44-4eea01440776"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543166722414878"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543166722414878"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="ae82a882-f74d-41e5-9bfa-6c0a901a8b0e"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="d564f4e7-5e92-4968-b28f-b6c66692fb91"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="AQRWXITIV8Z8INNAKY99CKUA0V"/>
    <field id="19" value="AQRWXITIV8Z8INNAKY99CKUA0V"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="AQRWXITIV8Z8INNAKY99CKUA0V"/>
    <field id="19" value="AQRWXITIV8Z8INNAKY99CKUA0V"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="7a43cc5e-dc88-4b41-90fa-481e7a6c3c67"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="AQRWXITIV8Z8INNAKY99CKUA0V"/>
    <field id="19" value="AQRWXITIV8Z8INNAKY99CKUA0V"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="AQRWXITIV8Z8INNAKY99CKUA0V"/>
    <field id="19" value="AQRWXITIV8Z8INNAKY99CKUA0V"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543163466156064</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212508000361</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212508000361=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>AQRWXITIV8Z8INNAKY99CKUA0V</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_043_UMS SAF Activation with mode 041 and incorrect track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="41d8ee7e-5e51-4e5d-bcf7-494bcf742ee3" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="dd4b6062-656d-4a1c-b73a-e7edc1930d57"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="b4f584da-be48-4cca-945e-18032169c1be"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543160048104618"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543160048104618"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="e8e430eb-5f8e-4416-b9b3-0ccec0ad4484"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="c66b1b7a-374e-4885-ac34-18c3d4b9d2c2"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212568464556"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="RCGWOT8ICKXVVAMFODMSLX2UY0"/>
    <field id="19" value="RCGWOT8ICKXVVAMFODMSLX2UY0"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212568464556"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="RCGWOT8ICKXVVAMFODMSLX2UY0"/>
    <field id="19" value="RCGWOT8ICKXVVAMFODMSLX2UY0"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543160048104618</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212568464556</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212568464556=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>RCGWOT8ICKXVVAMFODMSLX2UY0</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_044_UMS SAF Activation Rev with mode 041 and incorrect  track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="4e1fd09a-becd-4b2e-be74-a7e0a442e79e"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="53cf0bbd-456e-43c9-8554-a8d9c4ce1c83"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="e1465186-af81-4dd7-95e3-81085b80db87"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543165477589520"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543165477589520"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="55dbe429-5a02-4349-ae47-24cef169da20"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="bcfa0bb6-399a-4b84-af9b-89e68c7e92ec"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="7F3KXV42WSMB7TQA9WMNA0RFZA"/>
    <field id="19" value="7F3KXV42WSMB7TQA9WMNA0RFZA"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="7F3KXV42WSMB7TQA9WMNA0RFZA"/>
    <field id="19" value="7F3KXV42WSMB7TQA9WMNA0RFZA"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="da9f2603-d1fe-4957-b4f7-d29bf7786c65"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="7F3KXV42WSMB7TQA9WMNA0RFZA"/>
    <field id="19" value="7F3KXV42WSMB7TQA9WMNA0RFZA"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539110096400394=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="7F3KXV42WSMB7TQA9WMNA0RFZA"/>
    <field id="19" value="7F3KXV42WSMB7TQA9WMNA0RFZA"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestSuite#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543169375020895</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212603155688</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212603155688=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>7F3KXV42WSMB7TQA9WMNA0RFZA</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_045_UMS SAF Activation with PAN inTrack2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="a900d688-fec3-4951-9cfe-6ee52b2f2cbc" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="29551f92-1f12-4287-9242-e7049e711ea6"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="1a7a4a72-ce02-4e14-ba02-e26355faa772"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543169248152970"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543169248152970"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="17241712-6295-49ef-8812-6bcad4527ba0"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="9b7f6157-367e-4440-a6ea-4df554dbdeda"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="04	1"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212800665968"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543169248152970=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="04SOQNHFT09WOZP2L72KDRGBHG"/>
    <field id="19" value="04SOQNHFT09WOZP2L72KDRGBHG"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212800665968"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543169248152970=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="04SOQNHFT09WOZP2L72KDRGBHG"/>
    <field id="19" value="04SOQNHFT09WOZP2L72KDRGBHG"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543169248152970</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212800665968</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212800665968=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>04SOQNHFT09WOZP2L72KDRGBHG</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_046_UMS SAF Activation Rev with PAN in Track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="3016705a-f09d-417e-8315-39ab4b3848df"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="792c96e2-4de1-4a9b-8204-26498cc034db"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="44408c3a-fe22-4dcf-90a0-818c01f023a8"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164311256730"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164311256730"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="0848fcb5-3bab-4861-9503-fe10ab9a1397"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="5de466d4-43f9-4e9f-925e-3f8ca739f512"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543165084417675=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="YNSQ5ROJVPDJXT6HU5RPVGXVJU"/>
    <field id="19" value="YNSQ5ROJVPDJXT6HU5RPVGXVJU"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543165084417675=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="YNSQ5ROJVPDJXT6HU5RPVGXVJU"/>
    <field id="19" value="YNSQ5ROJVPDJXT6HU5RPVGXVJU"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="405bf262-1843-43a6-b2ad-25400db8aba2"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543165084417675=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="YNSQ5ROJVPDJXT6HU5RPVGXVJU"/>
    <field id="19" value="YNSQ5ROJVPDJXT6HU5RPVGXVJU"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";4543165084417675=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="YNSQ5ROJVPDJXT6HU5RPVGXVJU"/>
    <field id="19" value="YNSQ5ROJVPDJXT6HU5RPVGXVJU"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"041"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":";${#TestCase#PAN}=${#TestCase#ExpDate}?"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543165084417675</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212982378729</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212982378729=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>YNSQ5ROJVPDJXT6HU5RPVGXVJU</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_047_UMS SAF Activation with mode 041 and incorrect track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="db79bbf3-ff9e-41d3-8c43-e758af25c870" disabled="true"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="d3a5e426-4fc5-4619-abd6-3afa17e3422f"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" id="5c360cce-c0b8-4c3a-bbc9-3162d27ad422"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543169689155664"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543169689155664"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" id="ef46e344-7e4a-4298-af19-272ed59d686a"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="dfc9f9cf-9bc8-428a-a67e-01700fcf4c13"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="032"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539212074721566"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212074721566=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675010069"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="45OJJGSKLZ138FUZQUGMI616L1"/>
    <field id="19" value="45OJJGSKLZ138FUZQUGMI616L1"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539212074721566"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212074721566=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675010069"/>
    <field id="18" value="45OJJGSKLZ138FUZQUGMI616L1"/>
    <field id="19" value="45OJJGSKLZ138FUZQUGMI616L1"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestCase#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#proxyCardNumber}=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543169689155664</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212074721566</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212074721566=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>45OJJGSKLZ138FUZQUGMI616L1</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_048_UMS SAF Activation Rev with mode 041 and incorrect  track2" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="c58e5e02-7b26-4345-9cef-ae2a7653ec6f"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="f23c3ee1-9b6f-4aaf-b1d3-55d6c1b0b4e3"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="0d238dfd-90e1-434b-847b-1d5f758b6e46"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164420446324"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164420446324"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="2a1b7c8a-2336-4c1e-8e38-1e3fa6d1730f"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="2f0ebe40-c2c9-447a-84f4-47dcf34afbf5"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212959440912=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="J5O6L6DPBC9MNPLAKYE6544IMD"/>
    <field id="19" value="J5O6L6DPBC9MNPLAKYE6544IMD"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212959440912=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="J5O6L6DPBC9MNPLAKYE6544IMD"/>
    <field id="19" value="J5O6L6DPBC9MNPLAKYE6544IMD"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#proxyCardNumber}=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="dc271fa5-477d-41c3-a516-b0337294fd39"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212959440912=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="J5O6L6DPBC9MNPLAKYE6544IMD"/>
    <field id="19" value="J5O6L6DPBC9MNPLAKYE6544IMD"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="031"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212959440912=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="J5O6L6DPBC9MNPLAKYE6544IMD"/>
    <field id="19" value="J5O6L6DPBC9MNPLAKYE6544IMD"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"031"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543166871238924</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212959440912</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212959440912=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>J5O6L6DPBC9MNPLAKYE6544IMD</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_049_UMS SAF Already Reversed." searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="4bab6238-c911-4962-9ef8-eca42d839e69"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="f3c8bbef-ccd9-4a6c-9d8c-95a38f3be139"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="c995dde3-6c96-4ee0-bb94-02b523d8d467"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543164458733752"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543164458733752"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="5f6fc769-2b08-4191-95bf-d7ff2b54492c"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="7cc5cf49-ffee-4e2d-bd8e-9707b02d8a54"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212811192786=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000010000"/>
    <field id="18" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="19" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=";6039539212811192786=?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="19" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000010000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"041"},{"field":"35","value":";${#TestCase#proxyCardNumber}=?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Reversal activated card  via UMS" id="a0d3d813-23b4-48df-91f3-168277c8834a"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0200"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212811192786=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="39" value="00"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="19" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212811192786=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="19" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"00"},{"field":"63.3","value":"C000000000000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"041"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Copy of Reversal activated card  via UMS" id="db4e2e84-c00d-463f-8695-0f07f3a0a1bd"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0420"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212811192786=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="000000"/>
  <field id="39" value="34"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="3" value="C000000000000"/>
    <field id="18" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="19" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="041"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="6039539212811192786=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="19" value="GYCC774FB9FWZHCRWRMTI8HX5S"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"34"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"041"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"35","value":"${#TestCase#Track2}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543165198122500</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212811192786</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212811192786=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>GYCC774FB9FWZHCRWRMTI8HX5S</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_050_UMS SAF Activation with  incorrect track2 present" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="4bbbf5d3-d0ab-4799-ba6b-34a1a96246aa"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="e2a37776-4613-48c8-a2a5-ad38dec6f997"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="1957a3f7-007a-469b-b358-4ee0607e5281"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543165339560956"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543165339560956"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="78082329-2f56-4c22-882d-ad50d81786b5"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="a3847853-fd2d-4f14-a5d0-1ae80049a9ea"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="';6039539120243321611=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="000000"/>
  <field id="39" value="08"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="18" value="W7JYKWVLSUZ5HSDZO0MO2W2GT4"/>
    <field id="19" value="W7JYKWVLSUZ5HSDZO0MO2W2GT4"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="';6039539120243321611=1911?"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="W7JYKWVLSUZ5HSDZO0MO2W2GT4"/>
    <field id="19" value="W7JYKWVLSUZ5HSDZO0MO2W2GT4"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"08"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":"';6039539120243321611=1911?"},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543162096394049</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212654342349</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212654342349=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>W7JYKWVLSUZ5HSDZO0MO2W2GT4</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_051_UMS SAF Activation with no track2 incorrect" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="d960ad13-d609-4012-b1a8-8f74ef504d2b"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="74a2a957-0c86-4bbf-a024-263edf4cf28a"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="adbb2173-1085-4325-9816-2e15d1fd13ca"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543161418383822"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543161418383822"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="fb73ca32-a8f6-49fb-b1d7-cdedd724c1ad"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="bf7fa12f-4017-4782-b5a1-0cd756ed5c46"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value="6039539110442480728"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=""/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="000000"/>
  <field id="39" value="69"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="18" value="                          "/>
    <field id="19" value="                          "/>
    <field id="23" value="0000"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539110442480728"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=""/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value=""/>
    <field id="19" value=""/>
    <field id="23" value=""/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"69"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"6039539110442480728"},{"field":"49","value":"840"},{"field":"63.2","value":"07675005430"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":""},{"field":"63.18","value":""},{"field":"63.19","value":""},{"field":"63.23","value":""},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543169708192643</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212608299902</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212608299902=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>7SUGKHLREVCTKMTJGDDS5UPZ2T</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="false" failTestCaseOnErrors="false" keepSession="false" maxResults="0" name="TC_052_UMS SAF Activation rev with no track2 incorrect" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="" id="e4d3461c-2869-49c4-84b3-56a4e991800a"><con:settings/><con:testStep type="groovy" name="Create PAN &amp; Guid" id="24a878ce-a482-407f-85d6-e489255f1303"><con:settings/><con:config><script>def bin_range=testRunner.testCase.getPropertyValue("BIN_RANGE");
//def PAN=bin_range+(long)(Math.random()*100000000);

def PAN=bin_range +  new Random().with {
    (1..10).collect { ('0'..'9').join()[ nextInt( (('0'..'9')).join().length() ) ] }.join()
  }
testRunner.testCase.setPropertyValue( "PAN", PAN);

log.info PAN


def guid=  new Random().with {
    (1..26).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()
  }

//log.info guid  

testRunner.testCase.setPropertyValue("Guid", guid);</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Add Card via CMF" disabled="true" id="9978d235-71d3-42b0-9ff5-1921eff9cb5f"><con:settings/><con:config><specificationType>CMF-KEYSTONE</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>9555</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
<field id="0" value="2304"/>
<field id="2" value="Replaced by Field Substitutions"/>
<field id="7" value="150409101823"/>
<field id="11" value="000326"/>
<field id="12" value="20150409101823"/>
<field id="14" value="1911"/>
<field id="24" value="301"/>
<field id="37" value="000000000430"/>
<field id="101" value="CARD"/>
<isomsg id="113">
  <field id="2" value="106"/>
  <field id="21" value="07675005430"/>
</isomsg>
</isomsg>]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2314"/>
  <field id="2" value="4543165818522034"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000000000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="39" value="0000"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <!-- org.jpos.iso.packager.GenericSubFieldPackager -->
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <field id="0" value="2304"/>
  <field id="2" value="4543165818522034"/>
  <field id="7" value="150409101823"/>
  <field id="11" value="000326"/>
  <field id="12" value="20150409101823"/>
  <field id="14" value="1911"/>
  <field id="24" value="301"/>
  <field id="37" value="000000000430"/>
  <field id="101" value="CARD"/>
  <isomsg id="113">
    <field id="2" value="106"/>
    <field id="21" value="07675010069"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"0000"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestCase#PAN}"},{"field":"113.21","value":"${#TestCase#UPC}"},{"field":"14","value":"${#TestCase#ExpDate}"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="groovy" name="Get proxyCardNumber" disabled="true" id="34595e8e-b05c-4ba6-bffa-54cbcebd6d57"><con:settings/><con:config><script>import groovy.sql.Sql;

//Establish JDBC Connection to the DB
def con=null
def db_string =testRunner.testCase.testSuite.getPropertyValue("DB_String")
def db_driver =testRunner.testCase.testSuite.getPropertyValue("DB_Driver")
try{
//  con = Sql.newInstance("jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift", "com.mysql.jdbc.Driver");
    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail()  
}
log.info con

//def lastFour = testRunner.testCase.testSuite.getPropertyValue( "lastFour" )
def pan = testRunner.testCase.getPropertyValue( "PAN" )
def lastFour=pan[-4..-1]
def expDate=testRunner.testCase.getPropertyValue("ExpDate");

def proxyCardNumber=con.firstRow("select proxyCardNumber from card where  lastFour=? order by createdDate desc", [lastFour]).proxyCardNumber;
def track2= proxyCardNumber +"="+expDate +"?";
testRunner.testCase.setPropertyValue("proxyCardNumber", proxyCardNumber);
testRunner.testCase.setPropertyValue("Track2", track2);

con.close();</script></con:config></con:testStep><con:testStep type="acquirer_sim" name="Activate Card 100 via UMS" id="77f6e49e-3475-4229-b39a-a3dce67d36b6"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestCase#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="RBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="19" value="6A3ZF3XDGFJQX6K7S4P35XKTLH"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0230"/>
  <field id="2" value=""/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=""/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="000000"/>
  <field id="39" value="69"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="18" value="SXQSF4A6YV75JK6X19FIMWBH2S"/>
    <field id="19" value="SXQSF4A6YV75JK6X19FIMWBH2S"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0220"/>
  <field id="2" value=""/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=""/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value="SXQSF4A6YV75JK6X19FIMWBH2S"/>
    <field id="19" value="SXQSF4A6YV75JK6X19FIMWBH2S"/>
    <field id="23" value="4781"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"69"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNmuber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"22","value":"021"},{"field":"35","value":""},{"field":"63.18","value":"${#TestCase#Guid}"},{"field":"63.19","value":"${#TestCase#Guid}"},{"field":"63.23","value":"4781"},{"field":"0","value":"0220"},{"field":"3","value":"725400"},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:testStep type="acquirer_sim" name="Copy of Reversal activated card  via UMS" id="b0a367c5-77d9-4616-9ab3-44cf42ebc251"><con:settings/><con:config><specificationType>BHNUMSV4.2</specificationType><ipAddress>${#TestSuite#Host}</ipAddress><port>${#TestSuite#Port}</port><specificationFile/><readThreadTimeout>${#Project#ISO_Request_Timeout}</readThreadTimeout><requestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="0420"/>
  <field id="2" value="6039539010951084165"/>
  <field id="3" value="725400"/>
  <field id="4" value="5000"/>
  <field id="6" value="5000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="011"/>
  <field id="32" value="60300000371"/>
  <field id="35" value="SBFS"/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675006912"/>
    <field id="18" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="19" value="T5WWRR85DNGCS2I1QF68KKPB09"/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></requestXml><responseXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D530003010004</header>
  <field id="0" value="0430"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="000000010000"/>
  <field id="6" value="000000010000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=""/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="000000"/>
  <field id="39" value="69"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <!-- org.jpos.iso.packager.GenericPackager -->
    <field id="2" value="07675005430"/>
    <field id="18" value="                          "/>
    <field id="19" value="                          "/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></responseXml><generatedRequestXml><![CDATA[<isomsg>
  <!-- org.jpos.iso.packager.XMLPackager -->
  <header>42484E554D5300020102</header>
  <field id="0" value="420"/>
  <field id="2" value="6039539110096400394"/>
  <field id="3" value="725400"/>
  <field id="4" value="10000"/>
  <field id="6" value="10000"/>
  <field id="7" value="141009170406"/>
  <field id="11" value="000213"/>
  <field id="12" value="170406"/>
  <field id="13" value="141009"/>
  <field id="18" value="5411"/>
  <field id="22" value="021"/>
  <field id="32" value="60300000371"/>
  <field id="35" value=""/>
  <field id="37" value="09050452299 "/>
  <field id="38" value="749240"/>
  <field id="41" value="1234567890123456"/>
  <field id="42" value="60300000371    "/>
  <field id="43" value="BLACKHAWK SIMULATOR   PLEASANTON   CA US"/>
  <field id="49" value="840"/>
  <field id="51" value="840"/>
  <isomsg id="62">
    <field id="20" value="0"/>
  </isomsg>
  <isomsg id="63">
    <field id="2" value="07675005430"/>
    <field id="18" value=""/>
    <field id="19" value=""/>
    <field id="23" value="1786"/>
  </isomsg>
</isomsg>
]]></generatedRequestXml><wireMessage/><assertions>[{"field":"39","value":"69"},{"field":"","value":""}]</assertions><packager/><fieldSubstitutions>[{"field":"2","value":"${#TestSuite#proxyCardNumber}"},{"field":"49","value":"${#TestCase#CHCurrency}"},{"field":"63.2","value":"${#TestSuite#UPC}"},{"field":"4","value":"10000"},{"field":"6","value":"10000"},{"field":"0","value":"420"},{"field":"22","value":"021"},{"field":"63.18","value":""},{"field":"63.19","value":""},{"field":"35","value":""},{"field":"","value":""}]</fieldSubstitutions><fetchLogs>false</fetchLogs><srcScriptPath/><tgtOutPutFilePath/><sshUser/><sshPassword/><appLogPath/><generateIdentifiers/></con:config></con:testStep><con:properties><con:property><con:name>PAN</con:name><con:value>4543169843329065</con:value></con:property><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675010069</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>BIN_RANGE</con:name><con:value>454316</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539212201624994</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539212201624994=1911?</con:value></con:property><con:property><con:name>Guid</con:name><con:value>SXQSF4A6YV75JK6X19FIMWBH2S</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>8642a9df-5376-4872-a2e9-088f74091343</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a79cbe73-6064-48f2-a907-3cff8f9b7b71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:properties><con:property><con:name>CHCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>TxnCurrency</con:name><con:value>840</con:value></con:property><con:property><con:name>UPC</con:name><con:value>07675005430</con:value></con:property><con:property><con:name>ExpDate</con:name><con:value>1911</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.32</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>lastFour</con:name><con:value>7898</con:value></con:property><con:property><con:name>account</con:name><con:value>1000000000000002175</con:value></con:property><con:property><con:name>PAN1</con:name><con:value>4543161234567891</con:value></con:property><con:property><con:name>TotalTxns</con:name><con:value>241</con:value></con:property><con:property><con:name>TotalPassTxns</con:name><con:value>127</con:value></con:property><con:property><con:name>TotalFailTxns</con:name><con:value>4</con:value></con:property><con:property><con:name>DB_String</con:name><con:value>jdbc:mysql://keystone-nagift-qa-r.cmbg1chil2vy.us-west-2.rds.amazonaws.com:3306/keystone_db?user=bhnuser&amp;password=bhnuser_nagift</con:value></con:property><con:property><con:name>DB_Driver</con:name><con:value>com.mysql.jdbc.Driver</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039539110096400394</con:value></con:property><con:property><con:name>Track2</con:name><con:value>6039539110096400394=1911?</con:value></con:property></con:properties><con:reportParameters/></con:testSuite><con:testSuite name="TS_Safeway_CLOOP_Tran_code API testing-KONE" id="fba19f19-2cca-48f9-ac1e-b6d97fccba2a"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC DAR - fuel pre auth API" searchProperties="true" id="355ca0d3-b108-4031-b24b-91a166349344"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="aad0d09f-b42c-4c7a-ada9-40b911c5396a"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.transform.Field
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["pre auth"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

    java.text.DateFormat dateFormat = new java.text.SimpleDateFormat("_yyyy_MM_dd_HH_mm_ss");
    java.util.Date date = new Date();
    def outputFile = context.expand('${#Project#Project_Home}/TXN_Report');
    def outputFileWithDateFormat = outputFile + ".txt";
    File file =new File(outputFileWithDateFormat)

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)
     testRunner.testCase.setPropertyValue("proxyCardNumber",proxyCN)

try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_8_0&amp;password=clooppassword", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
testRunner.testCase.setPropertyValue("tranId", tranId.toString())
con.close()

    
    def out=proxyCN +","+tranId
    file.write(out)
    
  //  file.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="dc14ca31-2737-4a20-8aa3-1a5a5a700a26"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000161780701</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424851</con:value></con:property><con:property><con:name>api_response</con:name><con:value>{
  "request.MTI" : "2100",
  "request.PAN" : "603953A8A8A87969369",
  "request.PROC_CODE" : "000000",
  "request.TXN_AMOUNT" : "8402000000000100",
  "request.BILLING_AMOUNT" : "8402000000000100",
  "request.TRANSMISSION_DATE_TIME" : "150922014415",
  "request.STAN" : "000000000213",
  "request.LOCAL_TXN_DATE_TIME" : "20150922014415",
  "request.CAPTURE_DATE" : "0922",
  "request.POS_DATA_CODE" : "00100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000",
  "request.MESSAGE_REASON_CODE" : "1786",
  "request.MCC" : "5542",
  "request.AID" : "60300000371",
  "request.RRN" : "09082419649 ",
  "request.APPROVAL_CODE" : "749240",
  "request.TID" : "1234567890123456",
  "request.CARD_ACCEPTOR_ID" : "60300000024    ",
  "request.CARD_ACCEPTOR_NAME" : "BLACKHAWK SIMULATOR",
  "request.CARD_ACCEPTOR_CITY" : "PLEASANTON",
  "request.CARD_ACCEPTOR_STATE" : "CA ",
  "request.CARD_ACCEPTOR_COUNTRY_CODE" : "US ",
  "request.PARTIAL_AUTH_INDICATOR" : "1",
  "request.TXN_IDENTIFIER" : "T5WWRR85DNGCS2I1QF68KKPB09",
  "request.TXN_CORR_IDENTIFIER" : "T5WWRR85DNGCS2I1QF68KKPB09",
  "request.UPC" : "07675010686",
  "response.MTI" : "2110",
  "response.PAN" : "603953A8A8A87969369",
  "response.PROC_CODE" : "000000",
  "response.TXN_AMOUNT" : "8402000000000100",
  "response.BILLING_AMOUNT" : "8402000000000100",
  "response.TRANSMISSION_DATE_TIME" : "150922014415",
  "response.STAN" : "000000000213",
  "response.LOCAL_TXN_DATE_TIME" : "20150922014415",
  "response.CAPTURE_DATE" : "0922",
  "response.POS_DATA_CODE" : "00100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000",
  "response.MESSAGE_REASON_CODE" : "1786",
  "response.MCC" : "5542",
  "response.AID" : "60300000371",
  "response.RRN" : "09082419649 ",
  "response.APPROVAL_CODE" : "749240",
  "response.RESP_CODE" : "0000",
  "response.TID" : "1234567890123456",
  "response.CARD_ACCEPTOR_ID" : "60300000024    ",
  "response.CARD_ACCEPTOR_NAME" : "BLACKHAWK SIMULATOR",
  "response.CARD_ACCEPTOR_CITY" : "PLEASANTON",
  "response.CARD_ACCEPTOR_STATE" : "CA ",
  "response.CARD_ACCEPTOR_COUNTRY_CODE" : "US ",
  "response.CVV_RESULT_CODE" : " ",
  "response.PARTIAL_AUTH_INDICATOR" : "1",
  "response.TXN_IDENTIFIER" : "T5WWRR85DNGCS2I1QF68KKPB09",
  "response.TXN_CORR_IDENTIFIER" : "T5WWRR85DNGCS2I1QF68KKPB09",
  "response.UPC" : "07675010686",
  "TRANSACTION_TYPE" : "Fuel Authorization - Pending",
  "FORCED_POST" : "false",
  "DISPUTE_STATUS" : null,
  "RECONCILED" : "false",
  "TRAN_CODE" : null,
  "EXT_RC" : null,
  "RC_DESCRIPTION" : "Transaction approved",
  "ACCOUNTING_IMPACT" : "DEBIT",
  "TOLERANCE_AMOUNT" : "0.0",
  "UMS.STORE_NUMBER" : "1234567890",
  "UMS.TID" : "123456"
}</con:value></con:property><con:property><con:name>tran_code</con:name><con:value xsi:nil="true"/></con:property><con:property><con:name>transaction_type</con:name><con:value>Fuel Authorization - Pending</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer" disabled="true" id="f8f8dbd3-b0ab-4213-9740-1d7e242b79fe"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" useXQuery="false" entitize="false" transferChildNodes="false"><con:name>response</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>REST Test tran code</con:sourceStep><con:targetType>api_response</con:targetType><con:targetStep>Properties1</con:targetStep><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="groovy" name="process api response" disabled="true" id="77b53a60-8d40-4d3d-aa5a-aeba15d00005"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper

 def slurper = new JsonSlurper()
def target=context.expand('${#Project#Project_Home}/TXN_Report.txt')
  File file= new File(target)
def holder = testRunner.testCase.testSteps["Properties1"].getPropertyValue("api_response") 
 res_holder = holder.toString()
//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
def response = slurper.parseText(res_holder)
//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(holder)
log.info response
testRunner.testCase.testSteps["Properties1"].setPropertyValue("tran_code", response.TRAN_CODE)
testRunner.testCase.testSteps["Properties1"].setPropertyValue("transaction_type", response.TRANSACTION_TYPE)
file.append(","+response.TRANSACTION_TYPE+","+response.TRAN_CODE+"\r\n")
log.info response
log.info response.TRAN_CODE
log.info response.TRANSACTION_TYPE</script></con:config></con:testStep><con:properties><con:property><con:name>tranId</con:name><con:value>1100000000001424851</con:value></con:property><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000161780701</con:value></con:property><con:property><con:name>tran_code</con:name><con:value/></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC DAR fuel preauth completion API" searchProperties="true" id="1830727c-f989-4060-80a5-828f48cd2d99"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="d4a198e2-095c-4f23-be91-01085f04b9b6"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["pre auth completion"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml
//def target=context.expand('${#Project#Project_Home}/TXN_Report.txt')
//  File file= new File(target)

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN
     
	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
//   def out=proxyCN +","+tranId +"\r\n"
//     file.append(out)
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="11b66bc4-c29a-403f-99e3-6fb7a193ad33"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039539710708955378</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001425140</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>5a02d975-543f-48c2-813c-4646df36c718</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>8221aa0d-3070-4106-99c8-f7e25914886b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Fuel completion and Reversal API" searchProperties="true" id="da7136d5-b061-4c5e-84ed-c93a6f4b3ace"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="ddcb4e8f-318d-485b-b10f-8959856ff11c"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["pre auth-for choice"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml
//def target=context.expand('${#Project#Project_Home}/TXN_Report.txt')
//  File file= new File(target)
  
DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
//def out=proxyCN +","+tranId +"\r\n"
//     file.append(out)
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="84525bf5-5f7b-43d9-aa33-05401ca8e9a0"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000318150006</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424772</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>5a02d975-543f-48c2-813c-4646df36c718</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>351c7835-3712-4f1d-b12b-cd3390af41ca</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC DAR and Tran_code" searchProperties="true" id="956098f0-5385-4efd-8003-f48a9604922c"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response 63.14" id="d2f86ba7-2b89-4964-a412-0a93122dc4f6"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.xpath.XPathConstants;
import javax.xml.xpath.XPathFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["DAR"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml
def target=context.expand('${#Project#Project_Home}/TXN_Report.txt')
  File file= new File(target)
  
DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	//to get field 63.14 
     String subIsoXPath = String.format("//isomsg[@id='%s']/field[@id='%s']", 63, 14)
     log.info "Looking for Sub ISO path $subIsoXPath";
     node = xpath.evaluate(subIsoXPath, doc, XPathConstants.NODESET).item(0);

//	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_7_0&amp;password=clooppassword", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
//def out=proxyCN +","+tranId +"\r\n"
//     file.append(out)
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="d32ccdb3-a4f8-4b0d-a473-7e4162597759"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000374792923</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424773</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>d2f86ba7-2b89-4964-a412-0a93122dc4f6</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Credit Adj and Tran_code" searchProperties="true" id="67d880ab-1549-447b-a2a9-db44662bb160"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="582e33a7-0bec-40a0-8844-c5eb7a73304e"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["Credit adjustment"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml
//def target=context.expand('${#Project#Project_Home}/TXN_Report.txt')
//  File file= new File(target)
DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
//def out=proxyCN +" "+tranId +"\r\n"
//     file.append(out)
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="e9a0804f-16b7-4fff-a2e4-f7d21f164aef"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000772942781</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424775</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Credit Adj Reversal and Tran_code" searchProperties="true" id="81c4bb54-099a-481c-84f3-349c2b6c4a4f"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="43ded58c-721b-4ff7-b989-a7a957293851"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["credit adjustment reversal"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="abad11d2-2009-4ba1-8172-0914ffade15f"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000604194254</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424778</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>688a0de6-ef14-4050-93b5-59829af6c0c7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Debit Adj and Tran_code" searchProperties="true" id="09d70fa0-ffbf-47ce-89d9-6dec9d036f57"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="f0879c89-81f1-4c22-92aa-716ad8be1d17"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["Debit adjustment"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="515b0f66-af6c-4e38-9697-06a3781a5b5b"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000974631836</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424780</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Debit Adj Reversal and Tran_code" searchProperties="true" id="e04b626c-75d3-4579-aeab-29341d087241"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="4f9013a4-5e71-4d05-9d2a-5c9ad0473cf5"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["debit adjustment reversal"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="42818781-efe9-463a-982b-8b2c8a4d9e55"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000874212612</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424783</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>776a3f77-5f6d-4744-b216-7754f709e81a</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Pos load and Tran_code" searchProperties="true" id="782f79d2-7fa7-4a5e-8419-9e8d0d049a92"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="374e3706-e619-4de8-8e37-e42a666d605e"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["Pos load"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="e0fecb94-840d-46ed-9123-dec189a7cf75"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000385300492</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424785</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Pos load reversal and Tran_code" searchProperties="true" id="f8645647-4f7c-4796-b79f-75e781b09621"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="07a66961-8df5-4369-ad58-722af5876b7d"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["pos reload reversal"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="4e7f032f-ab4d-4fea-8787-c433916bd70c"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000825484922</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424788</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>d7b710ae-d7f6-4038-a78d-122907362d70</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Pos load Void and Tran_code" searchProperties="true" id="60116b51-b2a9-4ce2-a4bd-af5bec1a054b"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="e2c2cf87-8cdd-49cb-b1cc-02f24ad25a79"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["void pos reload"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="87a6355a-ec65-4a9b-9d42-458f68222779"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000911067607</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424791</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>eb409be1-b573-41a0-9e75-22eddc8bda93</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC merchandise return tran code" searchProperties="true" id="b2b3372d-fd00-4975-b264-bde28927361c"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="a2a132ee-b5ff-4ebe-8c3c-39e95e70ecf9"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["merchandise return"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="706013ba-3618-461a-989b-7440318037a6"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000714822711</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424794</con:value></con:property></con:properties></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC merchandise return reversal tran code" searchProperties="true" id="3c97f1c7-138e-4eaa-a0ba-5447157aebe1"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="ddd49aec-3b3d-44db-9261-a9582cd10c40"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["merchandise return reversal"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="0a3902ad-9e52-45e5-867c-8c8c221376f1"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000517155236</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424798</con:value></con:property></con:properties></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC IVR Redemption and Tran_code" searchProperties="true" id="26df70c8-20b4-4c20-a753-8513aa36348f"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="8a5c299a-e1b7-4f81-bbfc-9f5d113582a2"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["IVR redemption"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()

   
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="df89fca2-3cfa-49a4-9212-eb2643f276d6"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000571089735</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424800</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC IVR Redemption reversal and Tran_code" searchProperties="true" id="670536e5-d14f-4c71-83f6-02cbdfc67149"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="fcee33ba-9e69-4f6f-9f88-c1fd4ff293f9"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["IVR Redemption Reversal"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="a590b04d-a3cd-4557-bcf6-c3327d24d09a"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000858514298</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424803</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>088de437-dd80-4313-b939-5fbe033d65d9</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Void DAR and API" searchProperties="true" id="5c3192a4-047e-4c38-bf33-151e88f932ad"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="e1fb2515-6980-4f29-9c8f-0c9370fb18ab"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["Void DAR"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="e4120980-8332-4a85-9452-5574f979725b"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535010464386759</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424805</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>d8286dad-fb41-487d-9489-c038469b35b6</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC DAR Void Dar Reversal API" searchProperties="true" id="27b97567-a0b8-4655-a03c-62415fa00b22"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="0f435671-92b1-4917-ad56-f9b46ac03926"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["Void DAR Reversal"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="065c6a8a-acc1-44f8-9dd7-f4975ca2e2e9"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535010954606112</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424808</con:value></con:property></con:properties></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Bulk Activation API" searchProperties="true" id="6aa24402-cea1-473f-adaa-9e7f2af23b73"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="7bf40ba6-9f29-4e51-9268-dbe6ed8d263f"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["bulk activation"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="be3a30f2-a1d9-47ff-8092-468b085c9a1a"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000461549606</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000001424854</con:value></con:property></con:properties></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Bulk Activation Reversal API --working" searchProperties="true" id="95ea4bf6-c415-490a-a315-4ac40d4d284e"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" id="744a3b9e-f6ce-4cd9-a043-45950113ddd6"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["bulk activation"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" id="dc57851c-c024-4e8d-8c7f-99ba68c38da5"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000461549606</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915602</con:value></con:property></con:properties></con:config></con:testStep><con:properties/><con:reportParameters/><con:breakPoints><con:testStepId>a9a4a29c-0cc4-4d85-8724-fdd50e72ec36</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>fccaca71-b3f7-4725-925d-1e8414537137</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Credit Adj Reversal (amount not matching)" searchProperties="true" id="b64c85de-9b66-4f5a-bbfc-11befe4e7272"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" disabled="true" id="10582f94-4a0e-486e-b64c-47c18f6679af"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["credit adjustment reversal"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" disabled="true" id="a021538c-ec0f-4283-98ea-64e5c582b6bf"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000229261264</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000916848</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>688a0de6-ef14-4050-93b5-59829af6c0c7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Pos load reversal(amount not match)" searchProperties="true" id="81c229dc-8782-4ffa-9aa7-fff207d5f6ca"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" disabled="true" id="cee740b9-1891-4f9a-80da-4592c04c3f60"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["pos reload reversal"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" disabled="true" id="fa536fb6-ce49-4ece-9286-44ea5d521d72"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000569894187</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000916858</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>d7b710ae-d7f6-4038-a78d-122907362d70</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Debit Adj Reversal (amt not match)" searchProperties="true" id="cbb28440-4aeb-4405-930e-7fb086be595e"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" disabled="true" id="8da8d341-4308-47b5-811b-0864e0c25bd6"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["debit adjustment reversal"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" disabled="true" id="cf3958b3-339e-4934-87c2-74fb13e36f74"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000062585167</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000916853</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>776a3f77-5f6d-4744-b216-7754f709e81a</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Preauth - Reversal (amt not match)" searchProperties="true" id="cd539ca1-dea3-46bf-9fa8-1e6c0fc57bc8"><con:settings/><con:properties/><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Preauth - Reversal (MID not match)" searchProperties="true" id="56186228-1deb-4eda-b7fb-be06eb650f1f"><con:settings/><con:properties/><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Preauth - Reversal (MID not match) to QAR" searchProperties="true" id="1c8b3242-cb59-4183-af4b-d6c457d628fc"><con:settings/><con:properties/><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Dup Dar within 3 days" searchProperties="true" id="9a483dda-0149-479d-894f-95a364db880e"><con:settings/><con:loadTest name="LoadTest 1" id="037b8cfd-7f0c-42d4-bcf9-8d5cce9f5e33"><con:settings><con:setting id="hasBeenConvertedToLoadUITest">true</con:setting></con:settings><con:threadCount>1</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>30</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type><con:config><testDelay>6000</testDelay><randomFactor>0.0</randomFactor></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval><con:reportParameters/></con:loadTest><con:properties/><con:reportParameters/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Dup Dar out of 3 days" searchProperties="true" id="04c49c57-5826-40e2-baf1-002684965c44"><con:settings/><con:testStep type="groovy" name="Groovy Script1" id="02391e78-caeb-4efa-a497-a45b91b2e4a8"><con:settings/><con:config><script>import org.codehaus.groovy.runtime.TimeCategory

def now= new Date()
log.info now

use(TimeCategory) {
 day1= now-6.days - 1.hours
}

def day=day1.format('yyMMdd')
log.info day

testRunner.testCase.setPropertyValue("day", day)
</script></con:config></con:testStep><con:properties><con:property><con:name>day</con:name><con:value>160129</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>02391e78-caeb-4efa-a497-a45b91b2e4a8</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Credit Adj Dup check within 63 days" searchProperties="true" id="5a652bcd-6fc5-47b7-8f9c-4cbd3f889926"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" disabled="true" id="24dee9b2-53b9-49d0-bf91-bd850dd36895"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["credit adjustment reversal"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" disabled="true" id="d129790c-0124-4f76-bdb1-62504ac67b57"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000229261264</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000916848</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>688a0de6-ef14-4050-93b5-59829af6c0c7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>ded381f6-cfd5-4d77-8e75-04af7ee8b81e</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Credit Adj Dup check out of 63 days" searchProperties="true" id="1855b02b-7156-4294-b121-e1421e914613"><con:settings/><con:testStep type="groovy" name="Groovy Script1" id="bd083f31-b47e-45be-8373-7dde9424972a"><con:settings/><con:config><script>import org.codehaus.groovy.runtime.TimeCategory

def now= new Date()
log.info now

use(TimeCategory) {
 day1= now-66.days - 1.hours
}

def day=day1.format('yyMMdd')
log.info day

testRunner.testCase.setPropertyValue("Day", day)</script></con:config></con:testStep><con:testStep type="groovy" name="Groovy Script to get response" disabled="true" id="348275c4-0916-41e8-8db1-307bc060c8a1"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["credit adjustment reversal"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" disabled="true" id="7bbf7e3b-f0d8-4611-8f39-2ba30383c108"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000229261264</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000916848</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property><con:property><con:name>Day</con:name><con:value>151130</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>688a0de6-ef14-4050-93b5-59829af6c0c7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>ded381f6-cfd5-4d77-8e75-04af7ee8b81e</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bd083f31-b47e-45be-8373-7dde9424972a</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC Debit Adj Dup check within 63 days" searchProperties="true" id="1bdaee7e-686e-4083-8527-eb06aff88775"><con:settings/><con:testStep type="groovy" name="Groovy Script to get response" disabled="true" id="8638f08c-afe4-48cc-9802-954b1a9ffce3"><con:settings/><con:config><script>import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.GroovyUtils
import groovy.json.JsonSlurper
import groovy.sql.Sql;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;
import javax.xml.xpath.*;

//def slurper = new JsonSlurper()
//def  slurper= new XmlSlurper()
def sourceDataElementId = "2";


def acqTestStep = testRunner.testCase.testSteps["Debit adjustment"];
def responseXml = (acqTestStep.getPropertyValue("responseXml") != null)?acqTestStep.getPropertyValue("responseXml"):acqTestStep.getResponseXml(); 

log.info responseXml

DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true);
DocumentBuilder builder = domFactory.newDocumentBuilder();
if( responseXml == null ){
	alert.showInfoMessage(" response XML is null!");
}else {
	Document doc = builder.parse(new InputSource(new ByteArrayInputStream((responseXml).getBytes("utf-8"))));
	def xpath = XPathFactory.newInstance().newXPath();
	def node = xpath.evaluate( "//field[@id='$sourceDataElementId']", doc, XPathConstants.NODE );
	def elementValue = node.getAttributes().getNamedItem("value");
	def proxyCN=elementValue.getNodeValue();
	
	log.info proxyCN

	testRunner.testCase.testSteps["Properties1"].setPropertyValue( "proxyCardNumber", proxyCN)


try{
  con = Sql.newInstance("jdbc:mysql://localhost:33306/keystone_db?user=cloop_15_4_0&amp;password=0MwbWNLutJM2nmuvfuOw", "com.mysql.jdbc.Driver");
//    con = Sql.newInstance(db_string, db_driver);
}catch(ex){
//	assert con != null
	log.error "DB connection error"  
	return testRunner.fail();  
}
log.info con
def tranId=con.firstRow("select id from tranlog  where account in (select account from card where proxyCardNumber=?) order by 1 desc",[proxyCN]).id

testRunner.testCase.testSteps["Properties1"].setPropertyValue("tranId", tranId.toString())
con.close()
}
//def holder=responseXml.toString()
//def temp=responseXml.getNodeValue("//field[@id='2']")

//assert messageExchange.responseHeaders != null
//xmlHold = messageExchange.responseContentAsXml.toString() 
//holder = messageExchange.responseContent.toString()
//def response = slurper.parseText(responseXml)

//log.info response	</script></con:config></con:testStep><con:testStep type="properties" name="Properties1" disabled="true" id="6650ad1b-c6b1-44f8-8d1e-9cc68323438b"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>proxyCardNumber</con:name><con:value>6039535000356323754</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000920763</con:value></con:property></con:properties></con:config></con:testStep><con:properties><con:property><con:name>Guid</con:name><con:value>SQQCHQ5CE0QXANBCBKCGFH2WRG</con:value></con:property><con:property><con:name>tranId</con:name><con:value>1100000000000915051</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>2395316b-26e7-45a8-a2cb-e047be327af7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87edca6f-5ae1-44b6-be91-f55cf21d87fa</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bbd64a40-5b5b-4155-a657-6aca74a4b4e5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3968e3ee-7297-407e-944b-dbfc6d474e18</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46592ab9-7f04-4733-ba39-e301bf78d251</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3c7af000-c061-435d-9179-a45a85fab68b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>aef7ed94-5a98-4f78-af2f-679dc361d9b3</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:properties><con:property><con:name>TotalTxns</con:name><con:value>375</con:value></con:property><con:property><con:name>TotalPassTxns</con:name><con:value>127</con:value></con:property><con:property><con:name>TotalFailTxns</con:name><con:value>4</con:value></con:property><con:property><con:name>RRN</con:name><con:value>${='0908'+(int)(Math.random()*10000000)}</con:value></con:property><con:property><con:name>Date</con:name><con:value>${=(new Date()).format('yyMMdd')}</con:value></con:property><con:property><con:name>Time</con:name><con:value>${=(new Date()).format('hhmmss')}</con:value></con:property><con:property><con:name>Host</con:name><con:value>10.182.202.205</con:value></con:property><con:property><con:name>TS</con:name><con:value>${=(new Date()).format('yyMMddhhmmss')}</con:value></con:property><con:property><con:name>UPC</con:name><con:value>02113001524</con:value></con:property><con:property><con:name>Port</con:name><con:value>8584</con:value></con:property><con:property><con:name>Guid</con:name><con:value>8909I0WS4MJG1XIZJI7SU14UF8</con:value></con:property></con:properties><con:reportParameters/></con:testSuite><con:requirements/><con:properties/><con:wssContainer/><con:databaseConnectionContainer/><con:oAuth2ProfileContainer/><con:reporting><con:xmlTemplates/><con:parameters/></con:reporting><con:authRepository/><con:loadUiTest name="LoadTest 1" id="6ad587a6-5f26-43ca-81da-7cbc10cad3ad"><con:settings><con:setting id="convertedFromLoadTestModelItemId">ee60f87e-6df0-4ade-ae26-2be29cf2a3b5</con:setting></con:settings><con1:loadui-project id="baa4ff40-a46a-424b-92da-4d9a5e8719aa" label="LoadTest 1" xmlns:con1="http://eviware.com/loadui/config"><con1:properties><con1:property propagates="true" key="ModelItem.description" type="java.lang.String"/><con1:property propagates="true" key="CanvasItem.abortOnFinish" type="java.lang.Boolean">false</con1:property><con1:property propagates="true" key="ModelItem.saveReport" type="java.lang.Boolean">false</con1:property><con1:property propagates="true" key="ModelItem.reportFolder" type="java.lang.String"/><con1:property propagates="true" key="ModelItem.reportFormat" type="java.lang.String"/><con1:property propagates="true" key="Temporary project" type="java.lang.String"/><con1:property propagates="true" key="ModelItem.rate" type="java.lang.Long">10</con1:property><con1:property propagates="true" key="ModelItem.loadDistributionType" type="com.smartbear.load.facade.LoadDistributionType">PerScenario</con1:property><con1:property propagates="true" key="ModelItem.remoteMode" type="java.lang.String"/></con1:properties><con1:attributes><con1:property key="limits">Time=60;</con1:property></con1:attributes><con1:addons/><con1:scene label="New Scenario" id="057f9c9a-0f03-45ca-909b-6e108b5595d8" version="23"><con1:properties><con1:property propagates="true" key="ModelItem.description" type="java.lang.String"/><con1:property propagates="true" key="CanvasItem.abortOnFinish" type="java.lang.Boolean">false</con1:property><con1:property propagates="true" key="SceneItem.followProject" type="java.lang.Boolean">true</con1:property><con1:property propagates="true" key="SceneItem.scenarioRatePercentage" type="java.lang.Long">100</con1:property><con1:property propagates="true" key="SceneItem.scenarioRateSpecific" type="java.lang.Long">10</con1:property></con1:properties><con1:attributes><con1:property key="limits">Time=60;</con1:property></con1:attributes><con1:addons/><con1:component type="com.eviware.loadui.impl.component.IntervalComponent" label="Interval 1" id="8b9a78e6-e51a-4a2d-92bd-d530e36570e6" category="Scheduler"><con1:properties><con1:property propagates="true" key="ModelItem.description" type="java.lang.String"/><con1:property propagates="true" key="stateProperty" type="java.lang.Boolean">true</con1:property><con1:property propagates="true" key="startAt" type="java.lang.Long">0</con1:property><con1:property propagates="true" key="duration" type="java.lang.Long">5</con1:property><con1:property propagates="true" key="unit" type="java.lang.String">Sec</con1:property><con1:property propagates="true" key="mode" type="java.lang.String">Single</con1:property><con1:property propagates="true" key="defaultMode" type="java.lang.Boolean">true</con1:property></con1:properties><con1:attributes><con1:property key="com.eviware.loadui.api.model.ComponentItem@type">Interval</con1:property></con1:attributes><con1:addons/></con1:component><con1:component type="com.eviware.loadui.impl.component.generators.FixedVU" label="Fixed Load 2" id="d2a4b236-1397-4d59-8cef-996dd95d996e" category="Generators"><con1:properties><con1:property propagates="true" key="ModelItem.description" type="java.lang.String"/><con1:property propagates="true" key="stateProperty" type="java.lang.Boolean">true</con1:property><con1:property propagates="true" key="load" type="java.lang.Long">4</con1:property><con1:property propagates="true" key="interval" type="java.lang.Long">1000</con1:property></con1:properties><con1:attributes><con1:property key="com.eviware.loadui.api.model.ComponentItem@type">Fixed Load</con1:property></con1:attributes><con1:addons/></con1:component><con1:component type="com.eviware.loadui.components.soapui.SoapUISamplerComponent" label="TS_3_Visa_07675005430_435880_PIN Txns:TC_016_Visa Return Pin txns Valid Pin 100" id="e161e136-e496-4437-bd02-77c90f3b3d35" category="Runners"><con1:properties><con1:property propagates="true" key="ModelItem.description" type="java.lang.String"/><con1:property propagates="true" key="concurrentSamples" type="java.lang.Long">1000</con1:property><con1:property propagates="true" key="property_name_is_not_relevant_for_private_property" type="java.lang.Long">9223372036854775807</con1:property><con1:property propagates="true" key="maxQueueSize" type="java.lang.Long">1000</con1:property><con1:property propagates="true" key="countDiscarded" type="java.lang.Boolean">false</con1:property><con1:property propagates="true" key="disabledTestSteps" type="java.lang.String"/><con1:property propagates="true" key="_thinkTime" type="java.lang.Long">0</con1:property><con1:property propagates="true" key="ReadyApiTestCase" type="com.eviware.soapui.impl.wsdl.testcase.WsdlTestCase">c7233d3d-43d2-47b3-b12b-cccc20b9aefe</con1:property><con1:property propagates="true" key="raiseError" type="java.lang.Boolean">true</con1:property><con1:property propagates="true" key="outputTestCaseProperties" type="java.lang.Boolean">true</con1:property><con1:property propagates="true" key="OutputLevel" type="java.lang.String">TestCase only</con1:property><con1:property propagates="true" key="closeConnectionsAfterRequest" type="java.lang.Boolean">false</con1:property><con1:property propagates="true" key="disableSoapuiAssertions" type="java.lang.Boolean">false</con1:property><con1:property propagates="true" key="forceShareDatasources" type="java.lang.Boolean">true</con1:property></con1:properties><con1:attributes><con1:property key="com.eviware.loadui.api.model.ComponentItem@type">Ready API TestCase Runner</con1:property></con1:attributes><con1:addons/></con1:component><con1:connection outputTerminalId="8b9a78e6-e51a-4a2d-92bd-d530e36570e6/outgoingTerminal" inputTerminalId="d2a4b236-1397-4d59-8cef-996dd95d996e/stateTerminal"/><con1:connection outputTerminalId="d2a4b236-1397-4d59-8cef-996dd95d996e/triggerTerminal" inputTerminalId="e161e136-e496-4437-bd02-77c90f3b3d35/triggerTerminal"/><con1:connection outputTerminalId="e161e136-e496-4437-bd02-77c90f3b3d35/runningTerminal" inputTerminalId="d2a4b236-1397-4d59-8cef-996dd95d996e/Sample Count"/></con1:scene><con1:statistics><con1:page title="DefaultLoadUIStatisticPage"/></con1:statistics></con1:loadui-project><con:loadUITestScenario projectId="baa4ff40-a46a-424b-92da-4d9a5e8719aa" scenarioId="057f9c9a-0f03-45ca-909b-6e108b5595d8" name="New Scenario" id="41f7149a-7424-4a1d-9ca0-318ed0fe8f66"><con:settings/></con:loadUITestScenario><con:setupScript xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/><con:teardownScript xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/><con:reportParameters/></con:loadUiTest><con:tags/></con:soapui-project>